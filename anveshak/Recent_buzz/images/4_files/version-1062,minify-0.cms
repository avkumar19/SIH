
	        if(typeof(_geo) === "undefined"){
	            var _geo = (typeof(geolocation) !== "undefined")?geolocation:100;
	        }else{
			    _geo = (typeof geolocation !== "undefined")?geolocation:_geo;
	        }
	        var toiprops = toiprops || {};
	        toiprops.createCookie = function(name, value, days) {
                var expires;
                if (days) {
                    var date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    expires = "; expires=" + date.toGMTString();
                }
                else {
                    expires = "";
                }
                document.cookie = name + "=" + value + expires + "; path=/";
            };

	        toiprops.chkGeo = function(callback,ad_geo){
			    if(typeof Get_Ckie_str === "function" && Get_Ckie_str('_countrygeo')){_countrygeo=Get_Ckie_str('_countrygeo');}
			    else if(typeof Set_Ckie_str === "function"){
			        $.getScript( "https://geoapi.indiatimes.com/?cb=1", function() {
			            Set_Ckie_str('_countrygeo', geoinfo.CountryCode, 365, '/', '.indiatimes');
			            _countrygeo=geoinfo.CountryCode
			        })
			    }
			};
			toiprops.chkGeo();
			var crtg_nid = '4306';
            var crtg_cookiename = 'crtg_rta';
            var crtg_varname = 'crtg_content';
            function crtg_getCookie(c_name){ var i,x,y,ARRCookies=document.cookie.split(";");for(i=0;i<ARRCookies.length;i++){x=ARRCookies[i].substr(0,ARRCookies[i].indexOf("="));y=ARRCookies[i].substr(ARRCookies[i].indexOf("=")+1);x=x.replace(/^\s+|\s+$/g,"");if(x==c_name){return unescape(y);} }return'';}
            var crtg_content = crtg_getCookie(crtg_cookiename);
            var crtg_rnd=Math.floor(Math.random()*99999999999);
            (function(){
                if(_geo!=1){
                    var crtg_url=location.protocol+'//rtax.criteo.com/delivery/rta/rta.js?netId='+escape(crtg_nid);
                    crtg_url +='&cookieName='+escape(crtg_cookiename);
                    crtg_url +='&rnd='+crtg_rnd;
                    crtg_url +='&varName=' + escape(crtg_varname);
                    var crtg_script=document.createElement('script');crtg_script.type='text/javascript';crtg_script.src=crtg_url;crtg_script.async=true;
                    if(document.getElementsByTagName("head").length>0)document.getElementsByTagName("head")[0].appendChild(crtg_script);
                    else if(document.getElementsByTagName("body").length>0)document.getElementsByTagName("body")[0].appendChild(crtg_script);
                }
            })();
            window.isPwtLoaded=false;
            var tgtkeys={};
            var PWT={}; //Initialize Namespace
            PWT.jsLoaded = function(){ //PubMatic pwt.js on load callback is used to load GPT
                window.isPwtLoaded=true;
            }
            
           
            
            
            function loadPWT() {
                    var purl = window.location.href;
                    var url = '//ads.pubmatic.com/AdServer/js/pwt/23105/46';
                    var profileVersionId = '';
                    if(purl.indexOf('pwtv=')>0){
                           var regexp = /pwtv=(.*?)(&|$)/g;
                           var matches = regexp.exec(purl);
                           if(matches.length >= 2 && matches[1].length > 0){
                                   profileVersionId = '/'+matches[1];
                           }
                    }
                    var wtads = document.createElement('script');
                    wtads.async = true;
                    wtads.type = 'text/javascript';
                    wtads.src = url+profileVersionId+'/pwt.js';
                    var node = document.getElementsByTagName('script')[0];
                    node.parentNode.insertBefore(wtads, node);
            }
            function removeAds(adtype,t) {
                var targetElement = (t) ? t : 'body';
                $(targetElement).find('.gds').hide();
                            }
            
            $( document ).ready(function() {
                if(!(typeof toiprops && typeof toiprops.toipr!="undefined")){
    			    loadPWT();
                    (function() {
            			var gads = document.createElement('script');
            			gads.async = true;
            			gads.type = 'text/javascript';
            			var useSSL = 'https:' == document.location.protocol;
            			gads.src = (useSSL ? 'https:' : 'http:') + 
            			'//www.googletagservices.com/tag/js/gpt.js';
            			var node = document.getElementsByTagName('script')[0];
            			node.parentNode.insertBefore(gads, node);
        			})();
    			}else{
                    typeof removeAds =="function" && removeAds('gpt');
                    $('.colombia,.ad1,.ctn_ads_rhs,.colombia,.ad,.ads,.ad-widget').hide();
    	        }
            });
            var googletag = googletag || {};
			googletag.cmd = googletag.cmd || [];
			
			var _fic;
            if (document.referrer && document.referrer.search(/timesofindia|jcmsdev|toidev/) == -1) {
                var _ficarr = document.cookie.match(/(?:\s)?fic=(\w+);?/);
                _fic = (_ficarr && _ficarr[1])?parseInt(_ficarr[1], 10)+1:1;
                document.cookie="fic="+_fic+"; path=/";
            }else{
                _fic=0;
            }
			
		
		
		var adsthrottle = function(limit,func) {
                         
                          var inThrottle = void 0;
                          var lastFunc = void 0;
                          var lastRan = void 0;
                          return function () {
                                var context = this;
                                var args = arguments;
                                if (!inThrottle) {
                                  func.apply(context, args);
                                  lastRan = Date.now();
                                  inThrottle = true;
                                } else {
                                  clearTimeout(lastFunc);
                                  lastFunc = setTimeout(function () {
                                    if (Date.now() - lastRan >= limit) {
                                      func.apply(context, args);
                                      lastRan = Date.now();
                                    }
                                  }, limit - (Date.now() - lastRan));
                                }
                             };
            
                        };
        
        var dfpFallbackAdsLoad = function(){
            if($( "[data-adsSlot][data-fallback-ad-for]" ).length > 0){
        		adsReadTag('default', true);
            }
        };
        
        var dfpadsLoad = function(){
            if($( "[data-adsSlot]" ).length > 0){
        		adsReadTag('default');
            }
        };
        
        var trackGArequest = function(reqevent , reqtemp, reqads){
            ga('send', 'event', reqtemp, "req_" + reqevent, reqads);
        }
        
        
        var SCP = 0, addListner=0, _SCN, _Tmpl, _Tmpl_SCN;
        var inViewCtr = 0;
        var slotObj = Object(), trackGA = Object(), 
            fallbackAds = {
                /*adID: {
                    toBeChecked: true/false, // to be checked for empty response
                    toBeLoaded: true/false, // fallback ad to be loaded for these ads, as they were rendered empty
                    $el: adDomObj
                }*/
            },
            slotObj_all = Object(), etJSONObj;
        
        var adsSlotToUniqueKey = function(adSlot){
            return adSlot.toString().split("").reduce(function(a,b){a=((a<<5)-a)+b.charCodeAt(0);return a&a},0);
        }
        
        var adsReadTag = function(msid, fallbackAdsOnly){
            _fn_execute = function(dfpads,isactive){
                
                googletag.cmd.push(function() { 
                    
            		dfpads['len'] = dfpads.containers.length;
            		dfpads['arr'] = [];
            		var slot = '';
            		var adsid = [];
            		
	    
	    
	    <!-- Audience Segment Targeting -->
		var _auds = new Array();
		if(typeof(_ccaud)!='undefined') {
		for(var i=0;i<_ccaud.Profile.Audiences.Audience.length;i++)
		if(i<200)
		_auds.push(_ccaud.Profile.Audiences.Audience[i].abbr);
		}
		<!-- End Audience Segment Targeting -->
		
		<!-- Contextual Targeting -->
		var _HDL = '';
		var _ARC1 = '';
		var _Hyp1 = (typeof _Hyp1_pg != "undefined") ? _Hyp1_pg : ((typeof toiprops != "undefined" && toiprops.hasOwnProperty("_Hyp1_pg") && typeof toiprops._Hyp1_pg != "undefined") ? toiprops._Hyp1_pg : '');
		_Hyp1 = (typeof(qmsid)!='undefined' && qmsid=='49332082') ? 'manipal hospitals' : _Hyp1;
		_SCN = (typeof _SCN_pg != "undefined") ? _SCN_pg : ((typeof toiprops != "undefined" && toiprops.hasOwnProperty("_SCN_pg") && typeof toiprops._SCN_pg != "undefined") ? toiprops._SCN_pg : '');
		var _SubSCN = (typeof toiprops != "undefined" && toiprops.hasOwnProperty("_SubSCN_pg") && typeof toiprops._SubSCN_pg != "undefined") ? toiprops._SubSCN_pg : '';
		_Tmpl = (typeof toiprops != "undefined" && toiprops.hasOwnProperty("_Tmpl_pg") && typeof toiprops._Tmpl_pg != "undefined") ? toiprops._Tmpl_pg : '';
		var _PGT = (typeof _PGT_pg != "undefined") ? _PGT_pg : ((typeof toiprops != "undefined" && toiprops.hasOwnProperty("_PGT_pg") && typeof toiprops._PGT_pg != "undefined") ? toiprops._PGT_pg : '');
		var _BL = (typeof toiprops != "undefined" && toiprops.hasOwnProperty("_BL_pg") && typeof toiprops._BL_pg != "undefined") ? 1 : 0;
		var _LastSubSCN = (typeof toiprops != "undefined" && toiprops.hasOwnProperty("_LastSubSCN_pg") && typeof toiprops._LastSubSCN_pg != "undefined") ? toiprops._LastSubSCN_pg : '';
		_Tmpl_SCN = (_Tmpl && _SCN) ? _Tmpl+"_"+_SCN : '';
		var _article = '';
		var _MetaKey = (typeof toiprops != "undefined" && toiprops.hasOwnProperty("_MetaKey_pg") && typeof toiprops._MetaKey_pg != "undefined") ? toiprops._MetaKey_pg : $('meta[name=keywords]').attr("content");
		var _tval = function(v) {
		if(typeof(v)=='undefined') return '';
		if(v.length>100) return v.substr(0,100);
		return v;
		}
		tgtkeys = {
        	'FIC': _fic,
        	'Tmpl_SCN':	_Tmpl_SCN,
        	'SubSCN': _SubSCN,
        	'SCN':	_SCN,
        	'LastSubSCN': _LastSubSCN,
        	'SCP':	SCP,
        	'Arc1': _ARC1,	 
        	'BL': _BL,
        	'PGT': _PGT,
        	'Hyp1': _Hyp1,
        	'crtotoi': '',	 
        	'rpmid':'',
            'pagecolor':'',
            'ctnkeyword': _MetaKey
        }
		<!-- End Contextual Targeting -->
		
	
                    var exc = function(ele,msid){
                        //adsid=$ele.attr('id');
        			    var adsSlot = ele.data('adsSlot')||$ele.data('adsslot');
        			    if(adsSlot=='#' || adsSlot=='') return true;
            			if(!(adsSlot.match(/^7176/))){
            				adsSlot = "/7176/"+adsSlot;
            			}
            			var adssize=ele.data('size');
            			adsid=ele.attr('id');
        			    if(msid!='' && msid!='default' && !adsid.match(new RegExp(msid,'g'))) {
        			        return true;
        			    }
        			    if($ele.css('display')!='none'){
                            if(adssize){
                                slot = googletag.defineSlot(adsSlot, adssize, adsid).addService(googletag.pubads());
                            }else{
                            	slot = googletag.defineOutOfPageSlot(adsSlot, adsid).addService(googletag.pubads());
                            }
                            if(ele.data('ga')){
                            
                                trackGArequest(ele.data('ga'), _Tmpl_SCN, adsSlot);                            
                                trackGA[adsSlotToUniqueKey(adsSlot)] = ele.data('ga');
                            }
                            
                            if(ele.data('adsrefresh') && ele.data('adsrefresh')!='all') slotObj[adsid]=slot;
                            if(ele.data('adsrefresh') && ele.data('adsrefresh')=='all') slotObj_all[adsid]=slot;
                            dfpads['arr'].push(adsid);
        			    }
        			};
    
    
        			var chkGeoLogic = function(cas, geo){
                       var c = (cas+"").split("|");
                       if((cas+"").indexOf("!") >= 0){//Not case
                          if(c.indexOf("!" + geo) >= 0){
                            return true;
                          }else{
                            return false;
                          }
                        }else{
                          if(c.indexOf(geo) >= 0){  
                            return false;
                          }else{
                            return true;
                          }      
                        }      
                    };
                
            		for(var i=0; i<dfpads.len; i++){
            			var $ele = $(dfpads.containers[i]);
            			var adsSlot = $ele.data('adsSlot')||$ele.data('adsslot');
            			if(!(adsSlot.match(/^7176/))){
            				adsSlot = "/7176/"+adsSlot;
            			}
            			var adssize=$ele.data('size');
            			var isActiveSlot=$ele.data('isactive');
            			// multiple fallback ads are supported, separator $$, however this value is not used anywhere, in code as of now
            			var hasFallbackAds = $ele.data('fallback-ads');
            			var fallbackFor = $ele.data('fallback-ad-for');
            			
            			adsid=$ele.attr('id');
            			
            			
            			
            			/********* fallback ad handling start ******************/
            			// correct the ad slot if needed
            			if(fallbackFor && !(fallbackFor.match(/^7176/))){
            				fallbackFor = "/7176/" + fallbackFor;
            			}
            			if(fallbackFor){
            			    fallbackAds[adsSlotToUniqueKey(fallbackFor)] = fallbackAds[adsSlotToUniqueKey(fallbackFor)] || {};
            			    fallbackAds[adsSlotToUniqueKey(fallbackFor)].$fallbackEls = fallbackAds[adsSlotToUniqueKey(fallbackFor)].$fallbackEls || [];
            			    if(fallbackAds[adsSlotToUniqueKey(fallbackFor)].$fallbackEls.indexOf($ele) === -1){
            			        fallbackAds[adsSlotToUniqueKey(fallbackFor)].$fallbackEls.push($ele);   
            			    }
            			}
            			/* if fallback ad is needed, add this ad slot to be checked in ad render end callback, for empty */
            			if(hasFallbackAds){
            			    fallbackAds[adsSlotToUniqueKey(adsSlot)] = fallbackAds[adsSlotToUniqueKey(adsSlot)] || {};
            			    fallbackAds[adsSlotToUniqueKey(adsSlot)].toBeChecked = true;
            			    fallbackAds[adsSlotToUniqueKey(adsSlot)].$el = $ele;
            			}
            			
            			/* skip rendering ad for following cases
            			// 1. method is called for non-fallback ads, and this is a fallback ad
            			// 2. method is called for fallback ads, and this is not a fallback ad
            			// 3. method is called for fallback ads and this is a fallback ad, but the ad for which this is the fallback, was not rendered empty
            			*/
            			if( (!fallbackAdsOnly && fallbackFor) 
                            || (fallbackAdsOnly && !fallbackFor) 
                            || (fallbackAdsOnly && fallbackFor && !(fallbackAds[adsSlotToUniqueKey(fallbackFor)] && fallbackAds[adsSlotToUniqueKey(fallbackFor)].toBeLoaded)) 
                        ){
                            continue;
                        }
                        /********* fallback ad handling end ******************/
            			
            			
            			/********* isActive verification ******************/
            			if(isactive && typeof isactive === 'object'){
            			    if(isactive.parent && isactive.parent[isActiveSlot] 
            			        && isactive.parent[isActiveSlot]['status']==1 
            			        && (isactive.parent[isActiveSlot]['loc']== 'All' ||
            			            isactive.parent[isActiveSlot]['loc']== _geo || (isactive.parent[isActiveSlot]['loc']==100 && _geo!=1))
            			        ){
            			    }else{
            			        continue;
            			    }
            			} else if(isActiveSlot){
            			    continue;
            			}
            			/********* Check ad position ******************/
            			if($ele.data('move')){
            			    $('.'+$ele.data('move')).html($ele)
            			}
            			/********* end ******************/
            			/********* To execute Campaign ad only ******************/
            			if(_Hyp1 && _Hyp1!='' && _Hyp1.match(/_campaign/g) && !adsSlot.match(/TOI_Microsite/g)){
            			    $('#'+adsid).removeAttr('data-adsSlot').removeAttr('data-adsslot');
            			    continue;
            			}
            			if(typeof toiprops != "undefined" && toiprops.hasOwnProperty("_adSlotShouldcontains") && adsSlot.indexOf(toiprops._adSlotShouldcontains) == -1){
            			    $('#'+adsid).removeAttr('data-adsSlot').removeAttr('data-adsslot');
            			    continue;
            			}
            			
            			/********* end ******************/
            			
            			/********* check cookies ******************/
            			var ad_ck = $ele.data('cookie');
            			if(ad_ck && ad_ck!=''){
            			    //var get_ck = toiprops.cookie.get(ad_ck);
            			    var get_ck = document.cookie.match(new RegExp("(?:s)?" + ad_ck + "=(\\w+);?"));
            			    if(get_ck){
            			        $('#'+adsid).removeAttr('data-adsSlot').removeAttr('data-adsslot');
            			        continue;
            			    }
            			    //toiprops.createCookie('ad_ck',1,365);
            			}
            			/********* end check cookies **************/
            			/********* check Fisrt Impression Cound ******************/
            			var ad_fic = $ele.data('fic');
            			if(ad_fic && ad_fic!=''){
            			    if(_fic > ad_fic || _fic==0){
            			        $('#'+adsid).removeAttr('data-adsSlot').removeAttr('data-adsslot');
            			        continue;
            			    }
            			}
            			/********* end check Fisrt Impression Cound **************/
            			/********* check  ******************/
            			var ad_in = $ele.data('inview');
            			if(ad_in && ad_in!=''){
            			    if($(window).scrollTop() < ad_in && inViewCtr!=-1){ 
            			        continue;
            			    }
            			    $('#'+adsid).removeAttr('data-adsSlot').removeAttr('data-adsslot');
            			    $('#'+adsid).removeAttr('data-inview');
            			    inViewCtr--;
            			}
            			/********* end check cookies **************/
            			
            			/********* Geo targetted ads **************/
            			var ad_geo = $ele.data('geo');
            			if(ad_geo && ad_geo!='' ){
            			    if(_geo!=''){
            			        //if(ad_geo!=_geo){continue;}
            			        if(chkGeoLogic(ad_geo,_geo)){//(ad_geo+"").split('|').indexOf(_geo)==-1){
            			            $('#'+adsid).removeAttr('data-adsSlot').removeAttr('data-adsslot');
                			        continue;
                			    }
            			        exc($ele,msid);
            			    }
            			}else{
            			    exc($ele,msid);
            			    //if(_geo=='' && i==0)toiprops.chkGeo();
            			}
            			/********* end Geo targetted ads **************/
            		}
            		
            		
	    
	    googletag.pubads().setTargeting('sg', _auds).setTargeting('HDL', _tval(_HDL))
        .setTargeting('ARC1', _tval(_ARC1)).setTargeting('fic',_fic + '').setTargeting('SCP', SCP + '')
        .setTargeting('Hyp1', _tval(_Hyp1)).setTargeting('article', _tval(_article)).setTargeting('SCN', _SCN + '')
        .setTargeting('Tmpl_SCN', _Tmpl_SCN + '').setTargeting('LastSubSCN', _LastSubSCN + '')
        .setTargeting('SubSCN', _SubSCN + '').setTargeting('PGT', _PGT + '').setTargeting('BL', _BL + ''); 
        
        
            
            var crtg_split= (crtg_content|| '').split(';');
            var pubads = googletag.pubads();
            var cto_values= [];
            if(crtg_split.length > 0 & _geo!=1){
                for (var i=1;i<crtg_split.length;i++){
                    cto_values.push( "" + crtg_split[i-1].split('=')[1] + "");
                }
            }
            if (cto_values.length> 0 && _geo!=1) {
                pubads.setTargeting('crtotoi',cto_values);
            }
            
        
        
        googletag.pubads().enableAsyncRendering();
        googletag.pubads().collapseEmptyDivs(true);
        googletag.pubads().enableSingleRequest();
        if(addListner==0){
            googletag.pubads().addEventListener('slotRenderEnded', function(event) {
                var d,
                    adSlot = event.slot.getAdUnitPath();
                    
                if(!adSlot){
                    return;
                }
                
                d = adsSlotToUniqueKey(adSlot);
                
                if(!event.isEmpty){
                    if(trackGA[d]){
                        ga('send', 'event', _Tmpl_SCN, trackGA[d], adSlot);
                    }
                    // remove fallback ad from page if main ad successfully loaded
                    if(fallbackAds[d] && fallbackAds[d].toBeChecked && fallbackAds[d].$fallbackEls.length){
                        $.each(fallbackAds[d].$fallbackEls, function(){
                            this.remove();
                        });
                        fallbackAds[d] = null;
                    }
                }
                /* if this ad was rendered empty and needs to be checked for fallback, 
                 mark it as fallback Ad to be loaded */
                else if(fallbackAds[d] && fallbackAds[d].toBeChecked){
                    // even if innov ads says empty, but body has bgTmg class, do not load fallback sticky ad.
                    if(adSlot.indexOf('_Innov1') > -1 && $('body').hasClass('bgImg')){
                        // console.log(adSlot + ' ad rendered but returned empty in slotRenderEnded callback.');
                        if(fallbackAds[d].$fallbackEls.length){
                            $.each(fallbackAds[d].$fallbackEls, function(){
                                this.remove();
                            });
                        }
                        fallbackAds[d] = null;
                        return;
                    }
                    fallbackAds[d].toBeLoaded = true;
                    dfpFallbackAdsLoad();
                }
            });
            addListner++;
        }
        googletag.enableServices();
        
	
            		
            		for(var i=0; i<dfpads['arr'].length; i++){
            			adsid=dfpads['arr'][i];
            			googletag.display(adsid);
                        $('#'+adsid).removeAttr('data-adsSlot').removeAttr('data-adsslot');
            		}
                });
            };
            if($( "[data-adsSlot]:not([data-isactive]),[data-adsslot]:not([data-isactive])" ).length){
                _fn_execute({'containers': $( "[data-adsSlot]:not([data-isactive]),[data-adsslot]:not([data-isactive])" )});
            }
            if($( "[data-adsSlot][data-isactive],[data-adsslot][data-isactive]" ).length){
                var currentUrl;
                
                if(window.toiprops && window.toiprops.querydefault){
                    currentUrl=window.toiprops.querydefault;
                }else if(window.toiprops && window.toiprops.subsec2){
                    currentUrl=window.toiprops.subsec2;
                }else if(window.toiprops && window.toiprops.subsec1){
                    currentUrl=window.toiprops.subsec1;
                }else{
                    //currentUrl=11111;
                }
                var d = new Date();
                //since null == undefined
                if(currentUrl && (etJSONObj == null)){
                    //currentUrl = 'http://timesofindia.indiatimes.com/manageads/'+currentUrl+'.jsons?'+d.getMinutes();
                    currentUrl = 'https://toibnews.timesofindia.indiatimes.com/manageads/'+currentUrl+'.jsons?'+d.getMinutes();
                    $.ajax({
                        url: currentUrl,
                        dataType:"json",
                        cache: true,
                        success: function(result){
                             etJSONObj = result;
                            _fn_execute({'containers': $( "[data-adsSlot][data-isactive],[data-adsslot][data-isactive]" )},result);
                        },
                        error: function (xhr, ajaxOptions, thrownError) {}
                    });
                }else{
                    _fn_execute({'containers': $( "[data-adsSlot][data-isactive],[data-adsslot][data-isactive]" )},etJSONObj);
                }
            }
            
        };
        var adRefresh = function(msid){
            var regx = new RegExp(msid);
            googletag.cmd.push(function() {
                var all_slots = Object.keys(slotObj).map(function(a){
                  return (regx.test(a))?slotObj[a]:null;
                }).filter(function(a){ // Remove null elements
                    return a != null;
                });
                googletag.pubads().refresh(all_slots, {changeCorrelator: false});
                
                d = (all_slots[0] && all_slots[0].L != undefined) ? all_slots[0].L : '';
                d = adsSlotToUniqueKey(d);
                if(trackGA[d]){
                    trackGArequest(trackGA[d], _Tmpl_SCN, all_slots[0].L);
                }
            });
        }
        var adRefresh_all = function(){
            googletag.cmd.push(function() { 
                var all_slots = Object.keys(slotObj_all).map(function(a){
                  return slotObj_all[a];
                });
                googletag.pubads().refresh(all_slots, {changeCorrelator: false});
            });
        }
        var buildAdsAj = function(msid){
            
             if(!(typeof toiprops && typeof toiprops.toipr!="undefined")){
                if(msid!=''){
                    SCP++;
                    if($("[data-adsrefresh][data-adsrefresh!='all']:not([data-adsslot])").length > 0)adRefresh(msid);
                    if($("[data-adsrefresh][data-adsrefresh='all']:not([data-adsslot])").length > 0)adRefresh_all();
                }
        		adsReadTag(msid);
            }
                
                else{
			            typeof removeAds =="function" && removeAds('gpt'); 
			        }
        };
        var onScroll = adsthrottle(2000,function(){
            if($("[data-inview]").length > 0){
                buildAdsAj();}
        });
        
    
        $( document ).ready(function() {
             if(!(typeof toiprops && typeof toiprops.toipr!="undefined")){
                dfpadsLoad('default');
                inViewCtr = $("[data-inview]").length;
                $(window).scroll(function() {
                    onScroll();
                });
            }
            else{
			            typeof removeAds =="function" && removeAds('gpt'); 
			        }
            
        });
        $(window).load(function() {
            onScroll();
        });
		
		
	    
            var colombia = colombia || {};
	        colombia.fns = colombia.fns || [];
	        var ctnAds = {
                loadColombiaJS: function(){
                    
			        if(!(typeof toiprops && typeof toiprops.toipr!="undefined")) {
			            
                    var cads = document.createElement("script");
                	cads.async = true;
                	cads.type = "text/javascript";
                    cads.src = "https://static.clmbtech.com/ad/commons/js/colombia_v2.js";
                	var node = document.getElementsByTagName("script")[0];
                	node.parentNode.insertBefore(cads, node);
                    if (!Object.keys) {
                      Object.keys = function(obj) {
                        var keys = [];
                        for (var i in obj) {
                          if (obj.hasOwnProperty(i)) {
                            keys.push(i);
                          }
                        }
                        return keys;
                      };
                    }
			        }
                },
                /**
            	 * Refresh Ads
            	 *
            	 * @param identifier {string} id Attr of the ctnad div
            	 */
                refresh : function(identifier) {
                    colombia.fns.push(function() {
                        colombia.refresh(identifier);
                    });
                },
                colombiaClear : function(){
                    colombia.clear();
                },
                getCtnAdConfigParams : function($containerElem, ctnAdCp){
                    var ctnAdConfigParams = typeof(ctnAdCp)==='object'?ctnAdCp:{};
                    ctnAdConfigParams['slot'] = ctnAdConfigParams['slot']?ctnAdConfigParams['slot']:$containerElem.data('slot');
                    ctnAdConfigParams['position'] = ctnAdConfigParams['position']?ctnAdConfigParams['position']:$containerElem.data('position');
                    ctnAdConfigParams['slotType'] = $containerElem.data('slot-type');
                    ctnAdConfigParams['pos'] = $containerElem.data('pos');
                    ctnAdConfigParams['secid'] = ctnAdConfigParams['secid']?ctnAdConfigParams['secid']:(($containerElem.data('secid'))?$containerElem.data('secid'):0);
                    ctnAdConfigParams['descLen'] = ctnAdConfigParams['descLen']?ctnAdConfigParams['descLen']:$containerElem.data('desc-len');
                    ctnAdConfigParams['callback'] = ctnAdConfigParams['callback']?ctnAdConfigParams['callback']:$containerElem.data('callback');
                    ctnAdConfigParams['pgTag'] = $containerElem.data('pg-tag');
                    ctnAdConfigParams['tplId'] = ctnAdConfigParams['tplId']?ctnAdConfigParams['tplId']:($containerElem.data('native-tmpl-temp')?$containerElem.data('native-tmpl-temp'):$containerElem.data('native-tmpl'));
                    return ctnAdConfigParams;
                },
                /*
            	 * Renders HTML Template of CTNAd 
            	 * @param status {boolean} true-success to display ad and false-failure to display ad
            	 * @param callback {string} callback function name 
            	 * @param $containerElem {jquery element} ad container to be filled
            	 */
                notify : function(status, callback, $containerElem){
                    if(callback != ''){
                        try{
                            window[callback](status,$containerElem);
                        } catch(e){}
                    }
                },
                /**
            	 * Renders HTML Template of CTNAd 
            	 *
            	 * @param adsData {string} id Attr of the ctnad div
            	 * @param $containerElem {jquery element} ad container to be filled
            	 * @param ctnAdCP {object} CtnAdConfigParams object returned from getCtnAdConfigParams()
            	 */
                tmplrender : function(adsData,$containerElem,ctnAdCP){
                    try{
                        ctnAdCP = ctnAds.getCtnAdConfigParams($containerElem, ctnAdCP);
                        var tplHtml = $('#' + ctnAdCP.tplId).html();
                        $containerElem.hide().empty();
                        for(var i=0; i<adsData.length ; i++){
                            var tpl = tplHtml;
                            if(adsData[i].itemType === 4){
                                tpl = $containerElem.data('native-vid-tmpl')?$('#' + $containerElem.data('native-vid-tmpl')).html():tpl;                        
                            }
                            var nameDescTrim = ctnAdCP.descLen?((adsData[i].title + ' ' + adsData[i].text).substring(0,ctnAdCP.descLen-3) + '...'):(adsData[i].title + ' ' + adsData[i].text);
                            nameDescTrim = nameDescTrim.length<=25?nameDescTrim.substring(0,nameDescTrim.length-3):nameDescTrim;
                            var keyMap = {
                                "~url~":adsData[i].itemType===5?'#':adsData[i].clk[0],
                                "~ctaurl~":adsData[i].itemType===5?'event.preventDefault();'+adsData[i].clk[0]:'',
                                "~sImg~":adsData[i].mainimage,
                                "~wideImg~":adsData[i].extraImages[0],
                                "~name~":adsData[i].title,
                                "~desc~":(ctnAdCP.descLen?(adsData[i].text.substring(0,ctnAdCP.descLen-3) + '...'):adsData[i].text),
                                "~brandtext~":adsData[i].brandtext,
                                "~colombiaImg~":'https://static.clmbtech.com/ad/commons/images/colombia_red_small.png',
                                "~icon-colombia~":'<i class="clmcup"></i>',
                                "~name-desc~": adsData[i].title + ' ' + adsData[i].text,
                                "~name-desc-trim~": nameDescTrim,
                                "~pg-tag~": isNaN(+ctnAdCP.pgTag)?ctnAdCP.pgTag:((+ctnAdCP.pgTag)+i),
                                "~ctadiv~": adsData[i].ctaText?'<button type="button" class="ctabtn" onclick="' + adsData[i].clk[0] + '">' + adsData[i].ctaText + '</button>':'',
                                "~icon-ctn-vid~": (adsData[i].itemType===4?'<i class="sprite_bg icon_player icon_ctn_vid"></i>':''),
                                "~ctn-vid-ad-container~": (adsData[i].itemType===4?'<div class="ctn-vid-ad"><div class="ctn_loader"></div></div>':'')
                            };
                            var regExp = new RegExp("~url~",'g');
                            for(var km in keyMap){
                                try{
                                    if(keyMap.hasOwnProperty(km)){
                                        var regExp = new RegExp(km,'g');
                                        tpl= tpl.replace(regExp,keyMap[km]);
                                    }
                                }catch(e){}
                            }
                            $containerElem.append(tpl);
                            if(adsData[i].itemType === 4){
                                ctnAds.renderVideoAds($containerElem,adsData[i],ctnAdCP, keyMap["~url~"]);
                            }
                        }
                        if($containerElem.data('loop')==0 && adsData && adsData.length!=0 && adsData[0].itemType==4){
                            $containerElem.parent().hide();
                        } else{
                            $containerElem.show();
                            ctnAds.notify(true,ctnAdCP.callback,$containerElem);
                        }
                    }catch(e){console.error(e);}
                    return true;
                },
                renderVideoAds : function($containerElem,vidAdData,ctnAdCP,adLinkUrl){
                    $containerElem.find('a').attr({
                        'href':'javascript:void(0);',
                        'target':''
                    });
                    var dataSize = $containerElem.data('ad-size')?$containerElem.data('ad-size'):[0,250];
                    var dataExpansionSize = $containerElem.data('expansion-size')?$containerElem.data('expansion-size'):[0,250];
                    var iframeUrl = $containerElem.data('loop')==0?'/ads_native_video_dev.cms?ver=1':'';
                    if(dataSize && dataSize.length >= 2){
                        var existingSize = {};
                        var size = {};
                        if(dataSize[0] !== 0){
                            size['width'] = dataSize[0] + 'px';
                            size['eWidth'] = dataExpansionSize[0]?dataExpansionSize[0]:undefined;
                            existingSize['width'] = $containerElem.width() + 'px';
                        }
                        if(dataSize[1] !== 0){
                            size['height'] = dataSize[1] + 'px';
                            size['eHeight'] = dataExpansionSize[1]?dataExpansionSize[1]:undefined;
                            existingSize['height'] = $containerElem.height() + 'px';
                        }
                        
                        var vidAd = {'placeholderId': $containerElem.attr('id') + '-iframe', 'container': $containerElem.find('.ctn-vid-ad')};
                        vidAd.placeholder = $('#'+vidAd.placeholderId);
                        
                        if(!vidAd.placeholder.length){
                            vidAd.placeholder = $('<iframe></iframe>').attr({
                                'id': vidAd.placeholderId,
                                'class': 'ctn-vid-ad-iframe',
                                'width': (size.width?size.width:'100%'),
                                'height': size.height,
                                'frameborder':'0',
                                'scrolling': 'no',
                                'src': iframeUrl,
                                'style': 'display:none;background-color:#000;'
                            })
                            .data('existing-size',existingSize)
                            .load(function(){
                                if($containerElem.data('loop')!=0){
                                    $(this).show();
                                }
                                $(this).siblings('.ctn_loader').hide();
                                vidAdData.autoplay = $containerElem.data('autoplay')?1:0;
                                vidAdData.audio = $containerElem.data("audio")?1:0;
                                
                                if(this.contentWindow.colombiaVideoAd){
                                    this.contentWindow.colombiaVideoAd(vidAdData, $containerElem.attr('id')); 
                                }
                            });
                            vidAd.container.css('width',(size.width?size.width:'100%')).append(vidAd.placeholder);
                        }
                    }
                    $containerElem.on('click',function(e){
                        var containerElemId = $(this).attr('id'); 
                        if(vidAd.container.is(':hidden') || $(this).data('loop')==0){
                            if($(this).data('loop')!=0){
                                vidAd.placeholder.attr('src','/ads_native_video_dev.cms?ver=1');
                            } else{
                                vidAd.container.attr('data-played','true');                            
                                $(this).find('#'+vidAd.placeholderId).show();
                            }
                            $('.ctn-vid-ad:visible').not(vidAd.container).not('[data-loop="0"]').each(function(i,c){
                                if(!($(c).closest('#'+containerElemId).length)){
                                    $($(c).find('.ctn-vid-ad-iframe')[0].contentDocument).find('#abort-vid-ad').click();
                                }
                                
                            });
                            $containerElem.find('.hid-vid-play').fadeOut("slow", function(){
                                var animateSize = {'width': size.width, 'height':'+='+(+size.eHeight+30)};
                                $($containerElem).animate(animateSize,{duration: "slow", queue: false});
                                vidAd.container.show();
                                $(vidAd.container).animate({'height':size.height}, {duration: "slow", queue: false, 
                                    complete: function(){
                                        //vidAd.placeholder.delay( 800 ).show();
                                    }
                                });                                
                            }).delay(300);
                        }
                    });
                    //For AutoPlay on International Homepage
                    if($('.ctn-vid-ad[data-played]').length === 0 &&  $containerElem.data('autoplay') && $containerElem.data('loop')!=0){
                        $containerElem.click();
                    }
                },
                inViewCTN: function (icon) {
                    var win = $(window);
                    var viewport = {top: win.scrollTop(), left: win.scrollLeft()};
                    viewport.right = viewport.left + win.width();
                    viewport.bottom = viewport.top + win.height();
                    var height = icon.outerHeight();
                    var width = icon.outerWidth();
                    if (!width || !height) {
                        return false;
                    }
                    var bounds = icon.offset();
                    bounds.right = bounds.left + width;
                    bounds.bottom = bounds.top + height;
                    return(!(viewport.right < bounds.left || viewport.top > bounds.bottom || viewport.left > bounds.right || viewport.bottom < bounds.top));
                },
                showVideoAd: function(vidFrame,vidFrameContainer){
                    var identifier = vidFrame.attr('id');
                    if(ctnAds.inViewCTN(vidFrameContainer)){
                        $(window).off('scroll.'+identifier);
                        vidFrameContainer.click();
                    }
                },
            };
            
            $(document).ready(function() {
                $.each( $("[data-callid]"), function( key, value ) {
                  var datacallid = $(this).attr("data-callid");
                  $( this ).replaceWith( $('#'+datacallid).clone() );
                });
            });
            
            var processCtnAds = function(response, containerStr){
                var $containerElem = $('#' + containerStr);
                var ctnAdCP = ctnAds.getCtnAdConfigParams($containerElem);
                
                /*For Testing 
                 *Pass ctnfail = 1 
                 *Pass ctnfailcode = <adcode>
                 *All the CTN Ads on the page will fail
                */
                try{
                    if(window.location.hostname.match(/^toidev|^jcmsdev/)){
                        // console.log("Testing CTN Ads Failure...");
                        var urlParams = window.location.search 
                        if(urlParams.match(/[?&]ctnfail=1/)){
                            response=null;
                        } else if(urlParams.match(/[?&]ctnfailcode=[\d]+/)[0].indexOf(ctnAdCP.slot)!=-1){
                            response=null;
                        }
                    }
                } catch(e){}
                /* \For Testing*/
                
                if(response===null){
                    //console.log(containerStr + '-' + response);
                    if($containerElem.find('.content_placeholder').length != 0){
                        $containerElem.hide();
                    }
                    ctnAds.notify(false,ctnAdCP.callback,$containerElem);
                    return true;
                }
                var types = Object.keys(response);
                for(var t=0;t<types.length;t++){
                    try{
                        if(types[t].indexOf('Ads')>-1){
                            var adsData = response[types[t]];
                            if(types.length>2){
                                ctnAds.tmplrender(adsData,$containerElem.find('[data-slot-type="'+types[t]+'"]'),ctnAdCP);
                            } else{
                                ctnAds.tmplrender(adsData,$containerElem,ctnAdCP);
                            }
                        }
                    } catch(e){}
                }
                return true;
            };
            
            var colombiaVidAdStart = function(identifier){
                var vidFrame = $('#' + identifier);
                var vidFrameContainer = $('#' + identifier.replace('-iframe',''));
                if(vidFrameContainer.data('loop')==0){
                    ctnAds.notify(true,vidFrameContainer.data('callback'),vidFrameContainer);
                    if(ctnAds.inViewCTN(vidFrameContainer)){
                        ctnAds.showVideoAd(vidFrame,vidFrameContainer);
                    } else{
                        $(window).on('scroll.'+identifier,function(){
                            ctnAds.showVideoAd(vidFrame,vidFrameContainer);
                        });
                    }
                }
            };
            var colombiaVidAdComplete = function(identifier){                var vidFrame = $('#' + identifier);
                var vidFrameContainer = $('#' + identifier.replace('-iframe',''));
                var parentExistingSize = vidFrame.data('existing-size');
                //Hides the video 
                if(vidFrameContainer.data('loop') === 0){
                    //Removing slot once video is completed
                    vidFrameContainer.parent().slideUp(1000, function(){ $(this).remove();});
                } else{
                    $(vidFrameContainer).animate(parentExistingSize, "slow", function(){
                        vidFrame.hide().parent().hide().css('height','');
                        vidFrame.attr('src','');
                        vidFrameContainer.css('height','').find('.hid-vid-play').fadeIn("slow");
                    });
                }
            };
        
        
             
                $(document).ready(function() {
                    ctnAds.loadColombiaJS();
                });
            
            
	    
/*mousewheel*/
(function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);
/*custom scrollbar*/
(function(c){var b={init:function(e){var f={set_width:false,set_height:false,horizontalScroll:false,scrollInertia:950,mouseWheel:true,mouseWheelPixels:"auto",autoDraggerLength:true,autoHideScrollbar:false,alwaysShowScrollbar:false,snapAmount:null,snapOffset:0,scrollButtons:{enable:false,scrollType:"continuous",scrollSpeed:"auto",scrollAmount:40},advanced:{updateOnBrowserResize:true,updateOnContentResize:false,autoExpandHorizontalScroll:false,autoScrollOnFocus:true,normalizeMouseWheelDelta:false},contentTouchScroll:true,callbacks:{onScrollStart:function(){},onScroll:function(){},onTotalScroll:function(){},onTotalScrollBack:function(){},onTotalScrollOffset:0,onTotalScrollBackOffset:0,whileScrolling:function(){}},theme:"light"},e=c.extend(true,f,e);return this.each(function(){var m=c(this);if(e.set_width){m.css("width",e.set_width)}if(e.set_height){m.css("height",e.set_height)}if(!c(document).data("mCustomScrollbar-index")){c(document).data("mCustomScrollbar-index","1")}else{var t=parseInt(c(document).data("mCustomScrollbar-index"));c(document).data("mCustomScrollbar-index",t+1)}m.wrapInner("<div class='mCustomScrollBox mCS-"+e.theme+"' id='mCSB_"+c(document).data("mCustomScrollbar-index")+"' style='position:relative; height:100%; overflow:hidden; max-width:100%;' />").addClass("mCustomScrollbar _mCS_"+c(document).data("mCustomScrollbar-index"));var g=m.children(".mCustomScrollBox");if(e.horizontalScroll){g.addClass("mCSB_horizontal").wrapInner("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />");var k=g.children(".mCSB_h_wrapper");k.wrapInner("<div class='mCSB_container' style='position:absolute; left:0;' />").children(".mCSB_container").css({width:k.children().outerWidth(),position:"relative"}).unwrap()}else{g.wrapInner("<div class='mCSB_container' style='position:relative; top:0;' />")}var o=g.children(".mCSB_container");if(c.support.touch){o.addClass("mCS_touch")}o.after("<div class='mCSB_scrollTools' style='position:absolute;'><div class='mCSB_draggerContainer'><div class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' style='position:relative;'></div></div><div class='mCSB_draggerRail'></div></div></div>");var l=g.children(".mCSB_scrollTools"),h=l.children(".mCSB_draggerContainer"),q=h.children(".mCSB_dragger");if(e.horizontalScroll){q.data("minDraggerWidth",q.width())}else{q.data("minDraggerHeight",q.height())}if(e.scrollButtons.enable){if(e.horizontalScroll){l.prepend("<a class='mCSB_buttonLeft' oncontextmenu='return false;'></a>").append("<a class='mCSB_buttonRight' oncontextmenu='return false;'></a>")}else{l.prepend("<a class='mCSB_buttonUp' oncontextmenu='return false;'></a>").append("<a class='mCSB_buttonDown' oncontextmenu='return false;'></a>")}}g.bind("scroll",function(){if(!m.is(".mCS_disabled")){g.scrollTop(0).scrollLeft(0)}});m.data({mCS_Init:true,mCustomScrollbarIndex:c(document).data("mCustomScrollbar-index"),horizontalScroll:e.horizontalScroll,scrollInertia:e.scrollInertia,scrollEasing:"mcsEaseOut",mouseWheel:e.mouseWheel,mouseWheelPixels:e.mouseWheelPixels,autoDraggerLength:e.autoDraggerLength,autoHideScrollbar:e.autoHideScrollbar,alwaysShowScrollbar:e.alwaysShowScrollbar,snapAmount:e.snapAmount,snapOffset:e.snapOffset,scrollButtons_enable:e.scrollButtons.enable,scrollButtons_scrollType:e.scrollButtons.scrollType,scrollButtons_scrollSpeed:e.scrollButtons.scrollSpeed,scrollButtons_scrollAmount:e.scrollButtons.scrollAmount,autoExpandHorizontalScroll:e.advanced.autoExpandHorizontalScroll,autoScrollOnFocus:e.advanced.autoScrollOnFocus,normalizeMouseWheelDelta:e.advanced.normalizeMouseWheelDelta,contentTouchScroll:e.contentTouchScroll,onScrollStart_Callback:e.callbacks.onScrollStart,onScroll_Callback:e.callbacks.onScroll,onTotalScroll_Callback:e.callbacks.onTotalScroll,onTotalScrollBack_Callback:e.callbacks.onTotalScrollBack,onTotalScroll_Offset:e.callbacks.onTotalScrollOffset,onTotalScrollBack_Offset:e.callbacks.onTotalScrollBackOffset,whileScrolling_Callback:e.callbacks.whileScrolling,bindEvent_scrollbar_drag:false,bindEvent_content_touch:false,bindEvent_scrollbar_click:false,bindEvent_mousewheel:false,bindEvent_buttonsContinuous_y:false,bindEvent_buttonsContinuous_x:false,bindEvent_buttonsPixels_y:false,bindEvent_buttonsPixels_x:false,bindEvent_focusin:false,bindEvent_autoHideScrollbar:false,mCSB_buttonScrollRight:false,mCSB_buttonScrollLeft:false,mCSB_buttonScrollDown:false,mCSB_buttonScrollUp:false});if(e.horizontalScroll){if(m.css("max-width")!=="none"){if(!e.advanced.updateOnContentResize){e.advanced.updateOnContentResize=true}}}else{if(m.css("max-height")!=="none"){var s=false,r=parseInt(m.css("max-height"));if(m.css("max-height").indexOf("%")>=0){s=r,r=m.parent().height()*s/100}m.css("overflow","hidden");g.css("max-height",r)}}m.mCustomScrollbar("update");if(e.advanced.updateOnBrowserResize){var i,j=c(window).width(),u=c(window).height();c(window).bind("resize."+m.data("mCustomScrollbarIndex"),function(){if(i){clearTimeout(i)}i=setTimeout(function(){if(!m.is(".mCS_disabled")&&!m.is(".mCS_destroyed")){var w=c(window).width(),v=c(window).height();if(j!==w||u!==v){if(m.css("max-height")!=="none"&&s){g.css("max-height",m.parent().height()*s/100)}m.mCustomScrollbar("update");j=w;u=v}}},150)})}if(e.advanced.updateOnContentResize){var p;if(e.horizontalScroll){var n=o.outerWidth()}else{var n=o.outerHeight()}p=setInterval(function(){if(e.horizontalScroll){if(e.advanced.autoExpandHorizontalScroll){o.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:o.outerWidth(),position:"relative"}).unwrap()}var v=o.outerWidth()}else{var v=o.outerHeight()}if(v!=n){m.mCustomScrollbar("update");n=v}},300)}})},update:function(){var n=c(this),k=n.children(".mCustomScrollBox"),q=k.children(".mCSB_container");q.removeClass("mCS_no_scrollbar");n.removeClass("mCS_disabled mCS_destroyed");k.scrollTop(0).scrollLeft(0);var y=k.children(".mCSB_scrollTools"),o=y.children(".mCSB_draggerContainer"),m=o.children(".mCSB_dragger");if(n.data("horizontalScroll")){var A=y.children(".mCSB_buttonLeft"),t=y.children(".mCSB_buttonRight"),f=k.width();if(n.data("autoExpandHorizontalScroll")){q.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:q.outerWidth(),position:"relative"}).unwrap()}var z=q.outerWidth()}else{var w=y.children(".mCSB_buttonUp"),g=y.children(".mCSB_buttonDown"),r=k.height(),i=q.outerHeight()}if(i>r&&!n.data("horizontalScroll")){y.css("display","block");var s=o.height();if(n.data("autoDraggerLength")){var u=Math.round(r/i*s),l=m.data("minDraggerHeight");if(u<=l){m.css({height:l})}else{if(u>=s-10){var p=s-10;m.css({height:p})}else{m.css({height:u})}}m.children(".mCSB_dragger_bar").css({"line-height":m.height()+"px"})}var B=m.height(),x=(i-r)/(s-B);n.data("scrollAmount",x).mCustomScrollbar("scrolling",k,q,o,m,w,g,A,t);var D=Math.abs(q.position().top);n.mCustomScrollbar("scrollTo",D,{scrollInertia:0,trigger:"internal"})}else{if(z>f&&n.data("horizontalScroll")){y.css("display","block");var h=o.width();if(n.data("autoDraggerLength")){var j=Math.round(f/z*h),C=m.data("minDraggerWidth");if(j<=C){m.css({width:C})}else{if(j>=h-10){var e=h-10;m.css({width:e})}else{m.css({width:j})}}}var v=m.width(),x=(z-f)/(h-v);n.data("scrollAmount",x).mCustomScrollbar("scrolling",k,q,o,m,w,g,A,t);var D=Math.abs(q.position().left);n.mCustomScrollbar("scrollTo",D,{scrollInertia:0,trigger:"internal"})}else{k.unbind("mousewheel focusin");if(n.data("horizontalScroll")){m.add(q).css("left",0)}else{m.add(q).css("top",0)}if(n.data("alwaysShowScrollbar")){if(!n.data("horizontalScroll")){m.css({height:o.height()})}else{if(n.data("horizontalScroll")){m.css({width:o.width()})}}}else{y.css("display","none");q.addClass("mCS_no_scrollbar")}n.data({bindEvent_mousewheel:false,bindEvent_focusin:false})}}},scrolling:function(i,q,n,k,A,f,D,w){var l=c(this);if(!l.data("bindEvent_scrollbar_drag")){var o,p,C,z,e;if(c.support.pointer){C="pointerdown";z="pointermove";e="pointerup"}else{if(c.support.msPointer){C="MSPointerDown";z="MSPointerMove";e="MSPointerUp"}}if(c.support.pointer||c.support.msPointer){k.bind(C,function(K){K.preventDefault();l.data({on_drag:true});k.addClass("mCSB_dragger_onDrag");var J=c(this),M=J.offset(),I=K.originalEvent.pageX-M.left,L=K.originalEvent.pageY-M.top;if(I<J.width()&&I>0&&L<J.height()&&L>0){o=L;p=I}});c(document).bind(z+"."+l.data("mCustomScrollbarIndex"),function(K){K.preventDefault();if(l.data("on_drag")){var J=k,M=J.offset(),I=K.originalEvent.pageX-M.left,L=K.originalEvent.pageY-M.top;G(o,p,L,I)}}).bind(e+"."+l.data("mCustomScrollbarIndex"),function(x){l.data({on_drag:false});k.removeClass("mCSB_dragger_onDrag")})}else{k.bind("mousedown touchstart",function(K){K.preventDefault();K.stopImmediatePropagation();var J=c(this),N=J.offset(),I,M;if(K.type==="touchstart"){var L=K.originalEvent.touches[0]||K.originalEvent.changedTouches[0];I=L.pageX-N.left;M=L.pageY-N.top}else{l.data({on_drag:true});k.addClass("mCSB_dragger_onDrag");I=K.pageX-N.left;M=K.pageY-N.top}if(I<J.width()&&I>0&&M<J.height()&&M>0){o=M;p=I}}).bind("touchmove",function(K){K.preventDefault();K.stopImmediatePropagation();var N=K.originalEvent.touches[0]||K.originalEvent.changedTouches[0],J=c(this),M=J.offset(),I=N.pageX-M.left,L=N.pageY-M.top;G(o,p,L,I)});c(document).bind("mousemove."+l.data("mCustomScrollbarIndex"),function(K){if(l.data("on_drag")){var J=k,M=J.offset(),I=K.pageX-M.left,L=K.pageY-M.top;G(o,p,L,I)}}).bind("mouseup."+l.data("mCustomScrollbarIndex"),function(x){l.data({on_drag:false});k.removeClass("mCSB_dragger_onDrag")})}l.data({bindEvent_scrollbar_drag:true})}function G(J,K,L,I){if(l.data("horizontalScroll")){l.mCustomScrollbar("scrollTo",(k.position().left-(K))+I,{moveDragger:true,trigger:"internal"})}else{l.mCustomScrollbar("scrollTo",(k.position().top-(J))+L,{moveDragger:true,trigger:"internal"})}}if(c.support.touch&&l.data("contentTouchScroll")){if(!l.data("bindEvent_content_touch")){var m,E,s,t,v,F,H;q.bind("touchstart",function(x){x.stopImmediatePropagation();m=x.originalEvent.touches[0]||x.originalEvent.changedTouches[0];E=c(this);s=E.offset();v=m.pageX-s.left;t=m.pageY-s.top;F=t;H=v});q.bind("touchmove",function(x){x.preventDefault();x.stopImmediatePropagation();m=x.originalEvent.touches[0]||x.originalEvent.changedTouches[0];E=c(this).parent();s=E.offset();v=m.pageX-s.left;t=m.pageY-s.top;if(l.data("horizontalScroll")){l.mCustomScrollbar("scrollTo",H-v,{trigger:"internal"})}else{l.mCustomScrollbar("scrollTo",F-t,{trigger:"internal"})}})}}if(!l.data("bindEvent_scrollbar_click")){n.bind("click",function(I){var x=(I.pageY-n.offset().top)*l.data("scrollAmount"),y=c(I.target);if(l.data("horizontalScroll")){x=(I.pageX-n.offset().left)*l.data("scrollAmount")}if(y.hasClass("mCSB_draggerContainer")||y.hasClass("mCSB_draggerRail")){l.mCustomScrollbar("scrollTo",x,{trigger:"internal",scrollEasing:"draggerRailEase"})}});l.data({bindEvent_scrollbar_click:true})}if(l.data("mouseWheel")){if(!l.data("bindEvent_mousewheel")){i.bind("mousewheel",function(K,M){var J,I=l.data("mouseWheelPixels"),x=Math.abs(q.position().top),L=k.position().top,y=n.height()-k.height();if(l.data("normalizeMouseWheelDelta")){if(M<0){M=-1}else{M=1}}if(I==="auto"){I=100+Math.round(l.data("scrollAmount")/2)}if(l.data("horizontalScroll")){L=k.position().left;y=n.width()-k.width();x=Math.abs(q.position().left)}if((M>0&&L!==0)||(M<0&&L!==y)){K.preventDefault();K.stopImmediatePropagation()}J=x-(M*I);l.mCustomScrollbar("scrollTo",J,{trigger:"internal"})});l.data({bindEvent_mousewheel:true})}}if(l.data("scrollButtons_enable")){if(l.data("scrollButtons_scrollType")==="pixels"){if(l.data("horizontalScroll")){w.add(D).unbind("mousedown touchstart MSPointerDown pointerdown mouseup MSPointerUp pointerup mouseout MSPointerOut pointerout touchend",j,h);l.data({bindEvent_buttonsContinuous_x:false});if(!l.data("bindEvent_buttonsPixels_x")){w.bind("click",function(x){x.preventDefault();r(Math.abs(q.position().left)+l.data("scrollButtons_scrollAmount"))});D.bind("click",function(x){x.preventDefault();r(Math.abs(q.position().left)-l.data("scrollButtons_scrollAmount"))});l.data({bindEvent_buttonsPixels_x:true})}}else{f.add(A).unbind("mousedown touchstart MSPointerDown pointerdown mouseup MSPointerUp pointerup mouseout MSPointerOut pointerout touchend",j,h);l.data({bindEvent_buttonsContinuous_y:false});if(!l.data("bindEvent_buttonsPixels_y")){f.bind("click",function(x){x.preventDefault();r(Math.abs(q.position().top)+l.data("scrollButtons_scrollAmount"))});A.bind("click",function(x){x.preventDefault();r(Math.abs(q.position().top)-l.data("scrollButtons_scrollAmount"))});l.data({bindEvent_buttonsPixels_y:true})}}function r(x){if(!k.data("preventAction")){k.data("preventAction",true);l.mCustomScrollbar("scrollTo",x,{trigger:"internal"})}}}else{if(l.data("horizontalScroll")){w.add(D).unbind("click");l.data({bindEvent_buttonsPixels_x:false});if(!l.data("bindEvent_buttonsContinuous_x")){w.bind("mousedown touchstart MSPointerDown pointerdown",function(y){y.preventDefault();var x=B();l.data({mCSB_buttonScrollRight:setInterval(function(){l.mCustomScrollbar("scrollTo",Math.abs(q.position().left)+x,{trigger:"internal",scrollEasing:"easeOutCirc"})},17)})});var j=function(x){x.preventDefault();clearInterval(l.data("mCSB_buttonScrollRight"))};w.bind("mouseup touchend MSPointerUp pointerup mouseout MSPointerOut pointerout",j);D.bind("mousedown touchstart MSPointerDown pointerdown",function(y){y.preventDefault();var x=B();l.data({mCSB_buttonScrollLeft:setInterval(function(){l.mCustomScrollbar("scrollTo",Math.abs(q.position().left)-x,{trigger:"internal",scrollEasing:"easeOutCirc"})},17)})});var h=function(x){x.preventDefault();clearInterval(l.data("mCSB_buttonScrollLeft"))};D.bind("mouseup touchend MSPointerUp pointerup mouseout MSPointerOut pointerout",h);l.data({bindEvent_buttonsContinuous_x:true})}}else{f.add(A).unbind("click");l.data({bindEvent_buttonsPixels_y:false});if(!l.data("bindEvent_buttonsContinuous_y")){f.bind("mousedown touchstart MSPointerDown pointerdown",function(y){y.preventDefault();var x=B();l.data({mCSB_buttonScrollDown:setInterval(function(){l.mCustomScrollbar("scrollTo",Math.abs(q.position().top)+x,{trigger:"internal",scrollEasing:"easeOutCirc"})},17)})});var u=function(x){x.preventDefault();clearInterval(l.data("mCSB_buttonScrollDown"))};f.bind("mouseup touchend MSPointerUp pointerup mouseout MSPointerOut pointerout",u);A.bind("mousedown touchstart MSPointerDown pointerdown",function(y){y.preventDefault();var x=B();l.data({mCSB_buttonScrollUp:setInterval(function(){l.mCustomScrollbar("scrollTo",Math.abs(q.position().top)-x,{trigger:"internal",scrollEasing:"easeOutCirc"})},17)})});var g=function(x){x.preventDefault();clearInterval(l.data("mCSB_buttonScrollUp"))};A.bind("mouseup touchend MSPointerUp pointerup mouseout MSPointerOut pointerout",g);l.data({bindEvent_buttonsContinuous_y:true})}}function B(){var x=l.data("scrollButtons_scrollSpeed");if(l.data("scrollButtons_scrollSpeed")==="auto"){x=Math.round((l.data("scrollInertia")+100)/40)}return x}}}if(l.data("autoScrollOnFocus")){if(!l.data("bindEvent_focusin")){i.bind("focusin",function(){i.scrollTop(0).scrollLeft(0);var x=c(document.activeElement);if(x.is("input,textarea,select,button,a[tabindex],area,object")){var J=q.position().top,y=x.position().top,I=i.height()-x.outerHeight();if(l.data("horizontalScroll")){J=q.position().left;y=x.position().left;I=i.width()-x.outerWidth()}if(J+y<0||J+y>I){l.mCustomScrollbar("scrollTo",y,{trigger:"internal"})}}});l.data({bindEvent_focusin:true})}}if(l.data("autoHideScrollbar")&&!l.data("alwaysShowScrollbar")){if(!l.data("bindEvent_autoHideScrollbar")){i.bind("mouseenter",function(x){i.addClass("mCS-mouse-over");d.showScrollbar.call(i.children(".mCSB_scrollTools"))}).bind("mouseleave touchend",function(x){i.removeClass("mCS-mouse-over");if(x.type==="mouseleave"){d.hideScrollbar.call(i.children(".mCSB_scrollTools"))}});l.data({bindEvent_autoHideScrollbar:true})}}},scrollTo:function(e,f){var i=c(this),o={moveDragger:false,trigger:"external",callbacks:true,scrollInertia:i.data("scrollInertia"),scrollEasing:i.data("scrollEasing")},f=c.extend(o,f),p,g=i.children(".mCustomScrollBox"),k=g.children(".mCSB_container"),r=g.children(".mCSB_scrollTools"),j=r.children(".mCSB_draggerContainer"),h=j.children(".mCSB_dragger"),t=draggerSpeed=f.scrollInertia,q,s,m,l;if(!k.hasClass("mCS_no_scrollbar")){i.data({mCS_trigger:f.trigger});if(i.data("mCS_Init")){f.callbacks=false}if(e||e===0){if(typeof(e)==="number"){if(f.moveDragger){p=e;if(i.data("horizontalScroll")){e=h.position().left*i.data("scrollAmount")}else{e=h.position().top*i.data("scrollAmount")}draggerSpeed=0}else{p=e/i.data("scrollAmount")}}else{if(typeof(e)==="string"){var v;if(e==="top"){v=0}else{if(e==="bottom"&&!i.data("horizontalScroll")){v=k.outerHeight()-g.height()}else{if(e==="left"){v=0}else{if(e==="right"&&i.data("horizontalScroll")){v=k.outerWidth()-g.width()}else{if(e==="first"){v=i.find(".mCSB_container").find(":first")}else{if(e==="last"){v=i.find(".mCSB_container").find(":last")}else{v=i.find(e)}}}}}}if(v.length===1){if(i.data("horizontalScroll")){e=v.position().left}else{e=v.position().top}p=e/i.data("scrollAmount")}else{p=e=v}}}if(i.data("horizontalScroll")){if(i.data("onTotalScrollBack_Offset")){s=-i.data("onTotalScrollBack_Offset")}if(i.data("onTotalScroll_Offset")){l=g.width()-k.outerWidth()+i.data("onTotalScroll_Offset")}if(p<0){p=e=0;clearInterval(i.data("mCSB_buttonScrollLeft"));if(!s){q=true}}else{if(p>=j.width()-h.width()){p=j.width()-h.width();e=g.width()-k.outerWidth();clearInterval(i.data("mCSB_buttonScrollRight"));if(!l){m=true}}else{e=-e}}var n=i.data("snapAmount");if(n){e=Math.round(e/n)*n-i.data("snapOffset")}d.mTweenAxis.call(this,h[0],"left",Math.round(p),draggerSpeed,f.scrollEasing);d.mTweenAxis.call(this,k[0],"left",Math.round(e),t,f.scrollEasing,{onStart:function(){if(f.callbacks&&!i.data("mCS_tweenRunning")){u("onScrollStart")}if(i.data("autoHideScrollbar")&&!i.data("alwaysShowScrollbar")){d.showScrollbar.call(r)}},onUpdate:function(){if(f.callbacks){u("whileScrolling")}},onComplete:function(){if(f.callbacks){u("onScroll");if(q||(s&&k.position().left>=s)){u("onTotalScrollBack")}if(m||(l&&k.position().left<=l)){u("onTotalScroll")}}h.data("preventAction",false);i.data("mCS_tweenRunning",false);if(i.data("autoHideScrollbar")&&!i.data("alwaysShowScrollbar")){if(!g.hasClass("mCS-mouse-over")){d.hideScrollbar.call(r)}}}})}else{if(i.data("onTotalScrollBack_Offset")){s=-i.data("onTotalScrollBack_Offset")}if(i.data("onTotalScroll_Offset")){l=g.height()-k.outerHeight()+i.data("onTotalScroll_Offset")}if(p<0){p=e=0;clearInterval(i.data("mCSB_buttonScrollUp"));if(!s){q=true}}else{if(p>=j.height()-h.height()){p=j.height()-h.height();e=g.height()-k.outerHeight();clearInterval(i.data("mCSB_buttonScrollDown"));if(!l){m=true}}else{e=-e}}var n=i.data("snapAmount");if(n){e=Math.round(e/n)*n-i.data("snapOffset")}d.mTweenAxis.call(this,h[0],"top",Math.round(p),draggerSpeed,f.scrollEasing);d.mTweenAxis.call(this,k[0],"top",Math.round(e),t,f.scrollEasing,{onStart:function(){if(f.callbacks&&!i.data("mCS_tweenRunning")){u("onScrollStart")}if(i.data("autoHideScrollbar")&&!i.data("alwaysShowScrollbar")){d.showScrollbar.call(r)}},onUpdate:function(){if(f.callbacks){u("whileScrolling")}},onComplete:function(){if(f.callbacks){u("onScroll");if(q||(s&&k.position().top>=s)){u("onTotalScrollBack")}if(m||(l&&k.position().top<=l)){u("onTotalScroll")}}h.data("preventAction",false);i.data("mCS_tweenRunning",false);if(i.data("autoHideScrollbar")&&!i.data("alwaysShowScrollbar")){if(!g.hasClass("mCS-mouse-over")){d.hideScrollbar.call(r)}}}})}if(i.data("mCS_Init")){i.data({mCS_Init:false})}}}function u(w){if(i.data("mCustomScrollbarIndex")){this.mcs={top:k.position().top,left:k.position().left,draggerTop:h.position().top,draggerLeft:h.position().left,topPct:Math.round((100*Math.abs(k.position().top))/Math.abs(k.outerHeight()-g.height())),leftPct:Math.round((100*Math.abs(k.position().left))/Math.abs(k.outerWidth()-g.width()))};switch(w){case"onScrollStart":i.data("mCS_tweenRunning",true).data("onScrollStart_Callback").call(i,this.mcs);break;case"whileScrolling":i.data("whileScrolling_Callback").call(i,this.mcs);break;case"onScroll":i.data("onScroll_Callback").call(i,this.mcs);break;case"onTotalScrollBack":i.data("onTotalScrollBack_Callback").call(i,this.mcs);break;case"onTotalScroll":i.data("onTotalScroll_Callback").call(i,this.mcs);break}}}},stop:function(){var g=c(this),e=g.children().children(".mCSB_container"),f=g.children().children().children().children(".mCSB_dragger");d.mTweenAxisStop.call(this,e[0]);d.mTweenAxisStop.call(this,f[0])},disable:function(e){var j=c(this),f=j.children(".mCustomScrollBox"),h=f.children(".mCSB_container"),g=f.children(".mCSB_scrollTools"),i=g.children().children(".mCSB_dragger");f.unbind("mousewheel focusin mouseenter mouseleave touchend");h.unbind("touchstart touchmove");if(e){if(j.data("horizontalScroll")){i.add(h).css("left",0)}else{i.add(h).css("top",0)}}g.css("display","none");h.addClass("mCS_no_scrollbar");j.data({bindEvent_mousewheel:false,bindEvent_focusin:false,bindEvent_content_touch:false,bindEvent_autoHideScrollbar:false}).addClass("mCS_disabled")},destroy:function(){var e=c(this);e.removeClass("mCustomScrollbar _mCS_"+e.data("mCustomScrollbarIndex")).addClass("mCS_destroyed").children().children(".mCSB_container").unwrap().children().unwrap().siblings(".mCSB_scrollTools").remove();c(document).unbind("mousemove."+e.data("mCustomScrollbarIndex")+" mouseup."+e.data("mCustomScrollbarIndex")+" MSPointerMove."+e.data("mCustomScrollbarIndex")+" MSPointerUp."+e.data("mCustomScrollbarIndex"));c(window).unbind("resize."+e.data("mCustomScrollbarIndex"))}},d={showScrollbar:function(){this.stop().animate({opacity:1},"fast")},hideScrollbar:function(){this.stop().animate({opacity:0},"fast")},mTweenAxis:function(g,i,h,f,o,y){var y=y||{},v=y.onStart||function(){},p=y.onUpdate||function(){},w=y.onComplete||function(){};var n=t(),l,j=0,r=g.offsetTop,s=g.style;if(i==="left"){r=g.offsetLeft}var m=h-r;q();e();function t(){if(window.performance&&window.performance.now){return window.performance.now()}else{if(window.performance&&window.performance.webkitNow){return window.performance.webkitNow()}else{if(Date.now){return Date.now()}else{return new Date().getTime()}}}}function x(){if(!j){v.call()}j=t()-n;u();if(j>=g._time){g._time=(j>g._time)?j+l-(j-g._time):j+l-1;if(g._time<j+1){g._time=j+1}}if(g._time<f){g._id=_request(x)}else{w.call()}}function u(){if(f>0){g.currVal=k(g._time,r,m,f,o);s[i]=Math.round(g.currVal)+"px"}else{s[i]=h+"px"}p.call()}function e(){l=1000/60;g._time=j+l;_request=(!window.requestAnimationFrame)?function(z){u();return setTimeout(z,0.01)}:window.requestAnimationFrame;g._id=_request(x)}function q(){if(g._id==null){return}if(!window.requestAnimationFrame){clearTimeout(g._id)}else{window.cancelAnimationFrame(g._id)}g._id=null}function k(B,A,F,E,C){switch(C){case"linear":return F*B/E+A;break;case"easeOutQuad":B/=E;return -F*B*(B-2)+A;break;case"easeInOutQuad":B/=E/2;if(B<1){return F/2*B*B+A}B--;return -F/2*(B*(B-2)-1)+A;break;case"easeOutCubic":B/=E;B--;return F*(B*B*B+1)+A;break;case"easeOutQuart":B/=E;B--;return -F*(B*B*B*B-1)+A;break;case"easeOutQuint":B/=E;B--;return F*(B*B*B*B*B+1)+A;break;case"easeOutCirc":B/=E;B--;return F*Math.sqrt(1-B*B)+A;break;case"easeOutSine":return F*Math.sin(B/E*(Math.PI/2))+A;break;case"easeOutExpo":return F*(-Math.pow(2,-10*B/E)+1)+A;break;case"mcsEaseOut":var D=(B/=E)*B,z=D*B;return A+F*(0.499999999999997*z*D+-2.5*D*D+5.5*z+-6.5*D+4*B);break;case"draggerRailEase":B/=E/2;if(B<1){return F/2*B*B*B+A}B-=2;return F/2*(B*B*B+2)+A;break}}},mTweenAxisStop:function(e){if(e._id==null){return}if(!window.requestAnimationFrame){clearTimeout(e._id)}else{window.cancelAnimationFrame(e._id)}e._id=null},rafPolyfill:function(){var f=["ms","moz","webkit","o"],e=f.length;while(--e>-1&&!window.requestAnimationFrame){window.requestAnimationFrame=window[f[e]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[f[e]+"CancelAnimationFrame"]||window[f[e]+"CancelRequestAnimationFrame"]}}};d.rafPolyfill.call();c.support.touch=!!("ontouchstart" in window);c.support.pointer=window.navigator.pointerEnabled;c.support.msPointer=window.navigator.msPointerEnabled;var a=("https:"==document.location.protocol)?"https:":"http:";c.event.special.mousewheel||document.write('<script src="'+a+'//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.0.6/jquery.mousewheel.min.js"><\/script>');c.fn.mCustomScrollbar=function(e){if(b[e]){return b[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return b.init.apply(this,arguments)}else{c.error("Method "+e+" does not exist")}}}})(jQuery);

	
	
	define("toiwe",["jquery"],function($) {
	    var toiwe = {};
    	toiwe.showPopup=function(html,overlay,width,height) {
            var htm='<div class="popbox" style="display:none;">';
            if(overlay===true) {
                htm+='<div class="overlaybox"></div>';
            }
            htm+='<div class="popupbox"><span class="close"></span>';
            htm+=html;
            htm+='</div></div>';
            $("body").append(htm);
            $(".popbox").fadeIn(500);
        }
        
        $("body").on("click",".popupbox .close",function(){
            var popbox=$(this).parent().parent();
            popbox.fadeOut(500,function(){
                popbox.remove();
            });
        });
        return toiwe;
	});
	
    
	
	/* Social Sharing */
	define("ui_socialshare",["jquery","ui","event","load","toiwe"],function($,ui,event,load,toiwe){
	$.fn.socialShare = function(options) {
    	var toiws=$(this); //Main Element
		// This is the easiest way to have default options.
		var s = $.extend({},{
			// These are the defaults.
			/*
			header:"#header", //Page Header Class *Mandatory for Sticky
			footer:"#footer", //Page Footer Class *Mandatory for Sticky
			topholder:"#socialbuttons", //Top Holder DIV ID for Social Buttons - Container if available in page will override sticky rule *Mandatory for Sticky
			element:"article-social", //Class Assigned to Share Buttons
			c_sticky:"sticky", //Sticky Class *Mandatory for Sticky
			c_maxbottom:"maxbottom", //Class used for page bottom
			c_ceclass:"toishare", //Class used for icons rendered
			c_sprite:"article-sprite", //Sprite Class
			c_font:"main-content",
			i_comment:"write", //comments ID
			pgtag:"pgtag", //PgTag of inner icons
			position:"position", //Widget Position*/
            pg_prefix:'',
			fontdefaultsize:100,
			fontchangesize:5,
			t_cetag:"span", //Tag used for rendering icons
			icons:"fb,twitter,gplus,linkedin,pinterest,save,email,comment,print,fonti,fontd,comment-slider", //icons
			enableSticky:false, 
			c_name:$(this).selector,
			msid:window.msid,
			href:window.location.href,
			twt_short_url: window.location.href,
            twt_via: '',
            twt_hash: '',
    	    image:$("meta[property='og:image']").attr("content"),
			title:$("title:eq(0)").text()
		}, options );
		if(s.enableSticky===true) {
            event.subscribe("window.scroll", function () {
                var header=$(s.header);
                var footer=$(s.footer);
                var topholder=$(s.topholder);
                var element=$("."+s.element+":first");
                if(ui.inView(topholder,true,0) || ui.inView(header,true,0)) { //returns boolean
                    element.removeClass(s.c_sticky);
                    element.removeClass(s.c_maxbottom);
                //} else if(($(".article-social").offset().top) + $(".article-social").height() > $("#socialbuttonsbottom").offset().top) {
                } else if (ui.inView(footer,true,0)) { //returns boolean
                    element.removeClass(s.c_sticky);
                    element.addClass(s.c_maxbottom);
                } else {
                    element.removeClass(s.c_maxbottom);
                    element.addClass(s.c_sticky);
                }
            });
		}
    	var toiwso={};
        $.each(toiws, function(key,val) {
    	    toiw_s=$(this);
        	toiwso.title=(toiw_s.data("title") || s.title); //Child Element Tag
        	toiwso.href=(toiw_s.data("href") || s.href); //Child Element Tag
            if(toiw_s.data("href")) {
        	    toiwso.href=(toiw_s.data("href")); //Child Element Tag
        	}
        	
        	toiwso.msid = s.msid;
        	toiwso.image = s.image;
        	toiwso.cetag=s.t_cetag; //Child Element Tag
        	toiwso.ceclass=s.c_sprite; //Child Element Class
        	toiwso.fontele=$("."+s.c_font);
        	toiwso.c_font_attr = s.c_font_attr;
        	if(toiwso.fontele && toiwso.fontele.length>0) {
        	    if(s.c_font_attr && (typeof toiwso.fontele.attr('data-font') !="undefined")){
        	        toiwso.fontsize = +toiwso.fontele.attr('data-font');
        	    }else{
        	        toiwso.fontsize=parseInt(toiwso.fontele.css("font-size").slice(0,-2));
        	    }
        	} else {
        	    toiwso.fontsize=s.fontdefaultsize;
        	}
        	if(s.c_ceclass && s.c_ceclass!="") {
        	    toiwso.ceclass+=" "+s.c_ceclass;
        	}
        	toiwso.pg=s.pgtag;//toiw_s.data("pgtag");
        	toiwso.pg_prefix=s.pg_prefix;
        	
        	toiwso.twt_short_url = s.twt_short_url;
            toiwso.twt_via = s.twt_via;
            toiwso.twt_hash  = s.twt_hash;
        	//toiwso.pageurl=toiw_s.data("pageurl");
        	toiwso.op="";
        	toiwso.options=(toiw_s.data("icons") || s.icons);
        	toiwso.options=toiwso.options.split(",");
        	$.each(toiwso.options, function(key,val) {
        	    toiwso.e=$("<"+toiwso.cetag+"/>");
        	    toiwso.e.addClass(val);
        	    toiwso.e.attr("data-type",val);
        	    if(toiwso.ceclass && toiwso.ceclass!='') {
        	        toiwso.e.addClass(toiwso.ceclass);
        	    }
        	    if(toiwso.pg && toiwso.pg!='') {
        	        if(val=="email"){
        	            toiwso.e.attr("pg",toiwso.pg_prefix+"Share#"+toiwso.pg_prefix+val+"#"+toiwso.pg_prefix+toiwso.href);
        	        }else{
        	            toiwso.e.attr("pg",toiwso.pg_prefix+toiwso.pg+"#"+toiwso.pg_prefix+val+"#"+toiwso.pg_prefix+toiwso.href);
        	        }
        	    }
        	    if(toiwso.href && toiwso.href.length>0) {
          	           	        switch(val) {
        	        case "fb":
        	            toiwso.e.attr("data-url",toiwso.href+'?utm_source=facebook.com&utm_medium=social&utm_campaign=TOIDesktop');
        	        break;
        	        case "twitter":
        	            toiwso.e.attr("data-url",toiwso.href+'?utm_source=twitter.com&utm_medium=social&utm_campaign=TOIDesktop');
        	            if(toiwso.twt_short_url){
        		            toiwso.e.attr("data-url",toiwso.twt_short_url+'/a24gk');
        	            }
        	        break;
        	        case "gplus":
        	            toiwso.e.attr("data-url",toiwso.href+'?utm_source=plus.google.com&utm_medium=social&utm_campaign=TOIDesktop');
        	        break;
        	        case "linkedin":
        	            toiwso.e.attr("data-url",toiwso.href+'?utm_source=linkedin.com&utm_medium=social&utm_campaign=TOIDesktop');
        	        break;
        	        case "pinterest":
        	            toiwso.e.attr("data-url",toiwso.href+'?utm_source=pinterest.com&utm_medium=social&utm_campaign=TOIDesktop');
        	        break;
        	        case "email":
        	            toiwso.e.attr("data-url",toiwso.href+'?utm_source=email&utm_medium=email&utm_campaign=TOIDesktop');
        	        break;  
        	        default:
        	       // toiwso.e.attr("data-url",toiwso.href);
                   toiwso.e.attr("data-url",toiwso.href+'?utm_source=others&amp;utm_medium=social&amp;utm_campaign=TOIDesktop');
        	           	        }
        	    }
        	    switch(val) {
        	        case "fb":
        	            toiwso.e.attr("data-plugin","facebook-share");
        	        break;
        	        case "twitter":
        	            toiwso.e.attr("data-plugin","twitter-share");
        	            
        	            if(toiwso.twt_hash.length){
        	                toiwso.title +=" "+toiwso.twt_hash;
        	            }
        	            
        	            toiwso.e.attr("data-title",toiwso.title);
        	            if(toiwso.twt_via.length){
        	                toiwso.e.attr("data-via",toiwso.twt_via);
        	            }
        	            
        	            if(toiwso.twt_short_url){
        		            toiwso.e.attr("data-url",toiwso.twt_short_url+'/a24gk');
        	            }
        	        break;
        	        case "gplus":
        	            toiwso.e.attr("data-plugin","googleplus-share");
        	        break;
        	        case "linkedin":
        	            toiwso.e.attr("data-plugin","linkedin-share");
        	        break;
        	        case "pinterest":
        	            toiwso.e.attr("data-plugin","pinterest-share");
        	            if(toiwso.image && toiwso.image!='') {
        	                toiwso.e.attr("data-image",toiwso.image);
        	            }
        	        break;
        	        case "comment-slider":
        	            toiwso.e.attr("data-plugin","show-comments");
    	            break;
        	    }
        	    toiw_s.append(toiwso.e);
            });
    	});
    	$(s.c_name+" ."+s.c_ceclass).on("click",function(){
    	    switch($(this).data("type")) {
    	        case "save":
    	            pop_save();
    	        break;
    	        case "email":
    	            pop_email();
    	        break;
    	        case "comment":
    	            scrollToComments();
    	        break;
    	        case "print":
    	            if(typeof s.print_url != "undefined"){
    	                var win = window.open(s.print_url, '_blank');
                        win.focus();
    	            } else {
    	                window.print();
    	            }
    	        break;
    	        case "fonti":
    	        if(toiwso.fontele && toiwso.fontele.length>0) {
    	            if(toiwso.fontsize < 13){
    	                if(typeof toiwso.c_font_attr !="undefined" && toiwso.c_font_attr){
    	                    toiwso.fontele.attr('data-font',++toiwso.fontsize);
    	                }
    	                else{
    	                    toiwso.fontele.css("font-size",++toiwso.fontsize);
    	                }
    	                if(window.localStorage){
    	                    window.localStorage.setItem('article-fsize',toiwso.fontsize);
    	                }
    	            }
    	        }
	            break;
	            case "fontd":
        	    if(toiwso.fontele && toiwso.fontele.length>0) {
        	        if(toiwso.fontsize > 9){
        	            if(typeof toiwso.c_font_attr !="undefined" && toiwso.c_font_attr){
        	                toiwso.fontele.attr('data-font',--toiwso.fontsize);
    	                }
    	                else{
    	                    toiwso.fontele.css("font-size",--toiwso.fontsize);
    	                }
    	                if(window.localStorage){
    	                    window.localStorage.setItem('article-fsize',toiwso.fontsize);
    	                }
        	        }
        	    }
	            break;
    	    }
    	});
    	function scrollToComments() {
    	   var target = $("#"+s.i_comment);
            $('html, body').animate({
                scrollTop: $(target).offset().top-110
            }, 2000);
    	}
        function pop_save() {
            if(require("login").getUser()) {
                var url="http://myt.indiatimes.com/mytimes/addActivity?activityType=Saved&uniqueAppID="+s.msid+"&appKey=TOI&baseEntityType=ARTICLE&objectType=B&url="+s.href;
            $.ajax(url)
              .done(function(data) {
                //alert( "success" );
                //tthis.html(data);
              })
              .fail(function() {
                //alert( "error" );
              })
              .always(function() {
                //alert( "complete" );
              });
            var h='<div class="savebox"><span class="favstatus">Page saved successfully!</span><br/>To view your Saved Pages, <a target="_blank" href="/mypage.cms">Go to My Times</a></div>';
                toiwe.showPopup(h,true,450,350);
            } else {
                require("login").login();
            }
        }
        function pop_email() {
            var h='<iframe title="Email" align="left" scrolling="no" frameborder="0" vspace="0" hspace="0" marginheight="0" marginwidth="0" height="300" width="570" id="emailiframe" name="emailiframe" src="/toiwidgets_email/'+s.msid+'.cms"></iframe>';
            var p=ui.popup(h,{width:"570px",height:"270px"});
        }
        function pop_email2() {
            var h='<iframe title="Email" align="left" scrolling="no" frameborder="0" vspace="0" hspace="0" marginheight="0" marginwidth="0" height="300" width="570" id="emailiframe" name="emailiframe" src="/toiwidgets_email/'+s.msid+'.cms"></iframe>';
            toiwe.showPopup(h,true,570,250);
        }
	}
    });
    /* /Social Sharing */
    
    
	
    define("ui_selectshare",['jquery','page','user','login','times/comments','galogger'], function($,page,user,login,comments,galogger) {
			$.fn.selectShare = function(options) {
				// This is the easiest way to have default options.
				var tthis=$(this);
				var settings = $.extend({
					// These are the defaults.
					pos:"right",
					shareBoxWidth:0,
					minusOffsetTop:0,
					shareBoxMargin:0,
					shortUrl: window.location.href,
					via: 'timesofindia',
					hash: ''
				}, options );
				this.mouseup(function(event) {
				    event = event || window.event;
				    setTimeout(function(){
    				    // Skip top comment 
    				    if($(event.target).closest('.topcomment').length || $(event.target).closest('.slideshowcontainer').length)
    				        return false;
    				        
    					var text = null;
    					if (window.getSelection) {
    						text = window.getSelection().toString();
    					} else if (document.selection && document.selection.type != "Control") {
    						text = document.selection.createRange().text;
    					}
    					//Remove space
    					text = text.replace(/^\s+|\s+$/gm,'');
    					if (text!=='' && text!=null){
    						//console.log("Select Text:"+text);
    						//console.log("Event Position: "+event.pageX + ", " + event.pageY);
    						window.sharetext=text;
    						galogger.analyticsFire('InlineSelectedShare', text.length, window.location.href);
    						var offsettop=event.pageY-parseInt(tthis.offset().top)-settings.minusOffsetTop;
    						var offsetleft=parseInt(event.offsetX)-settings.minusOffsetTop;
    						if(settings.pos==="left") {
    						    offsetleft=parseInt(tthis.offset().left-(settings.shareBoxWidth));
    						} else {
    						    offsetleft=parseInt(event.offsetX)-settings.shareBoxWidth;
    						  //  offsetleft=parseInt((parseInt(tthis.offset().left)+parseInt(tthis.width()))+settings.shareBoxMargin);
    						}
    						$('[data-type="inlineShare"]').remove();
    						//tthis.append("<div id='shareInline' data-type='inlineShare' style='top:"+offsettop+"px; left:"+offsetleft+"px;'><span class='fb article-sprite ishare' data-type='fb'><span class='inner'>Share to Facebook</span></span><span class='twitter article-sprite ishare' data-type='twitter'><span class='inner'>Share to Twitter</span></span></div>");
    						tthis.append("<div id='shareInline' data-type='inlineShare' style='top:"+offsettop+"px; left:"+offsetleft+"px;'><span data-url='"+settings.shortUrl+" via @"+settings.via+"' class='twitter article-sprite ishare' data-type='twitter'><span class='inner'>Share to Twitter</span></span></div>");
    						 $(".ishare").on("mousedown", function() {
    						    var istag=$(this);
    						    if(istag.data('type')==="twitter") {
    						        galogger.analyticsFire('InlineSelectedShare', 'Twitter', window.location.href);
    						    }else if(istag.data('type')==="fb"){
    						        galogger.analyticsFire('InlineSelectedShare', 'FB', window.location.href);
    						    }
    						     
    						    if(login.getUser()){
                                    var c = new comments({share_url:"/share.cms"}); 
                					if(istag.data('type')==="twitter") {
                					    var text2share=window.sharetext,
                					        sharelength=140;
                    				        text2share=text2share.substring(0,sharelength);
                    				        
                    				    window.facebooklink = istag.data('url');
                    				    
                					    if(settings.hash.length){
                					        text2share += " "+settings.hash;
                					    }
                					    
                					    c.postToSocial(text2share,"twitter");
                					} else if(istag.data('type')==="fb") {
                					    c.postToSocial(window.sharetext,"facebook");
                					}
                				    $('[data-type="inlineShare"]').remove();
        			             }else{
        			                 login.login();
        			            }
        			        });
    					} else {
        					//Remove shareInline Div
        					$('[data-type="inlineShare"]').remove();
    					}
				    },10);
				});
				return this;
			};
	});
    
    
	
    define("ui_inlineshare",['jquery','page','user','times/comments','login'], function($,page,user,comments,login) {
			$.fn.inlineShare = function(options) {
                return this.each(function() {
    				// This is the easiest way to have default options.
    				var tthis=$(this);
    				var s = $.extend({
    					// These are the defaults.
    					/*classis:"inlineshare",
    					classfb:"fb",
    					classtw:"twitter",
    					icons:"facebook,twitter",
    					iconposition:"after",
    					appender:""*/
    					pg_prefix:'',
    					href:window.location.href
    				}, options );
    				if(s.classis==""){s.classis="inlineshare";}
    				tthis.preop="";
                	tthis.icons=s.icons.split(",");
                	$.each(tthis.icons, function(key,val) {
                	    switch(val) {
                	       // case "facebook":
                	       //     tthis.preop+="<span pg='"+s.pg_prefix+"InlineShare#"+s.pg_prefix+"FB#"+s.pg_prefix+s.href+"' class='"+s.classfb+"' data-inlineshare='fb'></span>";
                	       // break;
                	        case "twitter":
                	            tthis.preop+="<span pg='"+s.pg_prefix+"InlineShare#"+s.pg_prefix+"Twitter#"+s.pg_prefix+s.href+"' class='"+s.classtw+"' data-inlineshare='tw'></span>";
                	        break;
                	    }
                	});
    				tthis.instances=tthis.find("."+s.classis);
                	$.each(tthis.instances, function(key,val) {
        				tthis.temptext="<span class='"+s.classoriginal+"'>"+$(val).html()+"</span>";
        				$(val).html(tthis.temptext);
                	    if(s.iconposition==="after") {
                	        $(val).append(tthis.preop);
                	    } else {
    				        $(val).prepend(tthis.preop);
                	    }
                	});
    				//<span class="inlinefb" data-inlineshare="fb"></span><span class="inlinetw" data-inlineshare="tw"></span>
    			    tthis.find("."+s.classis).click(function(event) {
    			        if(typeof s.enableclick !=="undefined" && s.enableclick===true){
    			        } else {
    			            event.preventDefault();
    			        }
    			    });
    			    tthis.find("."+s.classis+" [data-inlineshare]").click(function(event) {
    			        if(login.getUser()){
    			        
    				    var ithis=$(this);
    				    //debugger;
    				    window.sharetext=$(this).parent().text();
/*    				    if(s.fullurl) {
        				    if(s.fullurl.length>0) {
        				        window.facebooklink=s.fullurl;
        				    }
    				    }*/
    				    var istag=ithis.parent("."+s.classis);
    				    if(s.shorturl) {
        				    if(s.shorturl.length>0) {
        				        window.facebooklink=s.shorturl;
        				    }
    				    } else if(istag.data("isq") || istag.data("ishash") || istag.data("ispath")) {
    				        window.facebooklink=document.location.origin;
    				        if(istag.data("ispath")) {
        				        window.facebooklink+=istag.data("ispath");
        				    } else {
        				        window.facebooklink+=document.location.pathname;
        				    }
    				    }
    				    if(istag.data("isq")) {
    				        if(istag.data("isq").length>0) {
    				        window.facebooklink+="?"+istag.data("isq");
    				        }
    				    } else if (document.location.search) {
    				        window.facebooklink+=document.location.search;
    				    }
    				    if(istag.data("ishash")) {
    				        window.facebooklink+="#"+istag.data("ishash");
    				    }
    				    /*window.newShareData = {
    						// site:"facebook",
    						sites:"facebook,twitter",
    						message:window.sharetext,
    						link:s.appender || window.facebooklink || page.getMeta('og:url'),
    						title:window.facebookktitle || page.getMeta('og:title'),
    						domain:window.location.host,
    						picture:window.fb_Img || page.getMeta('og:image'),
    						desc:window.facebooksyn || page.getMeta('og:description') ,
    						facebook : user?user.facebook:null,
    						twitter : user?user.twitter:null
    						};*/
    					ithis.type=ithis.data("inlineshare");
    					var c = new comments({share_url:"/share.cms"}); 
    					if(ithis.type==="tw") {
    					    var text2share=window.sharetext;
    					    var sharelength=140;
    					    var dots=false;
        				    if(s.twitterat.length>0) {
        				        if(text2share.length>=125) {
        				            sharelength=140-(s.twitterat.length+5)
        				            dots=true;
        				        } else {
        				            sharelength=140-(s.twitterat.length+2);
        				        }
        				    } else {
        					    if(text2share.length>=125) {
            				        sharelength=140-3;
            				        dots=true;
            				    }
        				    }
        				    text2share=text2share.substring(0,sharelength);
        				    if(dots===true) {
        				        text2share+="...";
        				    }
        				    if(s.twitterat.length>0) {
        				        text2share+=" @"+s.twitterat;
        				    }
    					    c.postToSocial(text2share,"twitter")
    					    //window.open("/share.cms?site=twitter","ShareOnTwitter","width=580, height=350, top=200, left=200");
    					} else if(ithis.type==="fb") {
    					    c.postToSocial(window.sharetext,"facebook")
    					    //window.open("/share.cms?site=facebook","ShareOnFacebook","width=580, height=350, top=200, left=200");
    					}
    				    //event.preventDefault();
    			    }
    			    else{
    			        login.login();
    			        }
    			        event.preventDefault();
    				});
                });
			}
	});
    
    
	
	define("ui_copywidth",['jquery'], function($) {
	    function copywidth() {
    	    var copyfrom=$("[data-copywidth-from]");
    	    $(copyfrom).each(function(i,v) {
    	        var copyval=$(this).data("copywidth-from");
        	    var copywidth=$(this).css("width");
        	    var copyto=$("[data-copywidth-to='"+copyval+"']");
        	    $(copyto).each(function(i,v) {
        	        $(this).css("width",copywidth);
        	    });
        	});
	    }
	    copywidth();
	    $("[data-copywidth-from]").resize(function() {
            copywidth();
        });
	    $(window).resize(function() {
            copywidth();
        });
	});
	
    
	
	define("ui_dynwidth",['jquery'], function($) {
	    function sizeit() {
	    var box=$("[data-plugin='dynwidth']");
	    $(box).each(function(i,v) {
	        var w=calcWidth(this);
	        $(this).css("width",w);
	    });
	    }
	    function calcWidth(tthis) {
	        var a={};
	        a.box=$(tthis);
    	    a.childs=a.box.children();
    	    a.noofchild=a.childs.length;
    	    a.child=a.childs.first();
    	    a.childwidth=a.child.outerWidth(true);
    	    a.totalwidth=a.noofchild*a.childwidth;
    	    return a.totalwidth;
	    }
	    sizeit();
	    $("[data-plugin='dynwidth']").resize(function() {
            sizeit();
        });
	    $(window).resize(function() {
            sizeit();
        });
	});
	
    
    
    define("ui_toislider",['jquery','util','is','logger','event','galogger'], function($,util,is,logger,event,galogger) {
        $.fn.toislider = function(options) {
            return this.each(function() {
                if(typeof(this._init) === "boolean" && this._init===true) {
                    return this;
                }
                this._init=true;
                var s = $.extend({},{
                    // These are the defaults. Data-Slider Properties to be applied
                    d_slides:"", //Div that contain all the slides
                    d_nextbtn:"", //Next Buttons
                    d_prevbtn:"", //Prev Buttons
                    d_current:"", //Current Slide Display Box (Optional)
                    d_total:"", //Total Slide Display Box (Optional)
                    d_slide_active:"", //Class to be applied on active slide
                    d_dots_container:false, //Container for dots or false to disable by default
                    //d_dots_li_class:"", //Class to be applied to li dots
                    d_dots_active:"", //Class to be applied to active dots
                    d_slideid:"",
                    btnclass:"", //Class to apply on disabled/hidden buttons
                    events:false,
                    master:true,
                    startAt:1,
                    //slidesInView:1,
                    //slideAtOnce:1,
                    slideAutoCal:true,
                    slideTime:400,
                    syncTo:[],
                    scrollbar:false,
                    resize:false,
                    slideTimer:false,
                    slideTimerTill:"", //Integer 
                    slideTimerTime:5000
                }, options );
                var o=this;
                o.container=$(this);
    
                o.sliderid=$(o).data("sliderid");
                o.slides=o.container.find("[data-slider='"+s.d_slides+"']");
                o.slide=o.slides.children();
                
                o.slideWidthCal=function() {
                    var w=parseInt(o.container.outerWidth()/o.slide.outerWidth());
                    if(w<1) {
                        w=1;
                    }
                    o.slideAtOnce=w;
                    o.slidesInView=w;
                }
                if(s.slideAutoCal===true) {
                    o.slideWidthCal();
                }
                if(s.slideAtOnce) {
                    o.slideAtOnce=parseInt(s.slideAtOnce);
                }
                if(s.slidesInView) {
                    o.slidesInView=parseInt(s.slidesInView);
                }
                o.e_currentSlide=o.container.find("[data-slider='"+s.d_current+"']");
                o.e_totalSlide=o.container.find("[data-slider='"+s.d_total+"']");
                o.e_dots_container=o.container.find("[data-slider='"+s.d_dots_container+"']");
                o.nextbtn=o.container.find("[data-slider='"+s.d_nextbtn+"']");
                o.prevbtn=o.container.find("[data-slider='"+s.d_prevbtn+"']");
                o.currentSlide=parseInt(s.startAt);
                o.totalSlide=o.slide.length;
    
                //Create li
                if(!is.empty(o.e_dots_container)) {
                    o.dothtml="";
                    o.totalDot=Math.ceil(o.totalSlide/o.slidesInView);
                    for(i=0;i<o.totalDot;i++) {
                        o.dothtml+="<li data-dotno='"+i+"'></li>";
                    }
                    o.e_dots_container.append(o.dothtml);
                }
                if (s.resize===true) {
                    $(window).resize(function() {
                        clearTimeout(o.resizetimeout);
                        o.resizetimeout=setTimeout(function(){
                            if(s.slideAutoCal===true) {
                                o.slideWidthCal();
                            }
                            o.slideTo(o.currentSlide,"resize");
                        },500);
                    });
                }
                
                if(s.slideTimer===true) {
                    $(function(){
                        o.si=setInterval(function(){
                            if(o.currentSlide==o.totalSlide || (typeof s.slideTimerTill==="number" && o.currentSlide===parseInt(s.slideTimerTill))) {
                                o.slideTo(parseInt(s.startAt),"slidetimer");
                            } else {
                                o.slideNext("slidetimer");
                            }
                        },parseInt(s.slideTimerTime));
                    });
                }
                o.clearSlideTimer=function() {
                    clearInterval(o.si);
                }
    
                //Function to update UI on any change in slider
                o.updateUI=function(source) {
                    if(o.slidesInView>1 && source.indexOf("next")=="-1" && source.indexOf("prev")=="-1") {
                        if(!is.empty(s.d_slide_active)) {
                            o.slides.find("."+s.d_slide_active).removeClass(s.d_slide_active);
                            o.slides.find(":nth-child("+o.currentSlide+")").addClass(s.d_slide_active);
                        }
                    }
                    if(!is.empty(o.e_currentSlide)) {
                        o.e_currentSlide.text(o.currentSlide);
                    }
                    if(!is.empty(o.e_totalSlide)) {
                        o.e_totalSlide.text(o.totalSlide);
                    }
                    if(!is.empty(o.e_dots_container)) {
                        //Deativate previous dots
                        o.e_dots_container.find("."+s.d_dots_active).removeClass(s.d_dots_active);
                        //Calculate currentDot Position
                        if(o.currentSlide<=o.totalSlide-o.slidesInView)
                        { 
                            o.currentDot=Math.ceil(o.currentSlide/o.slidesInView)-1; //Start from zero
                        } else { //Make it last slide
                            o.currentDot=Math.ceil(o.totalSlide/o.slidesInView)-1; //Start from zero
                        }
                        //Make currentDot Active
                        o.e_dots_container.find(":eq("+o.currentDot+")").addClass(s.d_dots_active);
                    }
                    //Manage Buttons Hiding
                    o.nextbtn.removeClass(s.btnclass);
                    o.prevbtn.removeClass(s.btnclass);
                    if(parseInt(o.currentSlide)<=parseInt(o.slidesInView)) {
                        o.prevbtn.addClass(s.btnclass);
                    }
                    if(parseInt(o.currentSlide)>parseInt(o.totalSlide)-parseInt(o.slidesInView)) {
                        o.nextbtn.addClass(s.btnclass);
                    }
                }
                if(s.events) {
                    event.subscribe("slider.slideto",function(sliderobj) {
                        if(parseInt(sliderobj.sliderid)===parseInt(o.sliderid)) {
                            if(is.number(parseInt(sliderobj.val))) {
                                o.slideTo(sliderobj.val,"event_no");
                            } else if(is.string(sliderobj.val)) {
                                if(sliderobj.val==="next") {
                                    o.slideNext("event_");
                                } else if (sliderobj.val==="previous") {
                                    o.slidePrev("event_");
                                } //else if (sliderobj.val==="slideid" && !is.empty(sliderobj.slideid) && is.number(sliderobj.slideid)) {
                                //   o.slideTo(sliderobj.slideid,"event_slideid");
                                //}
                            } else {
                                logger.log("Invalid Slider Event:");
                                logger.log(sliderobj);
                            }
                        }
                    });
                }
                //Function to change slides
                o.slideTo=function(val,source) {
                    if(val>0 && val<=o.totalSlide) {
                        var slideOuterWidth=o.slide.outerWidth(true);
                        var lp=o.totalSlide-o.slidesInView;
                        var moveTo=val;
                        var mlTo=Math.ceil(moveTo/o.slidesInView);
                        var moveLeftTo=((slideOuterWidth*o.slideAtOnce)*(mlTo-1));
                        if(val>lp) {
                            moveTo=lp+1;
                            moveLeftTo=((slideOuterWidth)*(moveTo-1));
                        }
                        o.slides.animate({
                            marginLeft: '-'+moveLeftTo+'px'
                        });
                        o.currentSlide=val;
                        o.updateUI(source);
                        if(s.events) {
                            o.sliderobj={
                                no:val,
                                sliderid:o.sliderid,
                                slideid:$(o.slide[val-1]).data("slideid"),
                                source:source,
                                master:s.master
                            };
                            event.publish("slider.slided",o.sliderobj);
                        }
                        if(!is.empty(s.syncTo)) {
                            $(s.syncTo).each(function(index,v){
                                var sid=$(o).data("sliderid");
                                var spre=$(o).data("sliderprefix");
                                if(spre && spre!='') {
                                    $(v).each(function(index,vl){
                                        var vid=$(vl).data("sliderid");
                                        var vpre=$(vl).data("sliderprefix");
                                        if(sid===vid && spre===vpre) {
                                            $(vl).toislider()[0].slideTo(val,"sync");
                                        }
                                    });
                                } else {
                                    $(v).each(function(index,vl){
                                        var vid=$(vl).data("sliderid");
                                        if(sid===vid) {
                                            $(vl).toislider()[0].slideTo(val,"sync");
                                        }
                                    });
                                }
                            });
                        }
                    } else {
                        logger.log("Invalid Slide Number");
                    }
                }
    
                o.slideNext=function(source) {
                    var sn=parseInt(o.currentSlide)+parseInt(o.slideAtOnce);
                    var max=parseInt(o.totalSlide)-parseInt(o.slidesInView);
                    if(sn>max) {
                        o.slideTo(max+1,source+"next");
                    } else {
                        o.slideTo(sn,source+"next");
                    }
                }
                o.slidePrev=function(source) {
                    var sn;
                    //if(o.currentSlide>o.totalSlide-o.slidesInView) {
                    //    sn=o.totalSlide-o.slidesInView;
                    //} else {
                        sn=parseInt(o.currentSlide)-parseInt(o.slideAtOnce);
                    //}
                    if(sn<1) {
                        o.slideTo(1,source+"prev");
                    } else {
                        o.slideTo(sn,source+"prev");
                    }
                }
                //Updating the UI
                o.updateUI("default");
    
                //Throttler function
                o.throttledslide = util.throttle(s.slideTime,function(type,val){
                    if(type==="next") {
                        o.slideNext();
                    } else if(type==="prev") {
                        o.slidePrev();
                    } else if(type==="to") {
                        o.slideTo(val,"main");
                    } else {
                        logger.log("Invalid throttledslide value!");
                    }
                });
    
                //Track links on container
                o.container.on("click","[data-slider]",function(){
                    var component=$(this).data("slider");
                    if(component===s.d_nextbtn) {
                        o.throttledslide("next");
                        o.clearSlideTimer();
                    } else if (component===s.d_prevbtn) {
                        o.throttledslide("prev");
                        o.clearSlideTimer();
                        galogger.analyticsFire('InlineMedia','Slideshow', 'Prev-'+ window.location.href);
                    }
                });
                o.e_dots_container.on("click","*",function(){
                    var count=parseInt($(this).data("dotno"));
                    var stocount=(count*o.slidesInView)+1;
                    if(stocount>o.totalSlide)
                    {
                        stocount=o.totalSlide;
                    } else if (stocount<1) {
                        stocount=1;
                    }
                    o.throttledslide("to",stocount);
                });
            });
        }
        return $;
    });

    
    
        
            define("slideshow",["jquery","util","is","logger","ui_toislider","event","ui_copywidth","ui_dynwidth"],function($,util,is,logger,slider,event,copywidth,dynwidth){

                function goToSlide(type,slideshowid,slide) {
                    if(type==="id") {
                        //Pending - Deliver by Slide Id
                    } else {
                        //Deliver by count value
                    }
                }
                
            	$.fn.slideShow = function(options) {
                return this.each(function() {
            	    var tthis=$(this);
            	    var settings = $.extend({
            			// These are the defaults.
            		}, options);
            		tthis.ms = $.extend({}, {defaultCaption: false}, options.ms );
            		tthis.ss = $.extend({}, options.ss );
            	    tthis.master=tthis.find("[data-slideshow='master']");
            	    tthis.slaves=tthis.find("[data-slideshow='slave']");
            	    tthis.master.toislider(tthis.ms);
            	    tthis.slaves.toislider(tthis.ss);
            	    tthis.masterid=tthis.master.data("sliderid");
            	    
            	    tthis.find(".infobox h4").attr("data-slideshow","infotoggle");
            	    
            	    if(tthis.ms.defaultCaption){
                        tthis.attr("data-stateinfo", "true");
                     }else{
                         tthis.attr("data-stateinfo", "false");
                         tthis.find("[data-slideshow='slidecaption']").mCustomScrollbar({
                            theme:"light-thick",
                            scrollButtons:{ enable: false },
                            mouseWheel:{ enable: true,scrollAmount: 52 }
                         });
                         tthis.find("[data-slideshow='slidecaption']").hide();
                     }
                     
                    // TODO: Hack to wrap title in span  
                    var slide_titles = tthis.find("h3");
                    for(i=0; i< slide_titles.length; i++){
                        var txt = $(slide_titles[i]).text();
                       $(slide_titles[i]).html('<span>'+txt+'</span>');
                    }
 
            
                    tthis.find("[data-slideshow='infotoggle']").on("click",function(){
                        if(tthis.attr("data-stateinfo")!="false") {
                             tthis.find(".infobox").css("height","38px;");
                            tthis.attr("data-stateinfo","false");
                            tthis.find("[data-slideshow='slidecaption']").slideUp();
                        } else {
                             tthis.find(".infobox").css("height","auto");
                            tthis.attr("data-stateinfo","true");
                            tthis.find("[data-slideshow='slidecaption']").slideDown();
                        }
                    });
            	    event.subscribe("slider.slided",function(sliderobj) {
                        if(sliderobj.source!=="sync" && sliderobj.sliderid===tthis.masterid && sliderobj.master) {
                            window.history.replaceState( {} , $("title").text(), window.location.pathname+'?slideshow='+sliderobj.sliderid+'&slide='+sliderobj.slideid+'#'+sliderobj.no);
                        }
                        window.ga && ga('send', {
                           'hitType': 'pageview',
                           'page': window.location.href,
                           'title': document.title,
                           'location': window.getArticleUrl && window.getArticleUrl(window.msid)
                        });
                    });
                    
                    function updateURL(t) {
                        var slideshowid=t.data("msid");
                        var slideno=parseInt(t.find(".pagination .slideno").text());
                        var slideid=t.find(".slideshow-box .slides .slide:nth-child("+slideno+")").data("slideid");
                        var newtitle=$("title").text()
                        var newurl=window.location.pathname+'?slideshow='+slideshowid+'&slide='+slideid+'#'+slideno;
                        window.history.replaceState( {} , newtitle, newurl);
                        ga('send', {
                          'hitType': 'pageview',
                          'page': newurl,
                          'title': newtitle
                        });
                    }
            	});
            	}
            });

        
    
     
        (function( $ ) {
            $.fn.videoOverlay = function(options) {
                
                if(!this.length){
                    return;
                }
                
                if($('head').find('#vcw').length <= 0){
                    $('head').append('<script type="text/template" id="videooverlaydom"><div id="vcw" class="video-overlay-wrapper"><div class="inner"><button type="button" class="closebtn"></button><div class="video-content loading"><iframe allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" id="videosrc"></iframe></div></div></div> </script>');
                }
                
                return this.each(function() {

                            if(typeof(this._sliderinit) === "boolean" && this._sliderinit===true) {
                                return this;
                            }
                            
                            this._sliderinit=true;
                            
                        var  previousPath = null;
                        
                        var defaults = {
                                        videosection: "toi",
                                        source: "toi",
                                        pg : "toi"
                                       };
                        
                        var opts = $.extend( {},defaults,options);
                        
                        function closeSliderVideo(){
                        
                            history.pushState(null,null, previousPath);
                            
                            $('#vcw').fadeOut(500,function(){$('#vcw').remove();});
                            $('body').css('overflow','auto');
                        }
                        
                        function triggerSliderVideoAnalytics(title, relUrl){
                	        if(typeof ga != "undefined"){
                	            ga('send', {
                                   'hitType': 'pageview',
                                   'page': relUrl,
                                   'title': title,
                                   'location': location.protocol + "//"+location.hostname + relUrl
                                });    
                	        }
                                
                            // Comscore Call
                            if (typeof(fireComscore) == "function") {
                                fireComscore();
                            }
                            
                            // ChartBeat Call
                            if (typeof(pSUPERFLY) !="undefined" && typeof(pSUPERFLY.virtualPage) == "function") {
                                pSUPERFLY.virtualPage(relUrl, title);
                            }
                        }
                        
                        function playNext(e, r){
                            var $target = $('[data-msid="'+ r.nextid +'"]'),
                                $link = $target.find('a'),
                                msid = $target.data('msid'),
                                title = $link.attr('title'),
                                url = $link.attr('href'),
                                $next = $target.next(),
                                nextid = $next.length ? $next.data('msid') : null,
                                nexttitle = ($next.length && $next.find('a') && $next.find('a').length) ? $next.find('a').attr('title') : null,
                                vidUrl = '/videodash.cms?msid='+msid+'&channel=10001&relatedvideo=pagevar&videosection='+opts.videosection+'&source='+opts.source+'&pg='+opts.pg+'&autoplay=1&userInitiated=0&section=News&hpauto=0&stxt=off&audio=0.05&kalstream=PROGRESSIVE&toividpage=articleshow&tadsid=38883&aptrg=1&version=18';
                	        
                	        if(nextid && nexttitle){
                	            vidUrl = vidUrl + '&nextid='+nextid+'&nexttitle='+nexttitle;
                	        }
                	        
                	        $('#vcw #videosrc').attr('src',vidUrl);
                	        history.pushState(null,null, url);
                            return false; 
                        }
                        
                        function loadSliderVideo(vid, title, relUrl, nextid, nexttitle){
                            
                	        var vidUrl = '/videodash.cms?msid='+vid+'&channel=10001&relatedvideo=pagevar&videosection='+opts.videosection+'&source='+opts.source+'&pg='+opts.pg+'&autoplay=1&userInitiated=1&section=News&hpauto=0&stxt=off&audio=0.05&kalstream=PROGRESSIVE&toividpage=articleshow&tadsid=38883&aptrg=1&version=18',
                	            $body = $('body');
                	        
                	        if(nextid && nexttitle){
                	            vidUrl = vidUrl + '&nextid='+nextid+'&nexttitle='+nexttitle;
                	        }
                	        
                	        $body.append($('#videooverlaydom').html());
                            $('#vcw #videosrc').attr('src',vidUrl);
                            $("#vcw").fadeIn(500);
                            
                            triggerSliderVideoAnalytics(title, relUrl);
                            previousPath = window.location.pathname;
                            history.pushState(null,null, relUrl);
                            
                            $('#vcw #videosrc').off('load').on('load', function(){ 
                                $('#vcw .video-content').removeClass('loading');
                                $body.css('overflow','hidden');
                                
                            });
                            $('#vcw .closebtn').off('click').on('click',function(){
                                closeSliderVideo();
                            });
                            
                            $(document).off("videodash.invokeVideo", playNext).on("videodash.invokeVideo", playNext);
                            
                            
                        }
                        
                        //video play
                        $(this).on('click','li',function(e){
                            e.preventDefault();
                            var $target = $(this),
                                $link = $target.find('a'),
                                msid = $target.data('msid'),
                                title = $link.attr('title'),
                                url = $link.attr('href'),
                                $next = $target.next(),
                                nextid = $next.length ? $next.data('msid') : null,
                                nexttitle = ($next.length && $next.find('a') && $next.find('a').length) ? $next.find('a').attr('title') : null;
                            
                                loadSliderVideo(msid, title, url, nextid, nexttitle);   
                           
                        });
                        
                        $(document).off('keyup').on('keyup', function(e){
                           if(e.keyCode = 27){ // on Esc key press
                               closeSliderVideo();
                           } 
                        });
                    
                });
             }
            
        })(jQuery);
       
    
     
        define('showStoriesOnMouseOut', ['jquery', 'tiljs/cookie', 'tiljs/plugin/lazy'], function ($, cookie, lazy) {
            var showStoriesOnMouseOut = {};
            showStoriesOnMouseOut.timeoutId = null;
            showStoriesOnMouseOut.init = function () {
                var closeTopStoryModalFlag = cookie.get('closeTopStoryModal');
                if(closeTopStoryModalFlag === 'true') {
                    return;   
                }
                $(document).ready(function(){
                    showStoriesOnMouseOut.getData();
                });
                $(document).on('mouseleave', function (event) {
                    var closeTopStoryModal = 'false';
                    closeTopStoryModal = cookie.get('closeTopStoryModal');
                    if(closeTopStoryModal !== 'true' && event.clientY < 0) {
                        var $showStoriesLength = $('#showTopStories');
                        if($showStoriesLength.length > 0) {
                            showStoriesOnMouseOut.timeoutId = setTimeout(function(){
                                $showStoriesLength.show();
                                lazy.load();
                                var gaLabel = typeof toiprops==='object' && toiprops._Tmpl_pg?toiprops._Tmpl_pg: window.location.href;
                                typeof ga == "function" && ga('send', 'event', 'Exit_Popup_Desktop', 'View', gaLabel);
                            }, 200);
                        } else {
                            showStoriesOnMouseOut.getData(true);
                        }
                    }
                }).on('mouseenter', function (event) {
                    if(typeof(showStoriesOnMouseOut.timeoutId) === 'number') {
                        clearTimeout(showStoriesOnMouseOut.timeoutId);
                        showStoriesOnMouseOut.timeoutId = null;
                    }
                })
            },
            showStoriesOnMouseOut.getData = function (showData) {
                var $showStories = $('#showTopStories');
                var url = '/showstories.cms';
                if($showStories.length === 0) {
                    $.ajax({
                        url: url
                    }).done(function(data) {
                        if($showStories.length === 0) {
                            $('body').append('<div id="showTopStories" style="display:none"></div>');
                            $showStories = $('#showTopStories');
                            $showStories.append(showStoriesOnMouseOut.getFilteredData(data));
                            // showStoriesOnMouseOut.getFilteredData(data);
                            if(showData) {
                                $showStories.show();
                                lazy.load();
                                var gaLabel = typeof toiprops==='object' && toiprops._Tmpl_pg?toiprops._Tmpl_pg: window.location.href;
                                typeof ga == "function" && ga('send', 'event', 'Exit_Popup_Desktop', 'View', gaLabel);
                            }
                            $showStories.off('click', '.close').on('click', '.close', function(event) {
                                $showStories = $('#showTopStories');
                                $showStories.hide();
                                document.cookie = "closeTopStoryModal=true; expires=0; path=/";
                            })
                        }
                    });
                }
            },
            showStoriesOnMouseOut.getFilteredData = function (data) {
                var $data = $(data);
                var $liData = $data.find('li');
                var counter = 0;
                var position = 0;
                var $selectedList;
                var selectedIndex = -1;
                var pgData, $pgElem, pgCat = '', $pgImage, $liData, $iconVideo, $iconPlayer;
                var pgCtr = 0;
                
                for(; counter < $liData.length - 1; counter++) {
                    $liDataList = $($liData[counter]);
                    if(counter < 5) {
                        $iconVideo = $liDataList.find('i.iconvideo');
                        $iconPlayer = $liDataList.find('i.icon_player');
                        if($iconVideo.length > 0) {
                            $iconVideo.remove();
                        }
                        
                        if($iconPlayer.length > 0) {
                            $iconPlayer.remove();
                        }
                    }
                    
                    $selectedList = $liDataList.find('.w_tle > a');
                    if($selectedList.length === 1 && $selectedList.attr('href').indexOf(window.msid) !== -1 && selectedIndex === -1) {
                        selectedIndex = counter;
                    }
                    
                    if((selectedIndex === -1 && counter !== 4) || (selectedIndex !== counter)) {
                        pgData = $selectedList.attr('pg');
                        if(pgData) {
                            pgCat = pgData.split('~').length > 1? pgData.split('~')[1]: '';
                            pgData = 'Exit_Popup_Desktop#' + (position + 1) + '~' + pgCat;
                            $pgElem = $($liDataList).find('a');
                            $pgImage = $liDataList.find('.w_img > img');
                            for(pgCtr = 0; pgCtr < $pgElem.length; pgCtr++) {
                                $($pgElem[pgCtr]).attr('pg', pgData);
                            }
                            if($pgImage.length > 0) {
                                $pgImage.attr('pg', pgData);
                            }
                        }
                        position++;
                    }
                }
                
                if(selectedIndex !== -1) {
                    $data.find('li:eq(' + selectedIndex + ')').remove();
                    if(selectedIndex <= 4) {
                        $data.find('li:eq(6)').remove();
                    } else {
                        $data.find('li:eq(3)').remove();
                    }
                } else {
                    $data.find('li:eq(4)').remove();
                    $data.find('li:eq(6)').remove();
                }
                
                return $data;
            }
            
            return showStoriesOnMouseOut;
        });
      
      
         window.toiweb = window.toiweb || {}
		var bdomain = 'timesofindia.indiatimes.com'//window.location.host;
        toiweb.nl = {
/**
 * Newsletter constants, variable and calls
 * Do mapping of each newsletter according to their parameter list
 */
islogin : false,
issubscribe: false,
constants : {   'topten' : {
                    frequency : '1',
                    scheduletime : '1',
                    status : '1',
                    nlid : '1029'
                }
                    
            },
            
            nonloginconfig : {
            configid : '64477478',
            subscriptionwithconfirmation : 'true',
            confirmationpage : 'timestopten'
            },
            
            dom : {
            wrapper: $('[data-wrapper="nl"]'),
            message: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="message"]'),
            email: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="email"]'),
            selectnl: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="topten"]'),
            submit: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="submit"]'),
            presub: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="presub"]'),
            innerbox: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="innerbox"]'),
            submitgreen: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="green"]'),
            holder: $('[data-subtitle]')
            },
            
            config : {
                id : '', /*email id*/
                restoretime: '5000'
            },
            
            api : {
            getsubscription: '//'+bdomain+'/newsletter/getsubscription/',
            addsubscription: '//'+bdomain+'/newsletter/addsubscription/',
            unsubscription: '//'+bdomain+'/newsletter/unsubscribenlwithhash/'
            },
            
            /**
             * Newsletter functions and calls
             */
            
        isemail : function(email) {
			var regex = /\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b/i;
            return (regex.test(email)) ? true : false;
		    },
		    
		call : function(request){
                $.ajax({
                    type: "GET",
                    url: request.url,
                    data: request.data,
                    dataType: "jsonp"
                }).done(request.success).fail(request.fail);
            },
            
            addgeoconfig : function(){
		        if(typeof geoinfo != 'undefined'){
		            toiweb.nl.constants.topten.country = geoinfo.CountryCode;
		            toiweb.nl.constants.topten.cont = geoinfo.Continent;
		            toiweb.nl.constants.topten.city = geoinfo.city;
		        }else{
		            $.getScript( "https://geoapi.indiatimes.com/?cb=1", function() {
                    geoinfo=geoinfo;
                    toiweb.nl.constants.topten.country = geoinfo.CountryCode;
		            toiweb.nl.constants.topten.cont = geoinfo.Continent;
		            toiweb.nl.constants.topten.city = geoinfo.city;
			        })
		        }
		        
		    },
            
		addsubscription : function(param){
		var tthis = toiweb.nl;
		// Below link commented for specific period to disable 2 step subscribe
		//var addparam = !tthis.islogin ? tthis.nonloginconfig : {}; 
		var addparam = tthis.nonloginconfig;
		var calldata = $.extend({id: param.email}, tthis.constants[param.label], addparam)
		tthis.call({
            	     url : tthis.api.addsubscription,
            	     data : calldata,
            	     success: function(data){
            	        if(data.Status.toLowerCase() == 'success') {
                        if(data.message.indexOf('Already verified user') > -1)
                        {
                            
                        tthis.showholder();    
                        tthis.msg({type:'success', text:'You are already subscribed.'});
                        
                        }
                        else if(data.message.indexOf('Newsletter details added and verified') > -1)
                        {
                           tthis.issubscribe = true; 
                         ga('send','event','Prime_NL','Subscribe_Success',window.location.href); ; 
                        tthis.hideholder();
                        tthis.dom.message.hide();
                        tthis.dom.email.hide();
                        tthis.dom.submit.hide();
                        tthis.dom.submitgreen.hide();
                        tthis.msg({type:'success-style', text:'Thank you for subscribing.'});
                        //tthis.restoredom();
                        }
                        else if(data.message.indexOf('RSP_ID') > -1)
                        {
                            tthis.issubscribe = true;
                         ga('send','event','Prime_NL','Subscribe_Success',window.location.href);  
                        tthis.hideholder();
                        tthis.dom.message.hide();
                        tthis.dom.email.hide();
                        tthis.dom.submit.hide();
                        tthis.dom.submitgreen.hide();
                        tthis.msg({type:'success-style', text:'Thank you for subscribing.'});
                        //tthis.restoredom();
                        
                        }
                        }
                        else if(data.Status.toLowerCase() == 'fail')
                        {
            	        if(data.message.indexOf('pls verify first') > -1){
                        tthis.showholder(); 
                        tthis.msg({type:'success', text:'Please verify your subscription.'});
            	        }
            	     }
            	    },
            	    fail: function(){
            	    tthis.showholder();   
            	    tthis.msg({type:'error', text:'Internal server error. Please try again!'});
            	    }
            	})
		},
		
		hideholder: function(){
		    //var tthis = toiweb.nl;
		    $('[data-nl="email"]').attr('disabled','disabled');  
            $('[data-nl="submit"]').hide().text('subscribe').attr('class','btn_disable subscibe_btn');
            $('[data-nl="message"]').hide();
            $('[data-nl="green"]').show();            
		},
		
		showholder: function(){
		    //var tthis = toiweb.nl;
		    $('[data-nl="email"]').removeAttr('disabled');  
            $('[data-nl="submit"]').show().text('subscribe').attr('class','btn_disable subscibe_btn');
            $('[data-nl="green"]').hide();             
		},

	msg: function(param){
		var tthis = toiweb.nl
		param.type == 'success' ? tthis.dom.message.html(param.text).addClass('success').removeClass('error bsize').show() :
		param.type == 'success-style' ?  tthis.dom.message.html(param.text).addClass('bsize success').removeClass('error').show() :         tthis.dom.message.html(param.text).addClass('error').removeClass('success bsize').show();
		},
		
		addemail : function(){
		var tthis = toiweb.nl, email = tthis.dom.email.val().replace(/^\s\s*/, "").replace(/\s\s*$/, "");
		tthis.dom.message.hide();
		if(tthis.isemail(email)){/*tthis.dom.submit.hide();*/ga('send','event','Prime_NL','Subscribe_initiated',window.location.href); tthis.addsubscription({email:email,label:'topten'});}
		else{ 
		    tthis.msg({type:'error', text:'Enter a valid email address.'})
		    tthis.dom.email.focus();
		}
		
		},
		
		validatekeypress : function(){
		    var tthis = toiweb.nl
		        $('body').delegate('[data-nl="email"]','keyup mouseenter',function(){
		            tthis.refreshDom();
		        var email = tthis.dom.email.val();
		        if(tthis.isemail(email)){
		           tthis.dom.submit.removeClass('btn_disable');
		           //tthis.dom.message.hide();
		        }else{
		             tthis.dom.submit.addClass('btn_disable');
		        }
		    })
		},
		
		getsubscription : function(param){
		var tthis = toiweb.nl;
		var calldata = $.extend({id: param.email}, {})
		tthis.call({
            	     url : tthis.api.getsubscription,
            	     data : calldata,
            	     success: function(data){
            	          if(data.Status.toLowerCase() == 'success') {
            	          // check for timestopten newsletter
                        if(data.message && JSON.stringify(data.message).indexOf('"ID":"1029"') > -1)
                        {
                        tthis.issubscribe = true;
                        //tthis.msg({type:'success', text:'You are already subscribed.'});
                        tthis.dom.message.hide();
                        tthis.hideholder();
                        $('.newsletterwidget').hide();
                        }
            	     }else if(data.Status.toLowerCase() == 'fail')
            	     {
            	     if(data.message.indexOf('pls verify first') > -1){
                        tthis.showholder();    
                        //tthis.msg({type:'success', text:'Please verify your subscription.'});
            	     }
            	     }
            	     },
            	     fail: function(){
            	        tthis.showholder();
            	        //tthis.msg({type:'success', text:'Internal server error. Please try again!'})
            	     }
		})
		},
		
		attachemail : function(){
		var tthis = toiweb.nl;
		var sso = false;    
		if(typeof require != 'undefined')
		require(['tiljs/event'],function(event) {
                    event.subscribe("user.status",function(user) {
                        if(user){
                        tthis.islogin  = true;
                        tthis.refreshDom();
                        $('[data-nl="email"]').val(user.getEmail());
                        tthis.getsubscription({email:user.getEmail()});
                        $('[data-nl="email"]').attr('disabled','disabled');
                        $('[data-nl="submit"]').removeClass('btn_disable');
                        }else{
                        tthis.issubscribe = false;    
                        tthis.islogin = false;
                        $('[data-nl="email"]').val('');
                        tthis.showholder();
                        }
                        })
                        });
		tthis.restoresubmit();	
		},
		
            restoresubmit : function(){
      var tthis = toiweb.nl;
    $('body').delegate('[data-nl="submit"]','click',function(){
        tthis.refreshDom();
		tthis.addemail();
			})
			
			$('body').delegate('[data-nl="email"]','keydown',function(e){
			var keycode = e.keyCode || e.which;
            if(keycode == '13') {
                tthis.refreshDom();
			tthis.addemail();
            }
			})
		    
		},
		
		refreshDom : function(){
            toiweb.nl.dom = {
            wrapper: $('[data-wrapper="nl"]'),
            message: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="message"]'),
            email: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="email"]'),
            selectnl: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="topten"]'),
            submit: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="submit"]'),
            presub: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="presub"]'),
            innerbox: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="innerbox"]'),
            submitgreen: $('[data-wrapper-msid="'+msid+'"]').find('[data-nl="green"]'),
            holder: $('[data-subtitle]')
            }
            },
            
            restoredom : function(){
		    var tthis = toiweb.nl;
		    if(clr) cleartimeout(clr)
		    var clr = setTimeout(function(){
		        tthis.dom.message.hide();
		        tthis.dom.email.show().attr('disabled','disabled');
		        tthis.dom.submit.hide();
                tthis.dom.submitgreen.show();
		    },tthis.config.restoretime);
		},
		
		init : function(){
		toiweb.nl.addgeoconfig();
		toiweb.nl.attachemail();
		//toiweb.nl.restoresubmit();
		toiweb.nl.validatekeypress();
		}
            
        }
	
  
      
    ///// Open in App code starts //// 
      
    var _lastWindowScrollTop = 0;
      
    /**
     * open in app tracking
     */
    fireOpeninAppAppsFlyer = function(){
        if ( 
        window.TimesGDPR 
            && TimesGDPR.common.consentModule.gdprCallback
        ){
            TimesGDPR.common.consentModule.gdprCallback(function(data){
                if(data && !data.isEUuser){
                    $(".id_pixelImg").attr("src","http://impression.appsflyer.com/com.toi.reader.activities?pid=Web_articleshow&c=Web_articleshow");
                }
            });
        }
    };
    
    /**
     *handling open in app button position based on Page scroll up and down.
     */
    openInAppDisplayHandler = function () {
        var $openApp = $('#openapp');
        require(["tiljs/event"], function (event) {
            event.subscribe("window.scroll", function () {
                var currentScroll = $(window).scrollTop();
                console.log('_lastWindowScrollTop :: ', _lastWindowScrollTop);
                console.log('currentScroll :: ', currentScroll);
                if (_lastWindowScrollTop) {
                    if (currentScroll < _lastWindowScrollTop) {
                        // console.log('show open in app',currentScroll, lastScrollTop);
                        if ($openApp.length > 0) {
                            if ($openApp.hasClass('movedown')) {
                                $openApp.removeClass('movedown');
                                var div = $('div.articlepage[data-articlemsid="' + window.msid + '"]');
                                if (div.length > 0) {
                                    if (!div.hasClass('visited')) {
                                        $.ajax({
                                            url: 'https://impression.appsflyer.com/com.toi.reader.activities?pid=Web_articleshow&c=Web_articleshow',
                                            dataType: 'html',
                                            success: function (data) {}
                                        });
                                        div.addClass('visited');
                                    }
                                }
                            }
                        }
        
                    } else {
                        // console.log('remove open in app',currentScroll, lastScrollTop);
                        if ($openApp.length > 0) {
                            if (!$openApp.hasClass('movedown')) {
                                $openApp.addClass('movedown');
                            }
                        }
                    }
                }
                _lastWindowScrollTop = currentScroll;
            });
        });
    };
    
    handleOpenInAppClick = function() {
        $('#openapp a').on('click',function(e){
            e.preventDefault();
            var gethref =  window.location.href.replace(/toidev/, 'timesofindia'); // set domain to live always for app
            var seturl = 'https://p23eh.app.goo.gl/?link='+gethref+'&utm_campaign=Web_openinapp&utm_medium=TOI_Web&utm_source=Web_articleshow&ibi=com.2ergoTOI.jayant&ifl=https://itunes.apple.com/us/app/the-times-of-india/id427589329?ls=1&mt=8&ipbi=com.toi.toiipad&ipfl=https://itunes.apple.com/us/app/the-times-of-india-for-ipad/id427164653?ls=1&mt=8&imv=245&efr=1'
            var isIPad = (/iPad/.test(navigator.userAgent) && !window.MSStream);
            if(isIPad){
                var openedWindow = window.open(seturl, '_blank');
                setTimeout(function(){
                    openedWindow.close()
                }, 10000)
            } else{
                window.location.href = seturl;
            }
            ga("send", "event", "App_Download", "Open_In_APP", window.location.href);
        })
    };
    
    ///// Open in App code ends ////   
      
      
    var iBeatTimer = setTimeout(function(){loadIbeatJS();},20000);
    $(window).load(function(){loadIbeatJS();clearTimeout(iBeatTimer);});
    function loadIbeatJS(){
        var ibeatCallback = function(){
            try{
                if(typeof iBeatPgTrend == 'undefined'){
                    var ele = document.createElement('script');
                    ele.setAttribute('language', 'javascript');
                    ele.setAttribute('type', 'text/javascript');
                    ele.setAttribute('src',"https://agi-static.indiatimes.com/cms-common/ibeat.min-001.js");
                    document.body.appendChild(ele);
                }
            }catch(e){}
        }

        if ( 
                window.TimesGDPR 
                && TimesGDPR.common.consentModule.gdprCallback
            ){
                TimesGDPR.common.consentModule.gdprCallback(function(data){
                    if(!data.isEUuser){
                        ibeatCallback();
                    }
                });
            }
    }
            
   define( "galogger", [ ], function () {
	var galogger = {};
	galogger.analyticsFire = function(catg, action, label){
	    var prefix = 'AS1_';
	    
	    /*Adding page specific prefix*/
	    catg = prefix + catg;
	    action = prefix + action; 
	    label = prefix + label;
	    /**/ 
	    
	    if(window.ga){
	        ga('send', 'event', catg, action, label, {'nonInteraction': 1});
	    }else{
	        setTimeout(function () {ga('send', 'event', catg, action, label, {'nonInteraction': 1});},5000);
	    }
	    return true;
	};
	return galogger;
    } );
   
   /* Code for NIC Video */
   define("nicvideo", ["jquery", "tiljs/logger", "tiljs/is", "ui_toislider", "tiljs/cookie", "tiljs/plugin/lazy", "galogger"], function($, logger, is, ui_toislider, cookie, lazy, galogger) {
     var initVideo = function() {
       $(".nic_container").on("click", ".articlevideo .preloader", function() {
         //window.articlevideo=[];
         window.articlevideomsid = window.msid;
         var tthis = $(this).parent().parent();
         var msid = tthis.data("msid");
         //var preloader=$(this);
         var position = tthis.data("position");
         var rel = null;
         if (position === "abovearticle") {
           rel = true;
           galogger.analyticsFire('InlineMedia', 'Video', 'lead-video/'+window.location.href);
         } else {
           rel = false;
           galogger.analyticsFire('InlineMedia', 'Video', 'inline-video/'+window.location.href);
         }
         loadVideo(tthis, msid, "cover", rel);
       });
       var s = {
         // These are the defaults.
         //d_slide:"slide",
         d_slides: "slides",
         d_nextbtn: "next",
         d_prevbtn: "prev",
         d_current: "current",
         d_total: "total",
         btnclass: "hideit",
         startAt: 1,
         slidesInView: 3,
         slideAtOnce: 3,
         slideTime: 400,
         scrollbar: false
       };
       $(".nic_container  .related-videos").toislider(s);
       $(".nic_container  .articlevideo").on("click", ".slide", function() {
         var rmsid = $(this).data("msid");
         var tthis = $(this).closest('.articlevideo');
         loadVideo(tthis, rmsid, "related", true);
         galogger.analyticsFire('InlineMedia', 'Video', 'related-video/'+window.location.href);
       });

       function getNextRelVideo(tthis, data) {
         var playing = tthis.find(".related-videos .playing");
         var next = playing.next();
         if (next.length == 0) {
           next = tthis.find(".related-videos .slide:first");
         }
         if (data === "msid") {
           return next.data("msid");
         } else if (data === "title") {
           return next.find(".caption").text();
         } else {
           return false;
         }
       }
       
       
     

       function getStxt() {
         var stxt = null;
         // var c_stxt = cookie.get("auto_off");
         var c_stxt = Get_Ckie_str("auto_off");
         if (is.empty(c_stxt)) {
           stxt = "off";
         } else {
           if (c_stxt == "true") {
             stxt = "on";
           } else {
             stxt = "off";
           }
         }
         return stxt;
       }
      
       function loadVideo(tthis, msid, source, related) {
         var preloader = tthis.find(".preloader");
         var position = tthis.data("position");
         tthis.addClass("loadingvid");
         var hasflash = false;
         var nextmsid = null;
         var nexttitle = null;
         var articlemsid = tthis.closest('.niccontent').data('nic_msid');
         
         
         //Mark Playing
         //if (related === true) {
           //markRelatedPlaying(tthis, msid);
         //}

         //Set Next Values
         var url = null;
         var stxt = getStxt();

            nextmsid = msid;
            nexttitle = "";
            url = "/article_video_dash.cms?msid=" + msid + "&source=articleshow/nic&articlemsid="+articlemsid+"&videosection=AS-pages&version=22";
            url += "&userInitiated=1";

        if( window.toiprops && window.toiprops._BL_pg ){
            url += "&blKey=1";
        }
         
         var toppart = tthis.find(".toppart");
         $.ajax(url)
           .done(function(data) {
             //alert( "success" );
             tthis.addClass("playingvid");
             toppart.find('.vidbox').remove();
             toppart.append("<div class='vidbox' style='display:none;'><span class='close'></span><div class='dvideo' id='" + msid + "'>" + data + "</div></div>");
            //  if (position === "abovearticle" && source !== "related" && related === true) {
            //   loadRelatedVideos(tthis, msid);
            //  }
           })
           .fail(function() {
             //alert( "error" );
             tthis.removeClass("loadingvid");
             toppart.find('.vidbox').remove();
             toppart.append("<div class='vidbox' style='display:none;'>" + "<span class='msg error'>Error occured while loading video!<br/>Close this box and try again.</span>" + "</div>");
           })
           .always(function() {
             //alert( "complete" );
             preloader.fadeOut("2000", function() {
               tthis.find(".vidbox").fadeIn("1000", function() {
                 tthis.removeClass("loadingvid");
               });
             });
           });
       }

       function markRelatedPlaying(tthis, msid) {
         tthis.find(".slide").removeClass("playing");
         tthis.find(".slide[data-msid='" + msid + "']").addClass("playing");
       }

       function loadRelatedVideos(tthis, msid) {
         tthis.find(".related-videos").slideDown("1000", function() {
           lazy.load();
         });
       }
       $(".nic_container").on("click", ".articlevideo .close", function() {
         var tthis = $(this).parent().parent().parent();
         var msid = tthis.data("msid");
         var preloader = tthis.find(".preloader");
         var vidbox = tthis.find(".vidbox");
         var revidbox = tthis.find(".related-videos");
         tthis.removeClass("playingvid");
         preloader.fadeIn("500");
         vidbox.fadeOut("500", function() {
           vidbox.remove();
         });
         revidbox.slideUp("500", function() {
           //revidbox.remove();
         });
         //tthis.html(window.articlevideo[msid]);
       });
     }

     return initVideo;
   });
   
   
   /* Code for Article Video */
   define("articlevideo", ["jquery", "tiljs/logger", "tiljs/is", "ui_toislider", "tiljs/cookie", "tiljs/plugin/lazy", "galogger"], function($, logger, is, ui_toislider, cookie, lazy, galogger) {
     var initVideo = function(msid) {
       $(".articlepage[data-articlemsid='" + msid + "'] .articlevideo").on("click", ".preloader", function() {
         //window.articlevideo=[];
         var tthis = $(this).parent().parent();
         var msid = tthis.data("msid");
         //var preloader=$(this);
         var position = tthis.data("position");
         var rel = null;
         if (position === "abovearticle") {
           rel = true;
           galogger.analyticsFire('InlineMedia', 'Video', 'lead-video/'+window.location.href);
         } else {
           rel = false;
           galogger.analyticsFire('InlineMedia', 'Video', 'inline-video/'+window.location.href);
         }
         loadVideo(tthis, msid, "cover", rel);
       });
       var s = {
         // These are the defaults.
         //d_slide:"slide",
         d_slides: "slides",
         d_nextbtn: "next",
         d_prevbtn: "prev",
         d_current: "current",
         d_total: "total",
         btnclass: "hideit",
         startAt: 1,
         slidesInView: 3,
         slideAtOnce: 3,
         slideTime: 400,
         scrollbar: false
       };
       $(".articlepage[data-articlemsid='" + msid + "']  .related-videos").toislider(s);
       $(".articlepage[data-articlemsid='" + msid + "']  .articlevideo").on("click", ".slide", function() {
         var rmsid = $(this).data("msid");
         var tthis = $(this).closest('.articlevideo');
         loadVideo(tthis, rmsid, "related", true);
         galogger.analyticsFire('InlineMedia', 'Video', 'related-video/'+window.location.href);
       });

       function getNextRelVideo(tthis, data) {
         var playing = tthis.find(".related-videos .playing");
         var next = playing.next();
         if (next.length == 0) {
           next = tthis.find(".related-videos .slide:first");
         }
         if (data === "msid") {
           return next.data("msid");
         } else if (data === "title") {
           return next.find(".caption").text();
         } else {
           return false;
         }
       }
       
       $(document).on('VOD_EVENTS', function(event, obj, eventType) {
           eventType = ( eventType ? eventType.toUpperCase() : "" );
           if( eventType != "ONNEXTVIDEOPLAY" ){
                return;
           }
           window.invokeVideo(obj);
       });
       
       window.invokeVideo = function(a) {
        var TimesApps = window.TimesApps || {};
        TimesApps.playingSubsequentVideo = true;
        TimesApps.nextVideoObj = a;
        if( typeof a.source == "string" && a.source.indexOf("abovearticle") >= 0 ) {
           var tthis = $(".articlepage[data-articlemsid='" + window.msid + "'] .articlevideo[data-position='abovearticle']");
           tthis.attr("data-msid", a.msid);
           //var tthis = $(".articlepage[data-articlemsid='" + a.articlemsid + "'] .articlevideo[data-position='abovearticle']");
           //loadVideo(tthis, a.msid, "relautonext", true);
         }
       }
       
       window._dash = window._dash || {};
    
        window._dash.userAction = function(action,videomsid){
            
        }

       function getStxt() {
         var stxt = null;
         // var c_stxt = cookie.get("auto_off");
         var c_stxt = Get_Ckie_str("auto_off");
         if (is.empty(c_stxt)) {
           stxt = "on";
         } else {
           if (c_stxt == "true") {
             stxt = "on";
           } else {
             stxt = "off";
           }
         }
         return stxt;
       }
       
       window.switchOffAutoPlay = function(player) {
         if (player == "on") {
           Set_Ckie_str("auto_off",'false',365,"/","","");
           // cookie.set("auto_off", "false", 365, "/", "", false);
           ga('send', 'event', 'Art_show_Video', 'click', 'Autoplay_' + player);
         } else {
           Set_Ckie_str("auto_off",'true',365,"/","","");
           // cookie.set("auto_off", "true", 365, "/", "", false);
           if (player == "off") ga('send', 'event', 'Art_show_Video', 'click', 'Autoplay_' + player);
         }
       }

       function loadVideo(tthis, msid, source, related) {
         var preloader = tthis.find(".preloader");
         var position = tthis.data("position");
         tthis.addClass("loadingvid");
         var hasflash = false;
         var nextmsid = null;
         var nexttitle = null;
         var articlemsid = tthis.closest(".articlepage").attr("data-articlemsid");
         var videoContainer = $('.abovearticle.articlevideo');
         var skipAds = tthis.data("skipads");
         if(videoContainer.hasClass('bigvideo')){
            $('section.vdo').addClass('big'); 
         }
         var hpauto = parseInt($('#ClickToPlayVideoSwitch').val()) == 1 ? 0 : 1;
         //Mark Playing
         if (related === true) {
           markRelatedPlaying(tthis, msid);
         }

         //Set Next Values
         var url = "/article_video_dash.cms?msid=" + msid;;
         var stxt = getStxt();
         if (related === true) {
           nextmsid = getNextRelVideo(tthis, "msid");
           nexttitle = getNextRelVideo(tthis, "title");
           if( source.length > 0 && source.toLowerCase() == "related" ){
               var videoSource = "articleshow/related"
           }else{
               var videoSource = "abovearticle";
               var vidCount = ( $(".abovearticle").index(tthis) >= 0 ) ? $(".abovearticle").index(tthis) : "";
               videoSource += "_" + vidCount;
           }
           url += "&source=" + videoSource;
           url += "&nextid=" + nextmsid;
           url += "&nexttitle=" + nexttitle+"&articlemsid="+articlemsid;
           url += "&videosection=AS-pages";
         } else {
           nextmsid = msid;
           nexttitle = "";
           url += "&source=articleembed&articlemsid="+articlemsid;
           url += "&videosection=AS-pages";
         }
         
        if( skipAds ){
            url += "&skipAds=" + 1;
        }

        if( window.toiprops && window.toiprops._BL_pg ){
            url += "&blKey=1";
        }

         if( TimesApps.playingSubsequentVideo ){
             url += "&userInitiated=0";
         }else{
             url += "&userInitiated=1";
         }
         
         
         url += "&audio="+$("#audio_full").val();
         
         url += "&version=22";

         var toppart = tthis.find(".toppart");
         $.ajax(url)
           .done(function(data) {
             //alert( "success" );
             tthis.addClass("playingvid");
             toppart.find('.vidbox').remove();
             if(videoContainer.hasClass('bigvideo')){
             toppart.append("<div class='vidbox' style='display:none;'><span class='close'></span><div class='dvideo testBG' id='" + msid + "'><div class='vidContainer'>" + data + "</div><div class='animationWrapper-up'></div><div class='animationWrapper-down'></div></div>");
             }
             else{
             toppart.append("<div class='vidbox' style='display:none;'><span class='close'></span><div class='dvideo' id='" + msid + "'>" + data + "</div></div>");
             }
             if (position === "abovearticle" && source !== "related" && related === true) {
               loadRelatedVideos(tthis, msid);
             }
           })
           .fail(function() {
             //alert( "error" );
             tthis.removeClass("loadingvid");
             toppart.find('.vidbox').remove();
             toppart.append("<div class='vidbox' style='display:none;'>" + "<span class='msg error'>Error occured while loading video!<br/>Close this box and try again.</span>" + "</div>");
           })
           .always(function() {
             //alert( "complete" );
             preloader.fadeOut("2000", function() {
               tthis.find(".vidbox").fadeIn("1000", function() {
                 tthis.removeClass("loadingvid");
               });
             $('span.close').click(function(){
                //console.log('removing Class');
                if(videoContainer.hasClass('bigvideo')){
                    $('section.vdo').removeClass('big');
                }
             })
             });
           });
       }

       function markRelatedPlaying(tthis, msid) {
         tthis.find(".slide").removeClass("playing");
         tthis.find(".slide[data-msid='" + msid + "']").addClass("playing");
       }

       function loadRelatedVideos(tthis, msid) {
         tthis.find(".related-videos").slideDown("1000", function() {
           lazy.load();
         });
       }
       $(".articlepage[data-articlemsid='" + msid + "']  .articlevideo").on("click", ".close", function() {
         var tthis = $(this).parent().parent().parent();
         var msid = tthis.data("msid");
         var preloader = tthis.find(".preloader");
         var vidbox = tthis.find(".vidbox");
         var revidbox = tthis.find(".related-videos");
         tthis.removeClass("playingvid");
         preloader.fadeIn("500");
         vidbox.fadeOut("500", function() {
           vidbox.remove();
         });
         revidbox.slideUp("500", function() {
           //revidbox.remove();
         });
         //tthis.html(window.articlevideo[msid]);
       });
     }

     return initVideo;
   });
    /* Article Video Code End */
   
   require(["tiljs/ui", "tiljs/event", "tiljs/load", "tiljs/login", "tiljs/is", "tiljs/util", "tiljs/logger","tiljs/plugin/lazy","tiljs/analytics/mytimes","tiljs/cookie","galogger"], function(ui, event, load, login, is, util, logger, lazy, mytimes, cookie, galogger) {
      
      /*try {
         // initialize modal creation for show stories when user moves out of window
         require(['showStoriesOnMouseOut'], function(showStoriesOnMouseOut){
             showStoriesOnMouseOut.init();    
         });
     } catch(e) {}*/
     
     function loadnlWidget(msid){
         var a =  $(".articlepage[data-articlemsid='" + msid + "'] [data-nlwidget]");
         if ( 
                window.TimesGDPR 
                && TimesGDPR.common.consentModule.gdprCallback
            ){
                TimesGDPR.common.consentModule.gdprCallback(function(data){
                    if(!data.isEUuser){
         $.get(a.data('nlwidget')).done(function(d){
           a.html(d);
         if(!$('[data-node="nlcss"]').data('loaded'))$('[data-node="nlcss"]').attr({'href':$('[data-node="nlcss"]').data('href'),'data-loaded':true})
          if(typeof toiweb != 'undefined'){
                         if(typeof login.getUser() != 'undefined'){
                         $('[data-nl="email"]').val(login.getUser().getEmail());     
                         $('[data-nl="email"]').attr('disabled','disabled'); 
                         if(toiweb.nl.issubscribe){
                         $('[data-nl="submit"]').hide().text('subscribe').attr('class','btn_disable subscibe_btn');
                         $('[data-nl="green"]').show();   
                         }else{
                         $('[data-nl="submit"]').show().text('subscribe').attr('class','subscibe_btn');
                         $('[data-nl="green"]').hide();     
                         }
                         }
                            
                        }       
             }).fail();
                    
                        
                    }
                        
                    })
                }
     }
      
      function loadRelatedArticles(msid) {

        var relatedArticleSection = $(".articlepage[data-articlemsid='" + msid + "'] .relatedarticle");
        
        if(relatedArticleSection.find('li').length){
             relatedArticleSection.show(); 
             return true;
        }
        $.ajax({
            url: "/recommendedarticles_show.cms?ver=2&msid=" + msid,
            cache: true
        }).done(function(data) {
            var relatedArticlesLength = $(data).find('li').length;
            var $article = $('.articlepage');
            var articleseo = $article.data('articleseo');
            var $val, childSeoData, childSeoDataArr = [], childSeoString;
            if (data && relatedArticlesLength > 0) {
                relatedArticleSection.append(data);
                relatedArticleSection.find("li a").each(function(k, val) {
                    $val = $(val);
                    childSeoData = $val.attr('childseodata') || '';
                    childSeoString = ''
                    if(childSeoData) {
                        childSeoDataArr = childSeoData.split('|');
                        childSeoString = childSeoDataArr[0] + ':' + childSeoDataArr[1]
                    }
                    $val.attr('pg', 'Related#Story_View/' + (k + 1) + '/' + msid);
                });
                relatedArticleSection.show();
            }else{
                relatedArticleSection.remove();
            }
        });
      }

      function loadArticle(msid, nextmsid) {
     var articleContainer = $("[data-article-container='" + nextmsid + "']");
     if (articleContainer.attr('data-articleshowajax-status') != "false")
        return false;
     articleContainer.find(".ajaxarticleloading").show();
     articleContainer.attr("data-articleshowajax-status", "loading");
     $.ajax({
         url: "/articleshowajax/" + nextmsid + ".cms?version=20&enforceseoatarticle=0",
         cache: true,
         timeout: 10000
       })
       .done(function(data){
           loadasajax(msid, nextmsid, data);
       })
       .fail(function(xmlhttprequest, textstatus,message){
           articleContainer.attr("data-articleshowajax-status","failed");
           loadNextArticle(nextmsid);
           $('#articlelist').find('[data-msid='+nextmsid+']').remove();
           articleLinkWidget.buildUI(true);
       })
       .always(function() {
            articleContainer.find(".ajaxarticleloading").hide();
       });
   }

     function loadasajax(msid, nextmsid, data) {
         try {
            $("[data-article-container='" + nextmsid + "']").attr("data-articleshowajax-status", "loaded");
            $("[data-msid='" + nextmsid + "']").removeClass("disable");
             if(!is.IE()){
                 setTimeout(function(){
                     loadNextArticle(nextmsid);
                 },1000);
             }
           // $("#ajaxcontent").append(data);
           $("#ajaxcontent").find("[data-article-container='" + nextmsid + "']").html(data);
           loadScorecardWidget(nextmsid);
           /*$('.video-category ').videoOverlay({
                videosection: "articleshow_rhs",
                source: "articleshow_rhs",
                pg : "articleshow_rhs"
               
           });*/
           // Check for you might also like 
           
           if(!($("#ajaxcontent").find("[data-article-container='" + nextmsid + "'] #youmightalsolike ul").length)){
               var $prevArt = $("[data-article-container='" + msid + "'] ");
               var $youmightalsolike = $prevArt.find('#youmightalsolike').eq(0) && $prevArt.find('#youmightalsolike').eq(0).clone()  ;
               $("#ajaxcontent").find("[data-article-container='" + nextmsid + "'] #youmightalsolike").remove();
               $youmightalsolike.insertAfter( "[data-article-container='" + nextmsid + "'] .last6brdiv" );
               
               
           }
           
           require(['tiljs/ui'], function(ui) {
             if (ui.inView($("[data-article-container='" + nextmsid + "']"), true)) {
               articleLinkWidget.activeLink(nextmsid);
             }
           });
    
         } catch (e) {}
         
         $(window).trigger('resize');
         
         if (typeof(colombiaClear) == "function") {
           colombiaClear();
         }
         
         (function(){
                if( typeof newArticleContainer != 'undefined'){
                    var bottomVidSlider = newArticleContainer.find("[data-plugin='video_slideshow']").eq(0);
                    bottomVidSlider.find('.videobox li').each(function(index, obj){
                        $(obj).find('.iconvideo').text($(obj).find('.icon_player').text());
                    });
                    require(["rodate"], function(rodate){
                                            rodate.uptime();
                                });
                    videos_section_slider.init( 
                            bottomVidSlider,
                            bottomVidSlider.closest('.jBottomVidSlider').find('.next'),
                            bottomVidSlider.closest('.jBottomVidSlider').find('.prev')
                    );
                }
            })();
        
         typeof reinitialiseLeftTPWidget == 'function' && reinitialiseLeftTPWidget(msid);
         //call handleRHSbyGeoLocation after next article load
         handleRHSbyGeoLocation(nextmsid);
   }

      function articleLink() {
     var widget, articlelist, linkPerView = 4,
       totalArticleCnt, itemWidth, clickedArticle = null;

     function show() {
       widget.fadeIn();
     }

     function hide() {
       widget.fadeOut();
     }

     function showNav() {
       $('.article_nav').show();
     }

     function updateUI() {
       if( articlelist.length> 0 ){
           
               var linkCnt = articlelist.find('li'),
                 link = articlelist.find('.active'),
                 cnt = +link.data('articleno');
        
               var minMargin = (cnt - linkPerView) * itemWidth,
                 maxMargin = (cnt - linkPerView) * itemWidth * linkPerView;
        
               if (minMargin <= 0) {
                 articlelist.stop(0, 0, 0).animate({
                   marginLeft: '0'
                 }, function() {
                   updateNav();
                 });
               } else {
                 var marginTop = articlelist.css('margin-left').split('px')[0] * (-1);
                 if (marginTop < minMargin || marginTop > maxMargin) {
                   articlelist.stop(0, 0, 0).animate({
                     marginLeft: minMargin * (-1) + 'px'
                   }, function() {
                     updateNav();
                   });
                 }
               }
           
       }
     }

     function buildUI(cntupdate){
       widget = $('#articlelist');
       articlelist = $('#articlelist .articles');
       if(is.IE()){
           articlelist.find('li:gt(4)').remove()
       }
       totalArticleCnt = articlelist.find('li').length;
       
       if (totalArticleCnt < linkPerView){
         widget.hide();
         $('body').css('padding-bottom', '0px');
         return false;
       }
       
       if(typeof cntupdate !="undefined" && cntupdate){
           articlelist.find('li').each(function(idx,val){$(val).attr('data-articleno',idx+1).find('.cnt').text(idx+1);});
       }

       // Add padding to show footer completely 
       $('body').css('padding-bottom', '77px');

    //   itemWidth = $(window).width() / linkPerView;
    //   articlelist.find('a').width((itemWidth - 20) + 'px');
    //   var containerWidth = (itemWidth + 20) * totalArticleCnt + 'px';
    //   articlelist.width(containerWidth);

       widget.show();
       updateNav();
     }

     function init() {
        buildUI();
        bindEvents();
        // open in app code //
        if(/iPad/.test(navigator.userAgent)){
            $('#openapp').removeClass('movedown').addClass('moveup');
            fireOpeninAppAppsFlyer();
        }
     }

     function bindEvents() {
        // open in app code //
        if(/iPad/.test(navigator.userAgent)){
            handleOpenInAppClick();
            openInAppDisplayHandler();   
        } 
         
        articlelist.on('click', 'li', function() {
         var ths = $(this);
         if(ths.hasClass('disable'))
            return false;
         var article_id = ths.data('msid'),
            article_pos = ths.data('articleno'),
            article_link = ths.find('a').attr('href');
        
         if (clickedArticle) {
           clearTimeout(clickedArticle);
         }

         scrollToArticle(article_id);
         if(article_pos !=1){
              clickedArticle = setTimeout(function(){scrollToArticle(article_id);clickedArticle=null;},2000);
         }
         galogger.analyticsFire('PerpetualScroll_HorizontalBar', article_pos, article_link);
         return false;
       });

       widget.on('click', '.article_nav', function() {
         if($(this).hasClass('disable'))
            return false;
            $(this).addClass('disable');
         articleNav($(this).data('type'), $(this));
         return false;
       });
       
       /*$('.video-category ').videoOverlay({
            videosection: "articleshow_rhs",
            source: "articleshow_rhs",
            pg : "articleshow_rhs"
           
       });*/
       
     }

     function articleNav(type, tthis) {

       var minMargin = 0,
         maxMargin = (totalArticleCnt - linkPerView) * itemWidth;

       var marginLeft = articlelist.css('margin-left').split('px')[0] * (-1);

       switch (type) {
         case "prev":
           if (marginLeft > 0) {
             articlelist.stop(0, 0, 0).animate({
               marginLeft: (marginLeft * (-1) + itemWidth) + 'px'
             }, function() {
               updateNav();
             });
           }
           break;
         case "next":
           if (marginLeft < maxMargin) {
             articlelist.stop(0, 0, 0).animate({
               marginLeft: (marginLeft * (-1) - itemWidth) + 'px'
             }, function() {
               updateNav();
             });
           }
           break;
       }
     }

     function updateNav() {
       var minMargin = 0,
         maxMargin = (totalArticleCnt - linkPerView) * itemWidth;
       var marginLeft = articlelist.css('margin-left').split('px')[0] * (-1);
       $('.article_nav').removeClass('disable').hide();
       if (marginLeft > itemWidth/2) {
         $('[data-type="prev"]').show();
       }
       if (Math.floor(marginLeft) < Math.floor(maxMargin)) {
         $('[data-type="next"]').show();
       }
     }

     function scrollToArticle(msid) {
       $('[data-article-container=' + msid + '] .ajaxarticleloading').show();
       
       isGoToArticle = true;
       $('html,body').animate({
         scrollTop: $('[data-article-container=' + msid + ']').offset().top
       },500,function(){isGoToArticle=false;});

       activeLink(msid);
     }

     function activeLink(msid) {
       articlelist.find('.active').removeClass('active');
       articlelist.find("[data-msid='" + msid + "']").addClass('active');
       updateUI();
     }
    
     function getFirstArticleMSID(){
         var id = articlelist.find('li.active').data('msid');
         return (id) ? id : "" ;
     }
     
     return {
       init: init,
       buildUI: buildUI,
       activeLink: activeLink,
       getFirstArticleMSID: getFirstArticleMSID
     }
   }
     
   
      function processComments(id, cnt){
        if($('#comment-section-'+id).data('status'))
            return false;
        $('#comment-section-'+id).data('status',true);
        require({
            config:{"tiljs/apps/times/comments":
                {
                    msid: id,
                    rating:false, // no need to rate for comment
                    rotype:0,
                    messages:{ratemendate:'Please rate before review'},
                    loadCommentFromMytimes:true,
                    nonloggedinComment:true,
                    commentType : "comments_agree",
                    enableparam:true,
                    loadonscroll:false,
                    comment_block_count: cnt,
                    size: cnt
                }
            }
        });
        require(["tiljs/apps/times/api"],function(api){
            api.updateConfig({
                        post_comment: {
        				url: "/toiignorevp/postro2.cms"
        			},
        			comments: {
        				url: "/commentsdata.cms",
        				type: "json",
        				params: {
        					appkey: "TOI",
        					msid: id,
        					sortcriteria: "CreationDate",
        					order: "asc",
        					size: cnt,
        					lastdeenid: 123,
        					after: true,
        					withReward: true,
        					comment_block_count:cnt
        				}
        			},
        			comments_oldest: {
        				url: "/commentsdata.cms",
        				type: "json",
        				params: {
        					appkey: "TOI",
        					msid: id,
        					sortcriteria: "CreationDate",
        					order: "desc",
        					size: cnt,
        					lastdeenid: 123,
        					after: true,
        					withReward: true,
        					comment_block_count:cnt
        				}
        			},
        			comments_agree: {
        				url: "/commentsdata.cms",
        				type: "json",
        				params: {
        					appkey: "TOI",
        					msid: id,
        					sortcriteria: "AgreeCount",
        					order: "desc",
        					size: cnt,
        					lastdeenid: 123,
        					after: true,
        					withReward: true,
        					comment_block_count: cnt
        				}
        			},
        			comments_disagree: {
        				url: "/commentsdata.cms",
        				type: "json",
        				params: {
        					appkey: "TOI",
        					msid: id,
        					sortcriteria: "DisagreeCount",
        					order: "desc",
        					size:cnt,
        					lastdeenid: 123,
        					after: true,
        					withReward: true,
        					comment_block_count:cnt
        				}
        			},
        			comments_discussed: {
        				url: "/commentsdata.cms",
        				type: "json",
        				params: {
        					appkey: "TOI",
        					msid: id,
        					sortcriteria: "discussed",
        					order: "desc",
        					size: cnt,
        					lastdeenid: 123,
        					after: true,
        					withReward: true,
        					comment_block_count:cnt
        				}
        			}
                    });
        });
        require(["comments"],function(comments){
            comments.run({
            main:'#comments_agree',
            msid:id,
            wrapper:'#comment-section-'+id
            });
        });
        
        $('#comment-section-'+id).on('mouseover','.more-btn, .badge',function(){
            lazy.load();
        });
	 }
	 
	  function wrapfbquote(fbEmbeds){
	      try{
    	      fbEmbeds.each(function(){
    	          if(!$(this).parent().parent().hasClass("fb-post")){
    	              $(this).wrap('<div class="fb-post" data-href="'+$(this).attr('cite')+'" data-width="500"><div class="fb-xfbml-parse-ignore">');
    	          }
    	      });
	      }catch(e){}
        }
        
      function processFBEmbed(){
            if(window.FB){
                window.FB.XFBML.parse();
            }else{
                if(!$('#facebook-jssdk').length){
                    load.js('//connect.facebook.net/en_US/all.js#xfbml=1&amp;appId=117787264903013', function () {
                        window.FB.XFBML.parse();
                    },'facebook-jssdk');
                }
            }
        }
        
      function processTwttrEmbed(){
            if(window.twttr){
                window.twttr.widgets.load();
            }else{
                if(!$('#twitter-wjs').length){
                    require(["tiljs/social/twitter"], function (twitter) {
            			 twitter.init({parse: true});
            		});
                }
            }
        }
        
      function processInstgram(){
            if(window.instgrm){
                window.instgrm.Embeds.process();
            }else{
                if(!$('#instagram-jssdk').length){
                    load.js('//platform.instagram.com/en_US/embeds.js', function () {
                        window.instgrm.Embeds.process();
                    },'instagram-jssdk');
                }   
            }
        }
        
        function ShoppingGadgets(msid){
		        
		        var _shopping_gadgets = $(".articlepage[data-articlemsid='" + msid + "']").find('.shopping_times_wdgt'),
		            _prev_nav  = _shopping_gadgets.find('[data-slider="prev"]'),
		            _next_nav  = _shopping_gadgets.find('[data-slider="next"]'),
		            _slide_outer = _shopping_gadgets.find('.shopping_gadgets_outer'),
		            _total_slide_cnt = _slide_outer.find('.shopping_gadgets_frame').length,
		            _slide_in_view = 1,
		            _slide_block_width = 320,
		            _active_slide_frame = 1,
		            _frame_width = _slide_in_view*_slide_block_width,
		            _slide_frames = [],
		            _total_frames = Math.ceil(_total_slide_cnt/_slide_in_view),
		            _is_lock = 0;
		            
		            
		        function setFramesProp(){
		            _slide_frames[0] = 0;
		            for(idx = 1; idx < _total_frames; idx++){
		                
		                // last frame
		                if((idx+1) == _total_frames){
		                    _slide_frames[idx] = (_total_slide_cnt - ((_total_frames-1)*_slide_in_view))*_slide_block_width*(-1) + _slide_frames[idx-1];
		                }else{
		                    _slide_frames[idx] = (_frame_width*idx)*(-1);
		                }
		            }
		        }

		        function bindEvents(){
		            _shopping_gadgets.on('click','[data-slider="prev"]',function(){
		                if($(this).hasClass('disable') || _is_lock)
		                    return false;
		                _is_lock = 1;
		                slidePrev();
		            });
		            
		            _shopping_gadgets.on('click','[data-slider="next"]',function(){
		                if($(this).hasClass('disable') || _is_lock)
		                    return false;
		                _is_lock = 1;
		                slideNext();
		            });
		            
		            setFramesProp();
		            
		            updateNavView();
		        }
		        
		        function updateNavView(){
		            if(_active_slide_frame != 1){
		               _prev_nav.removeClass('disable');
		            }else{
		               _prev_nav.addClass('disable');
		            }
		            
		            if(_active_slide_frame != _total_frames){
		               _next_nav.removeClass('disable');
		            }else{
		               _next_nav.addClass('disable');
		            }
		        }
		        
		        function slideCarousel(dir){
		            var pos = null;
		            if((_active_slide_frame == _total_frames) || _active_slide_frame ==1){
		                pos = _slide_frames[_active_slide_frame-1] +"px";
		            }else{
		                pos = +_slide_outer.css('margin-left').split('px')[0];
		                pos += (dir == 'prev') ? _frame_width : _frame_width*(-1); 
		            }
		            
		            _slide_outer.stop(0,0,0).animate({
		                'margin-left': pos
		            },function(){
		                _is_lock = 0;
		                updateNavView();
		            });
		        }
		        
		        function slidePrev(){
		            _active_slide_frame--;
                    slideCarousel('prev');
		        }
		        
		        function slideNext(){
		            _active_slide_frame++;
		            slideCarousel('next');
		        }
		        
		        return {
		            init:function(){
		                bindEvents();
		            }
		        }; 
		    }

        window.times = times || {};
        window.times.mobile =  window.times.mobile || {};
        window.times.mobile.shopping = {};

        window.times.mobile.shopping.wdtresponse = function(data){
            window._shopping_gadgets_dom = '';
            buildGadgetsResp(data);
        }
        
      
        function buildGadgetsResp(data){
            var arrayResponse = $.map(data, function(value, index) {
                return [value];
            });
            var _no_of_frame = 4;
            var totalFrame = Math.ceil(arrayResponse.length / _no_of_frame);
            for(idx=0; idx<totalFrame; idx++){
                window._shopping_gadgets_dom +=buildFrameChunk(arrayResponse, idx*_no_of_frame, _no_of_frame * (idx + 1));
            }
            $('[data-widget="shopping-gadgets"]').each(function(){
                $(this).html(window._shopping_gadgets_dom);
                var shoppingGadgets = new ShoppingGadgets($(this).data('shoppingmsid'));
		        shoppingGadgets.init();
            });
        }
            
        function buildFrameChunk(data, start_idx, end_idx){
            var frameDom = '<ul class="shopping_gadgets_frame">';
            for(i=start_idx; i<end_idx && data[i]; i++){
                   
                var pg_attr = 'AS_tech#shop#'+(i+1)+'_'+data[i].PRODUCT_NAME;
                
                frameDom += '<li><a rel="nofollow" pg="'+pg_attr+'" class="gdt_img" href="'+ data[i].PRODUCT_URL +'?utm_source=toiweb&utm_medium=referral&utm_campaign=toiweb_asrhswidget" target="_blank"><img src="/photo/34824568.cms" data-src="'+ data[i].IMAGE_URL +'" alt="Shop Gadgets"></a><span class="prodCP"><a pg="'+pg_attr+'" href="'+ data[i].PRODUCT_URL +'?utm_source=toiweb&utm_medium=referral&utm_campaign=toiweb_asrhswidget" target="_blank"><span class="gad_name">'+ data[i].PRODUCT_NAME+'</span><span class="price">&#8377; '+ data[i].PRICE +'</span>';
                if(!!(data[i].FEATURE)){
                    frameDom += '<span class="ftrd">'+data[i].FEATURE+'</span>';
                }
                frameDom += '<span class="buybtn">BUY</span></a></span></li>';
            }
            frameDom +='</ul>';
            return frameDom;
        }
        
        function loadGadgets(msid){
            
            if(!$('[data-widget="shopping-gadgets"]').length)
                return false;
            
            if(window._shopping_gadgets_dom){
                $(".articlepage[data-articlemsid='" + msid + "']").find('[data-widget="shopping-gadgets"]').html(window._shopping_gadgets_dom);
                
                var shoppingGadgets = new ShoppingGadgets(msid);
		        shoppingGadgets.init();
                
                return false;
            }
           
            $.ajax({
                type: "GET",
                dataType: "jsonp",
                url: 'https://www.shop.gadgetsnow.com/gsearch/gadgetsnow.php',
                timeout: 10000,
                success: function(data) {
                    
                }
            });
            
            
        }
        
        function processEverytime(msid, isFirstArticle){
            
            // close comments on article change
            if ( $('.comments[data-commentmsid].slide-in').length && times.articleshow && times.articleshow.sc && times.articleshow.sc.hideComments ) {
                var $comments = $('.comments[data-commentmsid].slide-in');
                times.articleshow.sc.hideComments($comments);
            }
            
        }
   
       function processarticle(msid, isFirstArticle) {
            processEverytime(msid, isFirstArticle);
            // Check if article is already processed
            if($(".articlepage[data-articlemsid='" + msid + "']").data('articleprocess'))
                return false;
            
            if(!!isBrandwireArticle(msid)){
                //buildBrandwireLink(msid);
            }
            
            if(typeof __activity != "undefined"){
                __activity.push("read");
            }
            
            $(".articlepage[data-articlemsid='" + msid + "']").data('articleprocess',true);
            logger.log("Process Article: " + msid);
            
            
            if($(".articlepage[data-articlemsid='" + msid + "'] blockquote[class*='twitter']").length || $(".articlepage[data-articlemsid='" + msid + "'] .twitter-timeline").length){
                processTwttrEmbed();
            }
            
			if($(".articlepage[data-articlemsid='" + msid + "'] blockquote[cite*='facebook']").length || $(".articlepage[data-articlemsid='" + msid + "'] .fb-like-box").length){
			    wrapfbquote($(".articlepage[data-articlemsid='" + msid + "'] blockquote[cite*='facebook']"));
			    processFBEmbed();
			}
            
			if($(".articlepage[data-articlemsid='" + msid + "'] blockquote[class*='instagram-media']").length){
			    processInstgram();
			}
            
            //Clears the queue of CTN Ads for Every article except 1st one
            if(!isFirstArticle && colombia && typeof(colombia.clearData)==='function'){
                colombia.clearData();
            }
            
            // Process CTN ads
            processAds(msid);
            
            // Click event for tech gadget
            $(".articlepage[data-articlemsid='" + msid + "'] [data-ha]").on('click', function(){
                var aid = $(this).attr('data-ha');
                $('[data-ht = '+aid+']').toggle('fast');
                $(this).find('i').toggleClass('expand');
            });

             // Highlight summary
             $(".articlepage[data-articlemsid='" + msid + "'] .highlight .hsummary").mCustomScrollbar({
               theme: "dark",
               scrollButtons: {
                 enable: false
               },
               mouseWheel: {
                 enable: true,
                 scrollAmount: 52
               },
               advanced: {
                 updateOnContentResize: true
               }
             });
        
             // Related Videos
             $(".articlepage[data-articlemsid='" + msid + "'] .abovearticle .slider-inner").mCustomScrollbar({
               theme: "dark",
               scrollButtons: {
                 enable: false
               },
               mouseWheel: {
                 enable: true,
                 scrollAmount: 52
               },
               advanced: {
                 updateOnContentResize: true
               }
             });
             
             // Social Sharing
             require(["ui_socialshare"], function(socialshare) {
                
               // Slideshow
               var s1 = {
                 element: "article-social", //Class Assigned to Share Buttons
                 c_ceclass: "toishare", //Class used for icons rendered
                 c_sprite: "show_sprite", //Sprite Class
                 i_comment: "write", //comments ID
                 icons: "fb,twitter,gplus,linkedin,pinterest",
                 position: "articleshow_slideshow_social",
                 pgtag: "articleshow_slideshow_social",
                 c_sharebtn: "sharebtn"
               };
               $(".articlepage[data-articlemsid='" + msid + "'] .slideshowcontainer .toiwidgets_social").socialShare(s1);
               // Video
               var s2 = {
                 element: "article-social", //Class Assigned to Share Buttons
                 c_ceclass: "toishare", //Class used for icons rendered
                 c_sprite: "show_sprite", //Sprite Class
                 i_comment: "write", //comments ID
                 icons: "fb,twitter,gplus,linkedin,pinterest",
                 position: "articleshow_video_social",
                 pgtag: "articleshow_video_social",
                 c_sharebtn: "sharebtn"
               };
               $(".articlepage[data-articlemsid='" + msid + "'] .articlevideo .toiwidgets_social").socialShare(s2);
               // Top Social
               var s3 = {
                 element: "article-social", //Class Assigned to Share Buttons
                 c_ceclass: "toishare", //Class used for icons rendered
                 c_sprite: "show_sprite", //Sprite Class
                 i_comment: "write", //comments ID
                 icons: "email,print,fontd,fonti",
                 c_font: "articleshow",
                 c_font_attr: true,
                 fontdefaultsize: 100,
                 fontchangesize: 5,
                 position: "articleshow_new_topsocial",
                 pgtag: "ReadibilityIcons",
                 pg_prefix:"AS1_",
                 href: getArticleUrl(msid),
                 print_url:"/articleshowprint/"+msid+".cms",
                 image: getImageUrl(msid),
                 twt_short_url: getArticleShortUrl(msid)
               };
               $(".articlepage[data-articlemsid='" + msid + "'] .topsocial .toiwidgets_social").html('').socialShare(s3);
               
               var articlesec =  $(".articlepage[data-articlemsid='" + msid + "']").data('articlesec');
               
               /*********TODO: Remove below check...keep it in xslt**********/
               if(isFirstArticle && articlesec == "India"){
                   $("#navigation #nav-india").addClass('current');
               }
               /**********************************************************/
               
               var via = $(".articlepage[data-articlemsid='" + msid + "']").data('tweethandle');
                var hash = $(".articlepage[data-articlemsid='" + msid + "']").data('tweethash');
               
               // Left Social
               var iconsList = ($('[data-comment-type="slider"]').length) ? "fb,twitter,gplus,linkedin,pinterest,comment-slider" : "fb,twitter,gplus,linkedin,pinterest"
               var s4 = {
                 element: "article-social", //Class Assigned to Share Buttons
                 c_ceclass: "toishare", //Class used for icons rendered
                 c_sprite: "show_sprite", //Sprite Class
                 i_comment: "write", //comments ID
                 icons: iconsList,
                 position: "articleshow_new_leftsocial",
                 pgtag: "Share",
                 pg_prefix:"AS1_",
                 twt_short_url: getArticleShortUrl(msid),
                 twt_via: via,
                 twt_hash: hash,
                 href: getArticleUrl(msid),
                 title: $(".articlepage[data-articlemsid='" + msid + "']").find("[data-articletitle]").text(),
                 image: getImageUrl(msid)
               };
               $(".articlepage[data-articlemsid='" + msid + "'] .leftsocial .toiwidgets_social").html('').socialShare(s4);
               // RHS Social
               
               var rhsSocial = {
                 element: "article-social", //Class Assigned to Share Buttons
                 c_ceclass: "toishare", //Class used for icons rendered
                 c_sprite: "show_sprite", //Sprite Class
                 icons: "fb,twitter,gplus",
                 position: "articleshow_new_leftsocial",
                 pgtag: "Share",
                 pg_prefix:"AS1_",
                 twt_short_url: getArticleShortUrl(msid),
                 twt_via: via,
                 twt_hash: hash,
                 href: getArticleUrl(msid),
                 title: $(".articlepage[data-articlemsid='" + msid + "']").find("[data-articletitle]").text(),
                 image: getImageUrl(msid)
               };
               $(".sidebar .toiwidgets_social.rhs").html('').socialShare(rhsSocial);
             });
            
             // Slideshow    
             require(["slideshow"], function(slideshow) {
               var s = {};
               //Master Settings
               s.ms = {
                   // These are the defaults. Data-Slider Properties to be applied
                   d_slides: "slides", //Div that contain all the slides
                   d_nextbtn: "next", //Next Buttons
                   d_prevbtn: "prev", //Prev Buttons
                   d_current: "current", //Current Slide Display Box (Optional)
                   d_total: "total", //Total Slide Display Box (Optional)
                   btnclass: "disabled", //Class to apply on disabled/hidden buttons
                   events: true,
                   master: true,
                   startAt: 1,
                   slidesInView: 1,
                   slideAtOnce: 1,
                   slideTime: 400,
                   syncTo: ["[data-slideshow='slave']"],
                   scrollbar: false,
                   defaultCaption: false
                 }
                 //Slave Settings
               s.ss = {
                 // These are the defaults. Data-Slider Properties to be applied
                 d_slides: "slides", //Div that contain all the slides
                 events: false,
                 master: false,
                 startAt: 1,
                 slidesInView: 1,
                 slideAtOnce: 1,
                 slideTime: 400,
                 syncTo: [],
                 scrollbar: false
               }
               $(".articlepage[data-articlemsid='" + msid + "'] .slideshowcontainer").slideShow(s);
             });
             
             // Select / Inline Share
             require(['jquery', 'ui_selectshare', 'ui_inlineshare'], function($, selectshare, inlinshare) {
               $(function() {
                 var fullurl = window.location.href;
                 var shorturl = getArticleShortUrl(msid);
                 var via = $(".articlepage[data-articlemsid='" + msid + "']").data('tweethandle');
                 var hash = $(".articlepage[data-articlemsid='" + msid + "']").data('tweethash');
                 
                 var s = {
                   pos: "right",
                   shareBoxWidth: 20,
                   minusOffsetTop: 35,
                   shortUrl: shorturl,
                   via: via,
                   hash: hash
                 };
                 $(".articlepage[data-articlemsid='" + msid + "'] .article_content").selectShare(s);
                 
                
                 var s2 = {
                   classis: "inlineshare",
                   classoriginal: "inlineoriginal",
                   classfb: "fb",
                   classtw: "twitter",
                   pagename: "articleshow",
                   pg_prefix:"AS1_",
                   icons: "facebook,twitter",
                   iconposition: "after",
                   twitterat: "timesofindia",
                   href:getArticleUrl(msid),
                   fullurl: fullurl,
                   shorturl: shorturl
                 };
                 $(".articlepage[data-articlemsid='" + msid + "'] .article_content").inlineShare(s2);
                 $(".articlepage[data-articlemsid='" + msid + "'] [data-inlineshare]").mouseenter(function() {
                     $(this).parent().find(".inlineoriginal").addClass("inlinebb");
                   })
                   .mouseleave(function() {
                     $(this).parent().find(".inlineoriginal").removeClass("inlinebb");
                   });
               });
             });
            
             // Init Video
             require(["articlevideo"], function(articlevideo) {
               articlevideo(msid);
               
               if(typeof isFirstArticle != "undefined" && isFirstArticle){
                   var ClickToPlayVideoSwitch = $('#ClickToPlayVideoSwitch').val() || '';
                   if(typeof _geo != "undefined" && _geo == "1"){
                		if(Get_Ckie_str("auto_off")!='true' && parseInt(ClickToPlayVideoSwitch) == 0){
                		    $('.articlepage:first .articlevideo:first .articlevideo_pic').siblings('.play-icon').trigger('click');
                		}
                	}
                	else{
                	    if(typeof(switchOffAutoPlay) === 'function') {switchOffAutoPlay();}
                	}
               }
             });
            
             // Image Caption
             $(".articlepage[data-articlemsid='" + msid + "'] .img_cptn").on('click', '.toggle_cptn', function(e) {
               var tag = $(this).closest('.img_cptn'),
                 cptn = tag.data('cptn'),
                 cptn_view = tag.data('cptn-view');
               if (cptn_view == 'less') {
                 tag.html(cptn + " <a class='toggle_cptn'>Less</a>");
                 tag.data('cptn-view', 'full');
               } else {
                 tag.html(cptn.substring(0, 110) + "... <a class='toggle_cptn'>Read More</a>");
                 tag.data('cptn-view', 'less');
               }
               return false;
             });
             
             // Entertainment section social tab switching logic
             $(".articlepage[data-articlemsid='" + msid + "'] .social_tabs").on('click','.ftblock:not(".active")', function(e) {
                  $(this).addClass("active");
                  $(this).siblings(".ftblock").removeClass("active");
                  
                  var b = $(this).attr('ftid');
                  $(this).siblings('div[ftsec=fbblock]').hide(); 
                  $(this).siblings('div.'+ b).show();
                  
                  return false;
             });
             
             //Add tracking attribute for links
             $(".articlepage[data-articlemsid='" + msid + "'] .article_content a").each(function(k,val){
                 if(!$(val).attr('pg')){
                     $(val).attr('pg',"AS1_InlineMedia#AS1_"+window.location.href+"~"+$(val).text()+"-"+$(val).attr('href'));
                 }
             });
             
             // Fire GA for social icons
             $('.articlepage[data-articlemsid=' + msid + '] .leftsocial .toiwidgets_social').on('click','span',function(){
                galogger.analyticsFire('Share', $(this).data('type'), window.location.href); 
             });
             
             // Change pg attr for Most Popular links
             $('.articlepage[data-articlemsid=' + msid + '] .popular_widget li [pg]').each(function(k,val){
                 var newpg= "AS1_RHS#AS1_MostPopular#AS1_"+(k+1)+ "-" +  getArticleUrl(msid);
                 $(this).attr('pg', newpg);
             });
             
             // Change pg attr for latest gadgets links
             $('.articlepage[data-articlemsid=' + msid + '] .latest_gadgets li a').each(function(k,val){
                 var newpg= "AS1_RHS#AS1_Tech_LatestGadgets#AS1_"+(k+1)+ "-" +  getArticleUrl(msid);
                 $(this).attr('pg', newpg);
             });
             
             //Load shopping gadgets
             loadGadgets(msid);
             
             // Load comments
             processComments(msid,3);
             
             processbuyT(msid);
             
             // Related Articles
             //loadRelatedArticles(msid);
             
             loadnlWidget(msid);
             
             //log activity in mytimes for logged-in user
             if(window.location.host === "timesofindia.indiatimes.com" && cookie.get('MSCSAuth')){
                mytimes.logActivity(getActivityConfig(msid));
             }
   }
        
        function isBrandwireArticle(article_msid){
            return $(".articlepage[data-articlemsid='" + article_msid + "']").data('isbrandwire');
        }
        
        function renderBrandwireResponse(data){
            var res = data && data.flagData && data.flagData.topComment;
            if(!!res){
                resp = res;
                $.each(resp, function(index, obj){
                    if (obj.hasOwnProperty('msid')) {
                        var msid = obj['msid'],
                            article_wrapper = $('[data-articlemsid="'+msid+'"]'),
                            response_wrapper,
                            data_type;
                        if(obj.Times_C == 1){
                            data_type = 'timesview';
                            response_wrapper = article_wrapper.find('.brandwire_response_wrapper');
                        }

                        if (obj.Add_C == 1 && obj.Pre_C == 0 && obj.Re_C == 0) {
                            data_type = 'addendum';
                            response_wrapper = article_wrapper.find('.brandwire_response_wrapper');
                        }

                        if (obj.Add_C == 0 && obj.Pre_C == 1 && obj.Re_C == 0) {
                            data_type = 'comment';
                            response_wrapper = article_wrapper.find('.brandwire_comment_wrapper');
                        }

                        if (obj.Add_C == 0 && obj.Pre_C == 0 && obj.Re_C == 1) {
                            data_type = 'rebbutal';
                            response_wrapper = article_wrapper.find('.brandwire_response_wrapper'); 
                        }
                        
                        if(data_type == 'timesview'){
                            response_wrapper.find('[data-contentid="'+obj.N_W_M1+'"]').after($('#brandwire_'+data_type).html());
                        }else{
                            response_wrapper.append($('#brandwire_'+data_type).html());
                        }
                       // response_wrapper.append($('#brandwire_'+data_type).html());
                        
                        var tthis = response_wrapper.find('[data-parse="false"]')[0];
                        
                        title = $('<div/>').html(obj.N_T).text();
                        desc = $('<div/>').html(obj.C_T.replace(/amp;/g,'').replace(/&lt;br\/&gt;/g,'<br/>').replace(/&lt;br \/&gt;/g,'<br/>'))
                        
                        $(tthis).show().addClass(data_type);
                        $(tthis).attr('data-contentid',obj.N_W_M);
                         $(".brandwire_title", tthis).html(title);
                         
                        if (data_type == "comment") {
                            article_wrapper.find(".noComment").hide(0).delay(5000);
                        }
                        
                        $(".brandwire_date", tthis).html(obj.C_D);

                        if (obj.hasOwnProperty('N_I') && obj.N_I.length) {
                            $(".brandwire_img", tthis).html("<img src='" + obj.N_I + "' />");
                        }else{
                            $(".brandwire_img", tthis).hide();
                        }

                         $(".brandwire_content", tthis).html(desc);
                        $(tthis).find('.more').morelessBtn({showChar: 200});
                        $(tthis).closest('.brandwire_response').removeClass('hide');
                        $(tthis).attr('data-parse', true);

                    }
                });
            }
        }
        
        // function processbrandwire(article_msid){
        //     $(".articlepage[data-articlemsid='" + article_msid + "'] .brandwire").brandwire({apiUrl:'http://myt.indiatimes.com/mytimes/getFeed/Activity?msid='+article_msid+'&curpg=1&appkey=TOI&sortcriteria=CreationDate&order=asc&size=30&pagenum=1&withReward=true', parent:$(".articlepage[data-articlemsid='" + article_msid + "']")});
        // }
        
        function buildBrandwireLink(msid){
            var article_content = $("[data-article-container="+msid+"] .article_content").html();
            var rep = article_content.match(/(This story has been published.*Brandwire\.in)/gi);
            if (rep === null){
                rep = article_content.match(/(Press Release by .*via Brandwire\.in)/gi);
            }
            if(rep!=null){
                rep = '<i class="italic-brandwire" style="font-weight:700;font-style:italic">' + rep + '</i>';
                var url = "https://www.brandwire.in/Press-Releases.html?utm_source=toi&utm_medium=prlink&utm_campaign="+$('.navbdcrumb li:last').prev().text().replace(/ /g,'').toLowerCase();
                rep = rep.replace(/(Brandwire\.in)/gi,'<a rel="nofollow" target="_blank" href="'+url+'">$1</a>')
                var newHTML = article_content.replace(/(This story has been published.*Brandwire\.in)/gi, rep);
                    newHTML = article_content.replace(/(Press Release by .*via Brandwire\.in)/gi, rep);
                $("[data-article-container="+msid+"] .article_content").html(newHTML);
            }
        }
   
      function getActivityConfig(msid){
        var params = {
			appKey: "TOI",
			uniqueAppID: msid,
			activityType: "Read", 
			baseEntityType: "ARTICLE",
			objectType: "B",
			url: getArticleUrl(msid)
		}
        return params;
    } 
   
      function processbuyT(article_msid){
       $("#buyt_300_"+article_msid).trigger("buyt");
   }

       var  sponsorAdsCnt=1;
       function loadSponsorAds(msid){
        
        // check if BRs <= 9 and ads is already exists 
        if($(".articlepage[data-articlemsid='" + msid + "']").find('br').length <= 9 || $(".articlepage[data-articlemsid='" + msid + "'] .sponsor_block").length)
            return true;
            
        var tdiv = $(".articlepage[data-articlemsid='" + msid + "'] .last8brdiv");
        
        var adcode=320694;
        
        if(toiprops.subsec1!=undefined && (toiprops.subsec1=='1081479906' || toiprops.subsec1=='2886704' || toiprops.subsec1=='27975577')){
           adcode=322222; 
        }
        
        
        //TODO: BEFORE PUSHING IT TO LIVE. CHANGE AD-ID TO 129146
        if(typeof toiprops != "undefined" && toiprops.hasOwnProperty('_Hyp1_pg') && (toiprops._Hyp1_pg.indexOf('_campaign') !== -1 || toiprops._Hyp1_pg.indexOf('noads') !== -1)){
        }else{
            tdiv.append('<div class="sponsor_block clearfix"><ul class="colombia" style="clear:both;" id="'+ adcode +'-' + msid + sponsorAdsCnt + '" data-skew="0" data-ad-size="[0,370]" data-expansion-size="[0,480]" data-adwidth="640" data-loop="0" data-callback="sponsorAdSuccess" data-position="' + msid + sponsorAdsCnt++ + '" data-slot="'+ adcode +'" data-autoplay="false" data-native-vid-tmpl="ctn_belly_vid" data-native-tmpl="ctn_midarticle" data-desc-len="90"></ul><div class="alR"><span class="clmblogo">Recommended By Colombia<i class="clmcup"></i></span></div></div>');
            if (typeof(ga) == "function" && toiprops.subsec1!=undefined && (toiprops.subsec1=='-2128936835' || toiprops.subsec1=='4719148')) ga('send', 'event', 'CTN_Request', 'Ad_Call_Triggered', window.location.href, {'nonInteraction': 1});
        }
    
    } 
    
        function processAds(msid) {
            /*
         var popular = $(".articlepage[data-articlemsid='" + msid + "'] .popular_widget .list10 li");
         var i = 0;
         popular.each(function(k, v) {
           if ((k + 1) % 3 == 0) {
             var adli = '<li id="129140-' + msid + '" class="ad clearfix colombia" data-slot="129140" data-msid="' + msid + '" data-position="' + msid + i + '" data-native-tmpl="ctn_mostpopular" data-cb="processCtnAds" data-desc-len="110"/>';
             adli += '<li id="129141-' + msid + '" class="ad clearfix colombia" data-slot="129141" data-msid="' + msid + '" data-position="' + msid + i + '" data-native-tmpl="ctn_mostpopular" data-cb="processCtnAds" data-desc-len="110"/>';
             $(adli).insertAfter(v);
             i++;
           }
         });*/
         
         //Do not show ads in Brandwire
         if(!isBrandwireArticle(msid)){
            loadSponsorAds(msid); 
         }
            
    }
   
       function commentVisibility(msid){
          var loadedCommentArticle =  $("[data-articlemsid="+msid+"]");
           if(typeof Storage !== "undefined" && window.location.href.indexOf(msid)==-1 && !is.IE() && !is.tablet()){
             sessionStorage.setItem('comment:loaded:'+msid, 1);
           }else{
               var sortoption = loadedCommentArticle.find('#comment_sort').val(),
                   commentsection = sortoption.length ? "#comments_"+sortoption : "#comments";
            loadedCommentArticle.find(commentsection).show();
           }
      }
      
      function expandTopCommentReplies($ele) {
          var t = $ele,
            tc=t.closest('.comment-box'),
            tc_level = tc.data("level"),
            tc_next = tc.next(),
            tstatus = t.attr("data-togglereplies"),
            response_cnt = 0;
          t.attr("data-togglereplies", "hide");
          while (tc_next.data("level") != tc_level) {
            if (response_cnt == 3) {
              tc_next.before('<div class="show_all_responses comment-box level' + (tc_level + 1) + '" data-level=' + tc_level + ' data-action="all_responses"> Show all responses </div>');
              break;
            } else {
              tc_next.slideDown();
              tc_next = tc_next.next();
              if (!is.numberOnly(tc_next.data("level"))) {
                break;
              }
            }
            response_cnt++;
          }
        }
        function markAuthorComment(d){
            var authID;
            if(typeof d['flagData']['authorsComment'] !="undefined" && d['flagData']['authorsComment'].length){
                for(idx=0; idx<=d['flagData']['authorsComment'].length; idx++){
                    if(!d['flagData']['authorsComment'][idx]['CHILD']){
                        authID = d['flagData']['authorsComment'][idx]['A_ID'];
                        break;
                    }
                    //var authCmtID = d['flagData']['authorsComment'][idx]['A_U_I'];
                    //$('[data-id="'+authCmtID+'"]').addClass('authCmt');
                }
            }
            $('[data-userid="'+authID+'"]').addClass('authCmt');
        }
        
      /* Code for top comments */
      event.subscribe("comments.loaded", function(data) {
       var msid = data.config.msid;
       markAuthorComment(data);
        //if(!!isBrandwireArticle(msid)){
            // hack to handle comment count for brandwire
            $('[data-commentmsid="'+msid+'"] [data-plugin="comment-count"]').text(data.flagData.totalcount);
        //}
       
       renderBrandwireResponse(data);
       
       commentVisibility(msid);
       var div = $(".articlepage[data-articlemsid='" + msid + "'] .last4brdiv").first();
       if(($(".articlepage[data-articlemsid='" + msid + "']").find('br').length > 7) && div.length > 0 && div.attr("data-topcmt-status") != "true") {
         div.attr("data-topcmt-status", true);
         
         var commentObj, commentChunk, commentTitle;
         if(data.priorityComments && data.priorityComments.length > 0){
             commentObj = data.priorityComments[0];
         }else{
             commentObj = data.comments[0];
         }
         
         if (commentObj.comment.length > 220) {
           commentChunk = '<span class="cmnttxt">' + commentObj.comment.substr(0, 199) + '... <span class="detail_comment_link">Read More</span></span><span class="cmnttxt" data-type="full_top_cmnt" style="display:none;">' + commentObj.comment + '</span>';
         } else {
           commentChunk = '<span class="cmnttxt">' + commentObj.comment + '</span>';
         }
         
        commentTitle = (data.comments[0].opinion[0].count > 0) ? "Top" : "Latest";
        
        /* Expand top comment replies*/
        if(commentObj.opinion[0].count > 0 && !$('[data-comment-type="slider"]').length){
            var responseToggle = $('[data-commentmsid='+msid+']').find('#comments_agree .comment-box:first [data-action="toggle_replies"]');
            if(responseToggle){
                expandTopCommentReplies(responseToggle);
            }
        }
        /**/
        
        if ($('[data-comment-type="slider"]').length) {
            div.append('<div class="show_wdgt topcomment" data-plugin="show-comments"><div class="msg"><h2><span>'+commentTitle+'</span> Comment</h2>' + commentChunk + '<span class="cmntauthor">' + commentObj.user.name + '</span></div><input type="button" data-plugin="show-comments" data-type="allcomment" class="btn" value="See All Comments" pg="TopComment#SeeAllComments#'+getArticleUrl(msid)+'"/><input type="button" data-plugin="show-comments" data-showtype="autofocus" data-type="addcomment" class="btn" value="Add Comment" pg="TopComment#AddComment#'+getArticleUrl(msid)+'"/></div>');
        }
        else {
            div.append('<div class="show_wdgt topcomment" data-plugin="show-comments"><div class="msg"><h2><span>'+commentTitle+'</span> Comment</h2>' + commentChunk + '<span class="cmntauthor">' + commentObj.user.name + '</span></div><input type="button" data-type="allcomment" class="btn" value="See All Comments" pg="TopComment#SeeAllComments#'+getArticleUrl(msid)+'"/><input type="button" data-type="addcomment" class="btn" value="Add Comment" pg="TopComment#AddComment#'+getArticleUrl(msid)+'"/></div>');
        }
    }
       
        if ($('[data-comment-type="slider"]').length) {
            if (data.flagData && typeof data.flagData.totalcount != 'undefined') {
                var $icon = $(".articlepage[data-articlemsid='" + msid + "'] .toiwidgets_social .show_sprite.comment-slider");
                var $totalCount = $(".articlepage[data-articlemsid='" + msid + "'] [data-plugin='comments-total-count']");
                var commentText = data.flagData.totalcount >1 ? ' comments': ' comment'
                $icon.addClass('comment-loaded');
                $icon.append('<span class="tcount"><small>'+ data.flagData.totalcount +'</small> Comments</span>');
                $totalCount.html(data.flagData.totalcount + commentText);
            }
            
            (function(){ // Create bottom comments append
                var $article = $(".articlepage[data-articlemsid='" + msid + "']");
                var isTablet = function () {
            		return( function ( a ) {
            			return /(?:ipad|tab)/i.test( a );
            		} )( navigator.userAgent || navigator.vendor || window.opera );
            	};
            	
            	if (isTablet()) {
            	    // Don't need to create bottom comments
            	    // Scroll bind events pass through common flow
            	    return false;
            	}
            	
                if ( !$article.find('.bottom-comments').length) {
                    var $btmComments = $('<div class="bottom-comments" data-msid="'+ msid +'">');
                    var cmtArr = data.comments.filter(function(c){
                        return (c.level === 1);
                    });
                    
                    var l = Math.min(3, cmtArr.length);
                    for (var i = 0; i < l; i++) {
                        var cObj = cmtArr[i],
                            cls = 'comment-box level1';
                        if(!!cObj['authrid'] && cObj['authrid'].length){
                            cls +=' authCmt';
                        }
                        var $cmt = $('<div class="'+cls+'" data-id="'+ cObj.id +'">');
                        var user = cObj.user.username || cObj.user.id;
                        var $username = (user) ? '<a href="http://mytimes.indiatimes.com/profile/'+ user +'" class="name" target="_blank">'+ cObj.user.name +'</a>' : '<span class="name">'+ cObj.user.name +'</span>';
                        // var $username = '<span class="name">'+ cObj.user.name +'</span>';
                        var userimg = cObj.user.image || '/photo/29251859.cms';
                        var cmtStr = (cObj.comment.length <= 150) ? cObj.comment : cObj.comment.substr(0, 150) + '...';
                        
                        $cmt
                            .append('<div class="user-thumbnail"><img class="userimg flL" data-src="'+ userimg +'" src="/photo/11350517.cms"/></div>')
                            .append($username)
                            .append('<p class="short_comment">'+ cmtStr +'</p>')
                            .append('<div class="footbar clearfix"><span data-action="comment-reply" class="cpointer">Reply</span><span class="up cpointer" data-action="comment-agree" title="Up Vote"><i class="icon-uparrow"></i></span><span class="down cpointer" data-action="comment-disagree" title="Down Vote"><i class="icon-downarrow"></i></span><span class="cpointer flag_comment"> <span data-action="comment-offensive" title="Mark as offensive"></span></span></div>');
                        $btmComments.append($cmt);
                    }
                    $article.find('.comments[data-commentmsid="'+ msid +'"]').after($btmComments);
                }
            })();
            
            // Hack to auto-load comments *****************
            // TODO: move to toi_js
            require(['tiljs/ui'], function(ui){
                var $commentsWrapper = $(".articlepage[data-articlemsid='" + msid + "'] .comments .article");
                $commentsWrapper.on('scroll', function(){
                    var $loadmore = $commentsWrapper.find(".loadmore");
                    $loadmore.each(function(){
                        if (ui.inView($(this))){
                            $(this).trigger('click');
                        }
                    });
                });
            });
        }
        else {
            $(".articlepage[data-articlemsid='" + msid + "'] .last4brdiv").on("click", ".msg", function() {
                var scrollToPos = $(".comments[data-commentmsid='" + msid + "'] #comments_agree").offset().top;
                $('html, body').animate({
                    scrollTop: scrollToPos
                }, 1500);
                return false;
            });
            
            $(".articlepage[data-articlemsid='" + msid + "'] .last4brdiv").on("click", ".btn", function() {
                var scrollToPos = ($(this).data('type') == "addcomment") ? $(".comments[data-commentmsid='" + msid + "']").offset().top : $(".comments[data-commentmsid='" + msid + "'] #comments_agree").offset().top;
                $('html, body').animate({
                    scrollTop: scrollToPos
                }, 1500);
            });
        }
         
       $(".articlepage[data-articlemsid='" + msid + "'] .last4brdiv").on("click", ".detail_comment_link", function() {
          $(this).parent().hide();
          $(this).parent().next().show();
          galogger.analyticsFire('TopComment', 'ReadMore', window.location.href);
         return false;
       });
       
   
     if(isShowMoreContentClick && $('.article-content-wrapper').innerHeight() > $('.sidebar').innerHeight() ){
            isShowMoreContentClick =false;
            $('.stickyAd').addClass('sticky_ad');
        }else {
          $('.stickyAd').removeClass('sticky_ad');  
        }
        
     });
     
    if ($('[data-comment-type="slider"]').length) {
        event.subscribe("comments.loaded.none", function(data){
            var msid = data.config.msid;
            var $article = $(".articlepage[data-articlemsid='" + msid + "']");
            
            // $article.find('.rhs-commentbox .cmt-count').text('Be the first one to review');
            // $article.find('.rhs-commentbox .cmtbtn.view').remove();
            $article.find('.toiwidgets_social .comment-slider.show_sprite').css('background-color', '#cacaca');
            $article.find('.cmtbtn-wrapper').addClass('zero-comments').find('.cmtbtn.view').remove();
            $article.find('.comments .dyn-width .text').text('Be the first one to review');
        });
    }
     
      $(window).load(function() {
       var params = util.getParam();
       var hash = window.location.hash;
       var no = hash.substring(1, hash.length);
       if (params.slideshow && params.slide) {
         logger.log("Slideshow Detected: " + params.slideshow + " " + params.slide);
         var sliderobj = {
           sliderid: params.slideshow,
           slideid: params.slide,
           val: no
         };
         var scrolltop = $("[data-msid='" + params.slideshow + "']").offset().top;
         $('html, body').animate({
           scrollTop: scrolltop - 100
         }, 2000);
         if (hash) {
           event.publish("slider.slideto", sliderobj);
         }
       }
     });
     
     // Detect scrolling direction
     var scroll = (function scrollDir() {
       var prevScrollY = 0;

       function dir() {
         var currScrollY = $(window).scrollTop();
         var scroll = currScrollY > prevScrollY ? 'down' : 'up';
         prevScrollY = currScrollY;
         return scroll;
       }
       return {
         dir: dir
       }
     })();
     
     var scrollTimer, lastScrollFireTime = 0,lastScrollTop =0 , scrollDir = 'upwards', firstArticleMsid = msid;

     $(window).on('scroll', function(e) {
        if(!isGoToArticle){
            scrollcheck();
        }
        var st = $(this).scrollTop();
        if (st > lastScrollTop){
            scrollDir = 'downwards';
            $('body').addClass('scroll-down').removeClass('scroll-up');
               // downscroll code
         } else {
              scrollDir = 'upwards';
              $('body').addClass('scroll-up').removeClass('scroll-down');
         }
         lastScrollTop = st;
         
         var pageCandidateFired = $("[data-articlemsid="+ msid +"]").data('pageview_candidate_fired');
         if( scrollDir == 'downwards' && firstArticleMsid != msid && pageCandidateFired != 'yes' && pageCandidateFired != 'inprogress'){
              firePageViewCandidate(msid);
         }
     });
     // Trigger Read Activity
     var activitiesTriggeredFor = [];
     event.subscribe("tpinitated",function(){
       triggerReadActivity(window.msid);  
     })

         function triggerReadActivity(msid){
         
         if(!(activitiesTriggeredFor.indexOf(msid)>-1)){
             activitiesTriggeredFor.push(msid)
             $(document).trigger('article_read', [{'msid' :msid}]);
         }
          
     }   
     function reinitialiseLeftTPWidget(msid){
         if (typeof TPWidget != 'undefined' && typeof TPWidget.init == 'function') {
            TPWidget.init({

                widgets: [{

                'ele': 'tpwidget-'+msid,

                'widgetType': 'tpwidget-two'

                    }]

                });
         }
     }
     function getNextArticleId(curmsid){
         try{
            var msid = $('#articlelist').find('[data-msid="'+curmsid+'"]').next().data('msid');
            if(typeof msid != "undefined")
                return msid;
            return false;
         }catch(e){
             return false;
         }
     }   
     
     function loadNextArticle(curarticle){
         
           if (curarticle) {
             var nextmsid = getNextArticleId(curarticle);
             if(nextmsid){
                // articleLinkWidget.activeLink(nextmsid);
                 loadArticle(curarticle, nextmsid);
             }
           }
     }
     
     function getArticleAuthorName(msid){
        return $("[data-articlemsid="+msid+"] .auth_detail").length ? $("[data-articlemsid="+window.msid+"] .auth_detail").text() : "";
     }
     
     function timesactivitylog(msid){
        try{
            window['__activity'] = ["read"];
            if(typeof window._tp_async_data != "undefined"){
                _tp_async_data['URL'] = escape(getArticleUrl(msid));
            }
            // timespointsapp.prelogin.init();
        }catch(e){}
     }
     
     
     var gaDontMiss = (function() {

          // Create a store to hold the private objects.
          var privateStoreMsid = [];
          
         function checkArticle(articleId){
                 
                  if(privateStoreMsid.indexOf(articleId) == -1){
                      
                      privateStoreMsid.push(articleId);
                      fireGaEvent(articleId);
                  }
                
               }
        
        function fireGaEvent(articleId){
           
            //galogger.analyticsFire('Dont Miss Visible',  getArticleSection(articleId), window.location.href);
            ga('send', 'event', 'Dont Miss Visible', getArticleSection(articleId), window.location.href, {'nonInteraction': 1});
            
            if (typeof(fireComscore) == "function") {
                     fireComscore();
                   }
            }
               
         return checkArticle ;
         
        }());
        
    var scrollGATriggeredURLs = [];
     
     function scrollcheck() {
        
        var scrollingDir = scroll.dir(); 
        var articlelist = $('#articlelist');
        
        
        if(ui.inView(articlelist) && $('#gaanaplayer').length && $('#gaanaplayer').is(':visible')){
                
                        $('#gaanaplayer').css('bottom',$('#articlelist').outerHeight())
                        
                    }
        if(!ui.inView(articlelist) && $('#gaanaplayer').length && $('#gaanaplayer').is(':visible')){
                
                        $('#gaanaplayer').css('bottom','0px')
                        
                    }
        if(!ui.inView(articlelist) && $(window).scrollTop() > 160){
            
            articlelist.stop(0,0,0).animate({'bottom':0},500,function(){
                
                if(!is.IE()){
                    
                    loadNextArticle(window.msid);
                }
            });
        }
        
       /* Fixed navigation if user scrolls up*/
       if ((scrollingDir == "up") && !ui.inView($('#header'), true)) {
         $('#navigation').addClass('sticky');
         $('#dont_miss_articles').css("opacity", "1");
         if($('#dont_miss_articles').is(":visible")){
            
            //  gaDontMiss(msid);
         }
       } else {
         $('#navigation').removeClass('sticky');
         $('#dont_miss_articles').css("opacity", "0");
             var articlesec = getArticleSection(msid);
             if(typeof articlesec == 'string' && (articlesec.toLowerCase() == 'sports' || articlesec.toLowerCase() == 'business' )){
                 if(ui.inView($(".navbdcrumb"), true)){
                     $('#navigation').removeClass("sticky");
                     $('.user_area').removeClass("showupfront");
                 }else{
                     $('#navigation').addClass('sticky');
                     $('.user_area').addClass("showupfront");
                 }
             }
       }
        
        stickyAd();
       
         var slideBarHeight =$('.sidebar').innerHeight();
         var mainContentHeight =$('.article-content-wrapper').innerHeight();
        
       var article = {};
       article.as = $("[data-articlemsid]");
       article.msid = window.msid;
       // window.currentmsid=window.msid;
       article.as.each(function(k, val) {
         var v = $(val);
         var ls = v.find(".leftsocial");
         var adw = v.find(".stickyAd");
         var adwPrev = (adw.prev().css('display') != 'none') ? adw.prev() : adw.prev().prev();
         var articleEndTopPos = v.find("[data-articlepage-end]").offset().top;
         if (adw.length) {
           var adwHeight = adw.outerHeight();
           var adwTopPos = adw.offset().top;
         }
         if (ui.inView(v, true)) {
           var newmsid = v.data("articlemsid");
           articleLinkWidget.activeLink(newmsid);
            if(is.IE() && (ui.inView(v.find('[data-articlepage-end]'), true))){
                loadNextArticle(newmsid);
            }
           article.title = v.find("[data-articletitle]").text() + " - Times of India";
           article.keywords = v.find("[data-keywords]").attr('data-keywords');
           article.seo = v.data("articleseo");
           article.link = "/";
           if (window.msid != newmsid) {
              triggerReadActivity(newmsid);
             window.msid = newmsid;
             
             if(typeof window.msid == "undefined" || !window.msid.length){
                window.msid = articleLinkWidget.getFirstArticleMSID(); 
             }
             if (article.seo && article.seo.length > 0) {
               article.link += article.seo + "/";
             }
             article.link += "articleshow/" + window.msid + ".cms";
           }
            
           /* Left Social Icons Sticky*/
           if (ui.inView(v.find("[data-articlepage-end]"), true)) {
             ls.addClass("maxbottom");
             ls.removeClass("sticky");
             $('.user_area').removeClass("showupfront");
           } else if (ui.inView(v.find("[data-articlepage-start]"), true)) {
             ls.removeClass("maxbottom");
             ls.removeClass("sticky");
             $('.user_area').removeClass("showupfront");
           } else {
             ls.removeClass("maxbottom");
             ls.addClass("sticky");
             var articlesec = getArticleSection(msid) || "";
             if(articlesec.toLowerCase() == 'sports' || articlesec.toLowerCase() == 'business' ){
              if(ui.inView(v.find(".time_cptn"), true)){
                     ls.removeClass("maxbottom");
                     ls.removeClass("sticky"); 
                     $('.user_area').removeClass("showupfront");
                 }
             }
           }
            
           /* BTF Ad Stikcy*/
           if (adw.length) {
             // maxbottom class height is given as 160px in CSS    
             if ((articleEndTopPos - adwTopPos) > (adwHeight + 160)) {
               if (ui.inView(adwPrev, true)) {
                 adw.removeClass("maxbottom_ad");
                 adw.removeClass("sticky_adwidget");
               } else if (ui.inView(v.find("[data-articlepage-end]"), true)) {
               //  adw.addClass("maxbottom_ad");
                 adw.removeClass("sticky_adwidget");
               } else {
                 if (ui.inView(v.find(".stickyAd"), true)) {
                   adw.removeClass("maxbottom_ad");
                   adw.addClass("sticky_adwidget");
                 }
               }
             }
           }
           //  return false;
        } else {
           ls.addClass("maxbottom");
           ls.removeClass("sticky");
           adw.removeClass("sticky_adwidget");
        }
        if((ui.inView(adw, true)) && !(ui.inView(adw.prev(), true))&& mainContentHeight >slideBarHeight && !(ui.inView(v.find("[data-articlepage-end]"), true)) ){
            $('.stickyAd').addClass('sticky_ad');
        }else {
          $('.stickyAd').removeClass('sticky_ad');  
        }
        
       });
       
       if (article.msid != window.msid) {
           
           if(typeof Storage !== "undefined" && sessionStorage.getItem('comment:loaded:'+window.msid)){
                sessionStorage.setItem('comment:loaded:'+window.msid, 0);
                var articleinview = $("[data-articlemsid="+window.msid+"]");
                var sortoption = articleinview.find('#comment_sort').val(),
                   commentsection = sortoption.length ? "#comments_"+sortoption : "#comments";
                articleinview.find(commentsection).show();
            }
            for(idx=1;idx<=2;idx++){
                if(typeof Storage !== "undefined" && sessionStorage.getItem("Ad:"+article.msid+":"+idx)){
                    sessionStorage.setItem("Ad:"+article.msid+":"+idx, 0);
                    $("[data-articlemsid="+window.msid+"]").find('[data-adslot-no='+idx+']').parent().css('height','auto');
                }
            }



                 articleLinkWidget.activeLink(window.msid);
        
                 try {
                   //Place this line at last as it does not work in IE8
                   document.getElementsByTagName('title')[0].innerHTML = article.title;
                 } catch (e) {
                   logger.log("Cannot update Title Tag on Scroll");
                   //console.log(e);
                 }
                 try {
                   window.history.replaceState({}, article.title, article.link);
                    processarticle(window.msid);
                    
                    //Do not show ads in Brandwire
                    if(!isBrandwireArticle(msid)){
                        loadSponsorAds(window.msid);
                    }
                    
                   if (typeof(ga) == "function") {
                     ga('send', {
                       'hitType': 'pageview',
                       'page': article.link,
                       'title': article.title,
                       'location': getArticleUrl(window.msid)
                     });
                   }
        		   if(typeof toiprops != "undefined"){
        		       toiprops._Hyp1_pg=article.title;
        		       toiprops._MetaKey_pg=article.keywords;
        		   }
                   // Comscore Call
                   firePageViewCandidate(window.msid);
                    
                    //PWT Call
                    if (typeof(PWT.jsLoaded) == "function") {
                       PWT.jsLoaded();
                    }
                    
                    if (typeof(buildAdsAj) == "function") {
                       buildAdsAj(window.msid);
                    }
                    
                    // Timespoints Activity
                    timesactivitylog(window.msid);
                    
                    //Timestrend log
                    if (typeof(timeslog) == "function") {
                        timeslog(window.msid);
                    }
                    
                    // ChartBeat Call
                    if (typeof(pSUPERFLY) !="undefined" && typeof(pSUPERFLY.virtualPage) == "function") {
                       _sf_async_config.authors = getArticleAuthorName(window.msid);
                        pSUPERFLY.virtualPage(article.link, article.title);
                    }
                    
                    // Load mitr js
                    if($('script[src="/mitr.cms"]').length){
                        $('script[src="/mitr.cms"]').remove();    
                        load.js('/mitr.cms');
                    }
                    
                    //GA Event only to be fire once per article load on scroll - TOIPR-39177
                    if(scrollGATriggeredURLs.indexOf(article.msid) === -1){
                        var articleIndex = 1 + $('[data-article-container]').index($('[data-article-container="'+article.msid+'"]'));
                        ga('send', 'event', 'AS1_PerpetualScrollView', 'AS1_ArticleScroll', ('AS' + articleIndex + '_' + window.location.href));
                        scrollGATriggeredURLs.push(article.msid);
                    }
                 } catch (e) {
                   logger.log("Cannot replace state of URL");
                 }
                 
                // Pause all playing videos when article changes (except ads)
                (function(){
                    var TimesApps = window.TimesApps || {};
                    if( !(
                            TimesApps.VideoGalleryApp 
                            && TimesApps.VideoGalleryApp.getVideoList
                        ) 
                    ){
                        return;
                    }
                    var videoList = TimesApps.VideoGalleryApp.getVideoList();
                    if( !(videoList && typeof videoList == "object" ) ){
                        return;
                    }
                    for( var i in videoList ){
                        var videoObj = videoList[i];
                        if( typeof videoObj.pauseVideoCallBack == "function" ){
                            var videoDockData = TimesApps.dockVideo.isVideoDocked();
                            if( videoDockData.status &&  videoObj.msid == videoDockData.id ){
                                //video is docked
                                //don't pause on article change
                                return;
                            }
                            videoObj.pauseVideoCallBack();
                        }
                    }
                    
                })();
                 
                 
                // iBeat Call
                 (function() {
                   var articleid = window.msid;
                    setTimeout(function() {
                     if (articleid == window.msid) {
                       if (typeof setPageConfig == "function") {
                         setPageConfig(_ibeat_config[window.msid]);
                       }
                       if (typeof iBeatPgTrend != "undefined") {
                         iBeatPgTrend.init();
                       }
                     }
                   }, 1000);
                 })();
            }
     }
     
   //  galogger.analyticsFire('PerpetualScroll', 'BaseView', window.location.href);
        var articleLinkWidget = new articleLink();
        articleLinkWidget.init();
     if(typeof msid !="undefined"){
        processarticle(msid, true);
     }
     
     if(is.IE()){
        $('#ajaxcontent').find('[data-article-container]:gt(3)').remove();
     }
     
     /* GA events for comment action */
      event.subscribe("comment.sort",function(data){
           galogger.analyticsFire('Comment', 'Sort', data+" - "+window.location.href);
      });
      event.subscribe("comment.opinion",function(data){
           galogger.analyticsFire('Comment', data, window.location.href);
      });
      event.subscribe("comment.readmore",function(data){
           galogger.analyticsFire('Comment', "ReadMore", window.location.href);
      });
      event.subscribe("comment.togglereplies",function(data){
          galogger.analyticsFire('Comment', "ShowReplies", data +" - "+ window.location.href);
      });
      event.subscribe("comment.post.end",function(data){
          galogger.analyticsFire('Comment', 'Article', window.location.href);
      });
     /**/
     
    //GA Event
    galogger.analyticsFire('ArticleLoad', 'First Article', window.location.href);
    
   });
   
   if(window.localStorage && window.localStorage.getItem('article-fsize') !=null){
        $('.articleshow').attr('data-font',window.localStorage.getItem('article-fsize'));
        sessionStorage.clear();
   }
   
   function getArticleUrl(msid){
        return window.location.protocol + "//" + window.location.hostname + $('#articlelist [data-msid="'+msid+'"] a').attr('href');
    }
    
    function getArticleShortUrl(msid){
        var shortUrl = $(".articlepage[data-articlemsid='" + msid + "']").data('shorturl');
        return shortUrl || null;
    }
    
    function getArticleSection(){
        var articleSection = $(".articlepage[data-articlemsid='" + msid + "']").data('articlesec');
        return articleSection || null;
    }
    
    function getImageUrl(msid){
        var imgid = $(".articlepage[data-articlemsid='" + msid + "']").find('[data-imgid]').data('imgid');
        imgid = imgid ? imgid : "47529300";
        return "https://timesofindia.indiatimes.com/photo/"+imgid+".cms";
    }
   
   function adsVisibility(msid, adslot){
           var loadedAdArticle =  $("[data-articlemsid="+msid+"]");
           require(["ui","tiljs/is"],function(ui,is){
           if(typeof Storage !== "undefined" && window.location.href.indexOf(msid)==-1 && !is.IE() && !is.tablet()){
             sessionStorage.setItem("Ad:"+msid+":"+adslot, 1);
           }else{
            loadedAdArticle.find('[data-adslot-no='+adslot+']').parent().css('height','auto');
           }
          });
    }
   
   function hideAds(status,$containerElem) {
     if ($containerElem){
        var admsid = $containerElem.data('index');
        if (status) {
            // Change pg attr for ads links
            $containerElem.prev().show();
             var adslot = $containerElem.data('adslot-no');
             $('.articlepage[data-articlemsid=' + admsid + '] .ctn_ads_rhs [pg]').each(function(k,val){
                 try{
                     var url = getArticleUrl(admsid);
                     var pgLbl = $(val).attr('pg').split('#');
                     if(-1 == pgLbl[0].indexOf('AS1')){
                        var newpg= "AS1_"+pgLbl[0]+"#AS1_"+pgLbl[1]+"#AS1_"+pgLbl[2]+ "-" +  url;
                        $(val).attr('pg', newpg);
                     }
                 }catch(e){}
             });
            if(typeof adslot !='undefined')
                adsVisibility(admsid, adslot);
        }else{
            /*To hide ctn native ads parent element of slot type when ad data is null*/
            var parentCntr = $containerElem.parents('.ctn_ads_rhs');
            if(parentCntr.find('[data-cb="processCtnAds"]:hidden').length>1){
                parentCntr.hide();
            }
        }
     }
   }
   
   /*TODO: Deprecated in colombia_v2 impl*/
   function hideCompositeAds($containerElem){
       var admsid = $containerElem.data('index'),
           adsContainer = $containerElem.data('container');
           
        if($containerElem && $containerElem.length != 0){
            $containerElem.attr('data-hidden','true');
            var $parentContainerElem = $('.articlepage[data-articlemsid=' + admsid + ']').find('.' + adsContainer);
            if($parentContainerElem.find('[data-hidden]').length===$parentContainerElem.find('[data-ad-id]').length){
                $parentContainerElem.hide();
            } 
        }
   }
   
   function setAutoplayAds(status,$containerElem){
       if($containerElem && $containerElem.length != 0 && !$containerElem.data('autoplay') && status===true){
            if(typeof _geo != 'undefined' && _geo != 1 && !$('.ctn-vid-ad[data-played]').length){
                $containerElem.attr('data-autoplay','true').attr('data-audio','false').click();
            }
        } else if(status===false){
            hideAds(status,$containerElem);
        }
   }

   function sponsorAdSuccess(status,$containerElem) {
     if (status && $containerElem) {
       // Change pg attr for ads links
       $containerElem.parent().addClass('loaded');
     }
    }
    
    $(document).on('click', '[data-plugin="amazon-link"], [data-plugin="paytm-link"], [data-plugin="tatacliq-link"]', function(e){
        e.preventDefault();
        var obj, uri, affiliate_pagename, redirectUrl;
        
        var _pluginNode = this.getAttribute('data-plugin');
		var url = $(this).data('url');
		
		obj = {
                price : ($(this).data('price')) ? $(this).data('price') : '',
                title : ($(this).data('title')) ? $(this).data('title') : '',
	        }
	    
	    if(_pluginNode == 'amazon-link'){
            obj.amz_ga = ($(this).data('amz_ga')) ? $(this).data('amz_ga') : '',
            affiliate_pagename = '/affiliate_amazon.cms';
        }
	    else if(_pluginNode == 'paytm-link'){
		    obj.tag = ($(this).data('tag')) ? $(this).data('tag') : '',
		            
	        obj.utm_source = ($(this).data('utm_source')) ? $(this).data('utm_source') : 'toiweb',
            obj.utm_medium = ($(this).data('utm_medium')) ? $(this).data('utm_medium') : 'affiliate',
            obj.utm_campaign = ($(this).data('utm_campaign')) ? $(this).data('utm_campaign') : 'toiweb_articles',
                    
            obj.paytm_ga = ($(this).data('paytm_ga')) ? $(this).data('paytm_ga') : '',
            affiliate_pagename = '/affiliate_paytm.cms';
        }
        else if(_pluginNode == 'tatacliq-link'){
		    obj.tag = ($(this).data('tag')) ? $(this).data('tag') : '',
		            
	        obj.utm_source = ($(this).data('utm_source')) ? $(this).data('utm_source') : 'toiweb',
            obj.utm_medium = ($(this).data('utm_medium')) ? $(this).data('utm_medium') : 'affiliate',
            obj.utm_campaign = ($(this).data('utm_campaign')) ? $(this).data('utm_campaign') : 'toiweb_articles',
                    
            obj.ttclq_ga = ($(this).data('ttclq_ga')) ? $(this).data('ttclq_ga') : '',
            affiliate_pagename = '/affiliate_tatacliq.cms';
        }
        else{
		    return false;
	    }
	    
        var parser = document.createElement('a');
        parser.href = url;
        
        uri = Object.keys(obj).map(function(key){ 
            return encodeURIComponent(key) + '=' + encodeURIComponent(obj[key]); 
        }).join('&');

	    redirectUrl = parser.href;
	    
	    window.open("https://www.gadgetsnow.com" + affiliate_pagename + "?url=" + encodeURIComponent(redirectUrl) + '&' + uri);
    });
   
   var isGoToArticle = false ,
       isShowMoreContentClick =false; 
   
   /*News In Context*/
    (function NIC(){
      var $nic_container = $('.nic_container'),
          nic_url = '/nic.cms?v=7',
          $nic_handler = $('.nic_handler');
      
    require(["nicvideo"], function(nicvideo) {
        nicvideo(msid);
    });
               
      var sb_obj = null,nic_obj=null,ar_obj=null,sb_ad=null;
      
      //Set nic container width
      var rs = $(window).width() - $('.sidebar').offset().left - 20,
          rsp = rs+"px",
          rmp = (-1)*rs + "px";
      
      $nic_container.css({'width':rsp,'right':rmp});
      
      $('#container').on('click','.nic_handler', function(){
            var $tthis = $(this); 
            
            
            
            if($tthis.hasClass('nicactive')){
                closeNICFrame();
            }else{
                
                nic_obj = $tthis;
                sb_obj = $tthis.parents('.main-content').siblings('.sidebar');
                ar_obj = $tthis.parents('.article_content');
            
                sb_ad = ($(sb_obj).find('.ad:first div[data-size *= 250] iframe').length > 0) ? $(sb_obj).find('.ad:first div[data-size *= 250]').outerHeight() : 0;
                $(sb_obj).children().addClass('sb_hide').css({'visibility':'hidden'});
                $(sb_obj).find('.ad:first').removeClass('sb_hide').css({'visibility':'visible'});
                
                $nic_container.css({width: ($(window).width() - $(sb_obj).offset().left),
                top:($(sb_obj).offset().top - $(window).scrollTop() > 0) ? ($(sb_obj).offset().top - $(window).scrollTop()) : 0});
                
                $('.nicactive').removeClass('nicactive');
                $tthis.addClass('nicactive');
                 
                
                var url = nic_url+"&msid="+$tthis.data('nic_msid')+"&mstype="+$tthis.data('nic_mstype')+"&mssubtype="+$tthis.data('nic_mssubtype')+"&hostid="+$tthis.data('nic_host');
                var pgData = manipulatePGData($tthis, true)
                openNICFrame(url, $tthis.data('nic_msid'), pgData);
                
            }
            
      });
      
      function manipulatePGData ($tthis, isOpen) {
          if(typeof $tthis !== 'object' || $tthis.length === 0) {
              return;
          }
          var pgData =  $tthis.attr('pg');
          if(pgData && pgData.indexOf('~') !== -1){
              var pgDataArr = pgData.split('~');
              if(isOpen) {
                  pgDataArr[1] = pgDataArr[1].replace('OPEN', 'CLOSE');   
              } else {
                  pgDataArr[1] = pgDataArr[1].replace('CLOSE', 'OPEN');
              }
              pgData = pgDataArr.join('~');
              setTimeout(function(){
                  $tthis.attr('pg', pgData);
              }, 0)
          }
          return pgData;
      }
      
       $('#container').on('click','.close_nic', function(){
           closeNICFrame();
       });
       
        $(document).on('click','.loadmore', function(){
           isShowMoreContentClick =true;
       });
      
      function closeNICFrame(){
          var $nicactive = $('.nicactive');
          manipulatePGData($nicactive)
          $nic_container.animate({right:rmp},'',function(){
            $nic_container.html('<img src="/photo/42715392.cms" class="newsc_loader"/>').hide();
          });
          if(sb_obj){
            $(sb_obj).find('.sb_hide').removeClass('sb_hide').css({'visibility':'visible'});
          }
          $nicactive.removeClass('nicactive');
          sb_obj =null;  ar_obj =null; sb_ad =null;
      }
      
    times = window.times || {};
    times.articleshow = window.times.articleshow || {};
    times.articleshow.closeNICFrame = closeNICFrame;
      
      function triggerAnalyticsLog(){
            if(typeof $(nic_obj).data('nic_msid')!="undefined" && typeof $(nic_obj).data('nic_mstype')!="undefined" && typeof $(nic_obj).data('nic_mssubtype')!="undefined"){
                var nic_title = $nic_container.find('.newsc_text h4').text(),
                    nic_link = "/nic.cms?msid="+$(nic_obj).data('nic_msid')+"&mstype="+$(nic_obj).data('nic_mstype')+"&mssubtype="+$(nic_obj).data('nic_mssubtype'),
                    nic_abs_url = window.location.protocol + "//" + window.location.hostname + nic_link;
                
                //ga page View
                if (typeof(ga) == "function") {
                    ga('send', {
                      'hitType': 'pageview',
                      'page': nic_link,
                      'title': nic_title,
                      'location': nic_abs_url
                    });
                }
                
                // comscore page view
                if (typeof(COMSCORE) !="undefined" && typeof(COMSCORE.beacon) == "function") {
                    COMSCORE.beacon({ c1: "2", c2: "6036484" });
                }
                
            }
        }
      function openNICFrame(url, nic_msid, pgData){
          $nic_container.css('right',rmp).html('<img src="/photo/42715392.cms" class="newsc_loader"/>').hide();
          
            nicContentCall(url, nic_msid, pgData);
          
          $nic_container.show();
          $nic_container.animate({right:0});
      } 
      
      function processSocialEmbeds(){
          if($nic_container.find("blockquote[class*='twitter']").length || $nic_container.find(".twitter-timeline").length){
            if(window.twttr){
                window.twttr.widgets.load();
            }else{
                if(!$('#twitter-wjs').length){
                    require(["tiljs/social/twitter"], function (twitter) {
            			 twitter.init({parse: true});
            		});
                }
            }
          }
      }
      
      function nicContentCall(url, nic_msid, pgData){
          $.get(url,function(data){
             $nic_container.html(data);
             if($('#articlelist').is(":visible")){
                    $nic_container.find('.nic_body').css({height:$(window).height() - $('#articlelist').height() - $nic_container.find('.nic_overlay').outerHeight() - 40}); 
             }else{
                 $nic_container.find('.nic_body').css({height:$(window).height() - $nic_container.find('.nic_overlay').outerHeight() - 40}); 
             }
             processSocialEmbeds();
              triggerAnalyticsLog();
              $nic_container.find('.close_nic').attr('pg', pgData);
          });
      }
      
       $(window).on('scroll', function(){
            if(sb_obj && ar_obj && sb_ad){

                if(($(sb_obj).parents('[data-article-container]').offset().top > 0) && ($(window).scrollTop() + $(window).height() - $('#articlelist').height() < $(sb_obj).parents('[data-article-container]').offset().top)){
                    closeNICFrame();
                }
            	if($(window).scrollTop() <= $(sb_obj).offset().top + sb_ad){
            	    $nic_container.css({top:$(sb_obj).offset().top + sb_ad - $(window).scrollTop()});
            	} else if (($(window).scrollTop() > $(sb_obj).offset().top + sb_ad) && ($(window).scrollTop() <= $(ar_obj).offset().top + $(ar_obj).outerHeight())) {
            	   $nic_container.css({top:0});
                } else {
                    closeNICFrame();
                }
                
            }
        });
        
         $(window).off('resize').on('resize', function(){
           
            if(window.innerHeight > window.innerWidth){ //portrait
                $('#container .nic_handler').removeClass('nic_handler').addClass('nic_off');
                closeNICFrame();
            } else {
                $('#container .nic_off').removeClass('nic_off').addClass('nic_handler');
            }
            
            if($nic_container.is(':visible')){
                $nic_container.css({
                    width:($(window).width() - $(sb_obj).offset().left),
                    top:($(sb_obj).offset().top - $(window).scrollTop() > 0) ? ($(sb_obj).offset().top - $(window).scrollTop()) : 0
                });
             
            if($('#articlelist').is(":visible")){
                    $nic_container.find('.nic_body').css({height:$(window).height() - $('#articlelist').height() - $nic_container.find('.nic_overlay').outerHeight() - 40}); 
             }else{
                 $nic_container.find('.nic_body').css({height:$(window).height() - $nic_container.find('.nic_overlay').outerHeight() - 40}); 
             }
                
            }
        });
        
        
        if($nic_handler && $nic_handler.length > 0) {
            if(window.ga){
    	        ga('send', 'event', 'NIC', 'Article', window.location.href, {'nonInteraction': 1});
    	    }else{
    	        setTimeout(function () {ga('send', 'event', 'NIC', 'Article', window.location.href, {'nonInteraction': 1});},5000);
    	    }
        }
   })();
   
    (function(){ // Slider comments
        if (!$('[data-comment-type="slider"]').length) {
            return false;
        }
        
        require(['tiljs/ui', 'tiljs/event'], function(ui, event){
            times = window.times || {};
            times.articleshow = window.times.articleshow || {};
            times.articleshow.sc = {};
            
            times.articleshow.sc.loadmoreComments = function($article){
                setTimeout(function(){
                    var $loadmore = $article.find(".comments .article .loadmore");
                    $loadmore.each(function(){
                        if (ui.inView($(this))){
                            $(this).trigger('click');
                        }
                    });
                }, 200);
            }
            
            times.articleshow.sc.isTablet = function () {
        		return( function ( a ) {
        			return /(?:ipad|tab)/i.test( a );
        		} )( navigator.userAgent || navigator.vendor || window.opera );
        	};
            
            times.articleshow.sc.showComments = function($article, $sourceBtn, cb,highlightcomment,targetcommentid){
                var commentHolder = $article.find("#comment-holder"),postComment = $article.find("#post-comment");
                $article.find("[data-plugin=comment-input]").val("");
                $article.find('[data-plugin="offensive_popup"]').hide();
                $article.find('[data-plugin="comment-reply"]').hide();
                $article.find(".holder-pos-top").removeClass('holder-pos-top');
                postComment.removeClass('disable');
                try{
                   $article.find(".comments .article").mCustomScrollbar("scrollTo",'top'); 
                }
                catch(e){
                    console.log(e);
                }
                $('[data-commentmsid] .comment-box').removeClass('highlight');
                if(highlightcomment === true){
                    
                    if(targetcommentid =='top'){
                        $('[data-commentmsid] .comment-box').eq(0).addClass('highlight');
                    }
                    else{
                        $('[data-commentmsid] #cmt'+targetcommentid).addClass('highlight');    
                    }
                    
                }
                if ( times.articleshow.sc.isTablet() ) {
                    var scrollToPos = $article.find(".comments[data-commentmsid]").offset().top;
                    $('html, body').animate({
                        scrollTop: scrollToPos
                    }, 1000, function(){
                        if ($sourceBtn.attr('data-showtype') === 'autofocus') { // autofocus if required
                            $article.find('[data-plugin="comment-input"]:eq(0)').focus();
                        }
                    });
                    return false;
                }
                else {
                    var width = $(window).width() - $article.find('.sidebar').offset().left - 20;
                    width = Math.round(Math.min( width, $(window).width()/2)) // take sidebar width upto max of half screen width
                    
                    $article.find('.comments[data-commentmsid] .article').css('width', width);
                    $article.find('.comments[data-commentmsid] .article .dyn-width').css('width',(width+10));
                    commentHolder.css('width', (width+10));
                    $article.find('.comments[data-commentmsid] .article')[0].scrollTop = 0;
                    $('#navigation.sticky').removeClass('sticky'); //hide nav if sticky
                    
                    if ( times.articleshow && typeof times.articleshow.closeNICFrame === 'function' ) {
                        times.articleshow.closeNICFrame();
                    }
                        
                    $article.find('.comments[data-commentmsid]').addClass('slide-in');
                    $('body, html').addClass('disable-scroll');
                    
                    setTimeout(function(){
                        $article.find('.sidebar').hide(); // hide sidebar when comments slide-in
                        if ($sourceBtn.attr('data-showtype') === 'autofocus') { // autofocus if required
                            $article.find('[data-plugin="comment-input"]:eq(0)').focus();
                        }
                        if (typeof cb === 'function' ) {
                            cb();
                        }
                        times.articleshow.sc.loadmoreComments($article);
                    }, 500);
                }
                $article.find(".trigger-post-comment").off('click').on( "click", function(event) {
                           if(!commentHolder.hasClass("holder-pos-top")){
                                 commentHolder.addClass("holder-pos-top");
                                 postComment.addClass("disable");
                                 
                            }else{
                                commentHolder.removeClass("holder-pos-top");
                                postComment.removeClass("disable");
                            }
                                
                });
                
                var _relativeUrl = '/' + $article.data('articleseo') + '/article_comments/' + $article.data('articlemsid') + '.cms';
                var _absoluteUrl = getArticleUrl($article.data('articlemsid')).replace('articleshow', 'article_comments');
                var _title = $article.find('h1[data-articletitle]').text();
                
                ga('send', {
                   'hitType': 'pageview',
                   'page': _relativeUrl,
                   'title': _title,
                   'location': _absoluteUrl
                });
                
                if (typeof COMSCORE != "undefined" && typeof COMSCORE.beacon == "function") {
                    COMSCORE.beacon({ c1: "2", c2: "6036484" });
                }
            };
            
            event.subscribe("comment.post.posted",function(){
                var $article = $('.comments[data-commentmsid].slide-in').closest('.articlepage');
                var commentHolder = $article.find("#comment-holder"),postComment = $article.find("#post-comment");
                if(commentHolder.hasClass("holder-pos-top")){
                                 commentHolder.removeClass("holder-pos-top");
                                 postComment.removeClass("disable");
                            }
            });
            event.subscribe("comment.post.error",function(){
                 $('.comment-processing').removeClass('comment-processing');
            });
            event.subscribe("comment_error",function(data){
               if(data){
                  $('.comment-processing').removeClass('comment-processing'); 
               }
            });
            event.subscribe("comment.post.posting",function(){
               $('.comment-processing').removeClass('comment-processing');
               
            });
            event.subscribe("comment.post.validation.failed",function(){
               $('.comment-processing').removeClass('comment-processing');
            });
            event.subscribe("comment.post.posted",function(){
               setTimeout(function(){
                 $('.comment-box.level0.highlight').eq(0).addClass('fadein');  
               },500);
               
            });
            
            
            event.subscribe("comment.flag.show",function(elem){
                var elemTop = elem.closest('.comment-box').position().top + elem.closest('.comment-box').height(),
                    elemH = elem.height(),
                    wH = $(window).height(),
                    commentScrollPos = elem.closest('.article').find('.mCSB_dragger').position().top;
                $('[data-plugin="offensive_popup"]').hide();
                $('.popup_above').removeClass('popup_above');
                
                if(((elemTop-commentScrollPos)+elemH) > wH){
                   $(elem).addClass('popup_above');
                }
            });
            
            $('[data-plugin=comment-post]').off("click").on("click",function(){
                $(this).closest("#comment-holder").addClass('comment-processing');
            });
            
            
            times.articleshow.sc.hideComments = function($comments){
                $('[data-commentmsid] .comment-box').removeClass('highlight');
                $comments.closest('.articlepage').find('.sidebar').show();
                $comments.removeClass('slide-in');
                $('body,html').removeClass('disable-scroll');
            };
            
            times.articleshow.sc.bindEvents = function(){
                
                $(document).on('click', '.bottom-comments', function(e){
                    if(!($(e.target).is('a.name'))){
                        var $article = $(this).closest('.articlepage');
                    var target = $(e.target).closest('[data-action]');
                    
                    if ( target.length ) {
                        var action = $(target).attr('data-action');
                        var commentId = $(target).closest('.comment-box.level1').attr('data-id');
                    }
                    
                    times.articleshow.sc.showComments($article, $(this), function(){
                        if (target.length) {
                            var $target = $article.find('[data-comment-type="slider"] .comment-box.level1[data-id="'+ commentId +'"] [data-action="'+ action +'"]');
                            $target.trigger('click');
                        }
                    },true,$(e.target).closest('.comment-box').attr('data-id'));    
                    }
                    
                });
                
                $(document).on("click", "[data-plugin='show-comments']", function() {
                    var $article = $(this).closest('.articlepage');
                    if(!$article.find(".comments .article").hasClass('mCustomScrollbar')){
                        $article.find(".comments .article").mCustomScrollbar({
                               theme: "dark",
                               scrollButtons: {
                                 enable: false
                               },
                               mouseWheel: {
                                 enable: true,
                                 scrollAmount: 52
                               },
                               advanced: {
                                 updateOnContentResize: true,
                                 autoScrollOnFocus: false
                               },
                               callbacks:{
                                    onScroll:function(){
                                      if(ui.inView($article.find('[data-plugin="comment-input"]:eq(0)'))){
                                          $article.find("#post-comment").hide();
                                      }else{
                                          $article.find("#post-comment").show();
                                      }
                                    }
                               }
                     });
                    }
                    
                    if($(this).closest(".topcomment").length){
                        times.articleshow.sc.showComments($article, $(this),undefined,true,'top');    
                    }
                    else{
                        times.articleshow.sc.showComments($article, $(this));    
                    }
                });
                
                $(document).on('click', '.comments[data-commentmsid]', function(e){
                    if($(e.target).find('.article .comment-section').length){
                        var $comments = $(this);
                        times.articleshow.sc.hideComments($comments);
                    }
                    else if ( $(e.target).hasClass('close_comments') ) {
                        var $comments = $(this).closest('.comments[data-commentmsid]');
                        times.articleshow.sc.hideComments($comments);
                    }
                });
                $(document).on('keyup',function(event) {
                    if (event.keyCode == 27 && $('.comments[data-commentmsid].slide-in').length ) {
                        var $comments = $('.comments[data-commentmsid].slide-in');
                        times.articleshow.sc.hideComments($comments);
                    }
                });
                event.subscribe("comments.loaded", function(data) {
                    // trigger loadmore if btn in view
                    if ( $('.comments[data-commentmsid].slide-in').length ) {
                        var $article = $('.comments[data-commentmsid].slide-in').closest('.articlepage');
                        times.articleshow.sc.loadmoreComments($article);    
                    }
                });
            };
            
            times.articleshow.sc.bindEvents();
        });
    })();
    
    
        if($('#youmightalsolike').length){
            $(window).load(function(){
                require(["localstoragec","tiljs/load"],function(localstorage,load){
                    // $('#container').addClass('enable-dntmiss');
                
                
                
                 window.toi_personalisation = window.toi_personalisation || {};
                 
                    
               
                
    				toi_personalisation.createStoriesUI = function (data){
    				    var $div;
    				    $div = $('<div/>').addClass('articles clearfix');
    				    $div.append(data);
    			              
                        if(toi_personalisation.config.currentSec == 'india'){
                            $("[data-plugin='youmightalsolike']").append($div);
                            var $clone = $("[data-plugin='youmightalsolike']").eq(0);
                            $("[data-plugin='youmightalsolike']").remove();
                            $clone.insertAfter( ".last6brdiv" );
                            $("[data-plugin='youmightalsolike']").show();
                        } 
                        else{
                            $(toi_personalisation.config.$parentselector).append($div);
                            $(toi_personalisation.config.$parentselector).show();    
                        }
                        $('#youmightalsolike li').addClass('clearfix');
    				};

    			         
                   toi_personalisation.pickStories = function (preferredSection ){
                       var sectionNames = 'Entertainment,Sports';
		               toi_personalisation.pesonalisedStoriesData = [];
		               if(preferredSection && preferredSection.length > 0) {
		                   sectionNames = preferredSection.length > 1? (preferredSection[0] + ',' + preferredSection[1]): (preferredSection[0] + ',Entertainment');
		               }
		                var url = '/personalisation_ymal1.cms?section=' + sectionNames;
		                
		                $.ajax({
		                    url: url
		                }).done(function(data){
		                    toi_personalisation.createStoriesUI(data);
		                });
                   };
    			   
    			   toi_personalisation.getPefferedStories = function(sectionList){
    			       toi_personalisation.pickStories(sectionList);
    			   };  
    		   
                    toi_personalisation.getData = function ( data, key ) {
                		var cookiename = ''; var datareco = '';
                		cookiename = (data.ssoId)?data.domain + '.recoV2.' + data.ssoId : 'toi.recoV2.notloggedin';
                		var s = data.recos[0].news.reco;
                		
                		if( s==undefined ) {
                		    var Label = (key)?'LoggedIn':'NonLoggedIn';
                		    var LabelText = ((l.match(/home/)))?'HPv2_NotFound - ':'HPv1_NotFound - ';
                		    //mod_personalisation.analyticsFire(LabelText+Label);
                		    return true;
                		}
                		var a = s.replace(/@\d+/g,"").replace(/(&|\s)/g,'').replace(/#/g,'##').replace(/(\w+\/\w+)(,|#)/g,"").replace(/,#/g,'#').replace(/##/g,'#');
                		if(a.match(/#/g)==null){a+="#";}
                		localstorage.set( cookiename, a, 1 );
                		if(cookiename == "toi.recoV2.notloggedin"){
                		    toi_personalisation.getPefferedStories();
                		}else{
                		    // var userPrefernces = preferences.split("#")[0].split(",");
                		    var userPrefernces = preferences.split("#")[0];
                		    userPrefernces = userPrefernces && userPrefernces.length > 0? userPrefernces.split(","): [];
            			    toi_personalisation.getPefferedStories(userPrefernces);
                		}
                		return datareco;
                	};
            	
            	   toi_personalisation.config ={
            	       storiesSec : ['Business','Entertainment', 'Health', 'India', 'NRI', 'Sports','Tech','lifestyle','World'],
            	       apiUrl : 'https://userreco.indiatimes.com/userreco/v2/reco?domain=toi&mediaType=news,photo,video&callback=toi_personalisation.getData',
            	       currentSec : 'world',
            	       $parentselector :'#dont_miss_articles',
            	       pgAttr :'Dont Miss Story'
            	   };
            	   
                    
            	
                
                    toi_personalisation.init = function(){
                        
                        toi_personalisation.config.currentSec = getArticleSection(msid).toLowerCase();
                        if(toi_personalisation.config.currentSec == 'india'){
                            toi_personalisation.config.storiesSec = ['India'];
                            
                            toi_personalisation.config.pgAttr = 'Personalized';
                        }
                        
                        
                         
                         
                         var username = localstorage.csget( 'MSCSAuthDetails' ),notLoggedinUser = localstorage.csget( 'toi.recoV2.notloggedin' ); 
                         
                         if( username) {
                    			     username = username.split( '=' );
                    			     var key = 'toi.recoV2.'+ username[ 1 ];
                    			     var preferences = localstorage.csget(key);
            			          if(preferences){
                    			         // var userPrefernces = preferences.split("#")[0].split(",");
                    			         var userPrefernces = preferences.split("#")[0];
                		                 userPrefernces = userPrefernces && userPrefernces.length > 0? userPrefernces.split(","): [];
                    			         toi_personalisation.getPefferedStories(userPrefernces);
                    			     }else{
                    			         // user exists but no prefernces found
                    			         
                    			         load.js(toi_personalisation.config.apiUrl, function () {
                                    			//console.log('script Loaded');
                                    		} );
                    			     }
            			    }else if(typeof notLoggedinUser != 'undefined'){
                                //user not logged in but local storage is set
                                //creating random stories
                                toi_personalisation.getPefferedStories();
                           }
                           else{
                               // user coming first time setting prefernces
                               load.js(toi_personalisation.config.apiUrl, function () {
                            			//console.log('script Loaded');
                            		} );
                           }
                    }; 
                
                    toi_personalisation.init();
                
              });
            });
        }
    
    
    function stickyAd() {
        var addDiv = $('#addContainer');
        var pos = $(".main-content").offset().top;
        var windowpos = $(window).scrollTop();
        if (windowpos >= pos) {
            addDiv.addClass('sticky_rightad');
        } else {
            addDiv.removeClass('sticky_rightad');
        }
    }
    
    
     if($('.toptrending_articles').length){
            
            $('body').on('click','ul.lastestlisting li',function() {
                    var curul = $(this).parent('ul').attr("mpop");
                    $('ul.lastestlisting[mpop=' + curul + '] li').removeClass('current');
                    $(this).addClass('current');
                    var tabtype = $(this).attr('id');
                    $('.' + curul).hide();
                    $('div[mpop = ' + tabtype + ']').show();
                });
            
        }
    
    // More Less plugin
    (function ($) {
    $.fn.morelessBtn = function(options) {
        return this.each(function() {
            if(typeof(this._init) === "boolean" && this._init===true) {
                return this;
            }
            this._init=true;
            var settings = $.extend({},{
                showChar:100,
                ellipsestext:'...',
                moretext:'See more',
                lesstext:'See less'
            }, options);
            
            var o=this;
            o.content=$(this).html();
    
            var content = $(this).html();
            console.log(content)
            if(content.length > settings.showChar) { 
                var c = content.substr(0, settings.showChar);
                var h = content.substr(settings.showChar, content.length - settings.showChar); 
                var html = c + '<span class="moreellipses">' + settings.ellipsestext+ '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;&nbsp;<a href="" class="morelink">' + settings.moretext + '</a></span>'; 
                $(this).html(html);
            }
    
            $(o).on('click', '.morelink', function(){
                if($(this).hasClass("less")) {
                    $(this).removeClass("less");
                    $(this).closest('.brandwire_content').find('.moreellipses').show();
                    $(this).closest('.brandwire_content').find('.morecontent span').hide();
                    $(this).html(settings.moretext);
                } else {
                    
                    $(this).addClass("less");
                    $(this).closest('.brandwire_content').find('.moreellipses').hide();
                    $(this).closest('.brandwire_content').find('.morecontent span').show();
                    $(this).html(settings.lesstext);
                }
                // $(this).parent().prev().toggle();
                // $(this).prev().toggle();
                return false;
            });
    
    
        });
    }
})(jQuery);
    
    require(['tiljs/ui'], function(ui){
                var lastScrollTop = 0;
                
                $(window).scroll(function(event){
                    var elem = $('#new_ss'+msid);
                    if( elem.length <= 0 ){
                        return;
                    }
                    var postionTop = elem.offset().top;
                    if ($(this).scrollTop() > postionTop) {
                        elem.css('background','red');
                     } else {
                        elem.css('background','black');;
                      }
                // console.log(ui.inView($('#new_ss'+msid)));
                //   var st = $(this).scrollTop();
                //   if (st > lastScrollTop){
                //       console.log('downscroll code');
                //   } else {
                //       console.log('upscroll code');
                //   }
                //   lastScrollTop = st;
                });
    });
    
   var bottomVidSlider = $("[data-plugin='video_slideshow']").eq(0);
   bottomVidSlider.find('.videobox li').each(function(index, obj){
                    $(obj).find('.iconvideo').text($(obj).find('.icon_player').text());
                });
   require(["rodate"], function(rodate){
                                        rodate.uptime();
                            });
   
   videos_section_slider.init( 
            bottomVidSlider,
            bottomVidSlider.closest('.jBottomVidSlider').find('.next'),
            bottomVidSlider.closest('.jBottomVidSlider').find('.prev')
    );
    
    (function(){
        //TOIPR-30193 Spotlight article
        //tracki
        var time = 0;
        var fireSpotlightGA = function(intervalTime){
            if (typeof(ga) != "function") {
                return;
            }
            
            intervalTime += ' sec';
            
            ga('send', {
                hitType: 'event',
                eventCategory: 'Spotlight Timed Articles-WEB',
                eventAction: ( toiprops._Hyp1_pg || '' ),
                eventLabel: intervalTime
            });
        }
        
        var isSpolightArticle = Boolean( $("#isSpolightArticle").val() || false );
        if(isSpolightArticle){
            var interval = setInterval(function(){
                                time += 30000;
                                var tenMins = 10*60*1000;
                                if( time > tenMins ){
                                    clearInterval(interval);
                                    return;
                                }
                                fireSpotlightGA( time/1000 );
                            }, 30000);
            
        }
        
    })();
   
   //for internaltional geo-location, hide gadgets-now widget and show newsletter-widget will additional mrec
   var handleRHSbyGeoLocation = function(msid){
       var  $gn_wdt = $('.gadgets-now-rhs-widget');
            
        //if geo international
        if(window._geo != 1){
            $.ajax({
                url: '/wdt_subscribe_nwsltr.cms',
                success: function(response){
                    $('<div style="clear:both;">' + response + '</div>').insertAfter($gn_wdt);
                    $gn_wdt.remove();
                }
            }); 
        }
   }
   
   //call handleRHSbyGeoLocation on load
   handleRHSbyGeoLocation(window.msid);
   
   
   function loadScorecardWidget(articleId){
       
        var refresh = function($sccontainer){ 
               var matchfile = $sccontainer.data('matchid');
               
               // file generated through election_dec2017_s3urls_epolling template internally using article_match_scoreboard.cms
               $.ajax({
                   'url': 'https://toibnews.timesofindia.indiatimes.com/Election/election2017_article_scorecard_as_html_' + matchfile + '.htm',
                   'type': 'GET',
                   'dataType': 'html'
               }).done(function(data){
                   $sccontainer.find('.btn-reload').removeClass('spin');
                   $sccontainer.html(data);
               });   
        };
                     
       var $scorecard = $('#sc_' + articleId);
       //if scorecard is present only then make the call
       if($scorecard.length!==0){
           $scorecard.on('click','.btn-reload',function(e){
               e.preventDefault();
               e.stopPropagation();
               $scorecard.find('.btn-reload').addClass('spin');
               refresh($scorecard);
           });
           refresh($scorecard);
       }
   }
   
   loadScorecardWidget(msid);
   
   if (window.TimesGDPR && TimesGDPR.common.consentModule.gdprCallback){
        TimesGDPR.common.consentModule.gdprCallback(function(data){
         if(!data.isEUuser && typeof toiweb != 'undefined'){
            toiweb.nl.init();
                    }
                })
            }
   
   function firePageViewCandidate(articleId){
        $("[data-articlemsid="+ articleId +"]").data('pageview_candidate_fired', 'inprogress');
        $.ajax({
          url: "/pageview_candidate.cms",
          cache: false,
          dataType: "xml",
          success: function(data) {
              if (typeof(COMSCORE) !="undefined" && typeof(COMSCORE.beacon) == "function") {
                    self.COMSCORE && COMSCORE.beacon({ c1: "2", c2: "6036484" });
                    $("[data-articlemsid="+ articleId +"]").data('pageview_candidate_fired', 'yes');
              }
          },
          error : function(error){
             $("[data-articlemsid="+ articleId +"]").data('pageview_candidate_fired', 'error'); 
          }
        });
    }
   
    $( document ).ready(function() {
        $('.lang-btn').on('click',function(e){
            e.stopPropagation();
            $(this).toggleClass('active');
            $('.lang-dropdown').toggleClass('active');
        });
        
        $(document).on('click', function(e) {
            if ($('.lang-dropdown').hasClass('active') && (!($(e.target).hasClass('lang-selector') || $(e.target).closest('.lang-selector').length ) || $(e.target).closest('.lang-dropdown').length) ) {
                $('.lang-btn').click();
            }
        });
    });
  
  
            
                /* Copy to clipboard code for URL*/
(function(){
    var d=document,b=d.body,de=d.documentElement,C=eval("/*@cc_on!@*/false"),
        _ga_utm = 'utm_source=contentofinterest&utm_medium=text&utm_campaign=' + ((window.TimesApps && TimesApps.preventCopyUtm) || 'cppst'),
        AE,RE,
        sp=function(a,b){for(var c in a)
if(a.hasOwnProperty(c))
b[c]=a[c]},bo=function(a,b,c){a=d.createElement(a);sp(b,a);sp(c,a.style);return a},tc=function(){var so,st='',reg1=/\w+/ig,linkFlg=true;if(_gaq){_gaq.push(['_trackEvent','cppst','select','cntntcp']);}
if(d.selection&&d.selection.createRange){so=d.selection.createRange();var st=so.htmlText;if(st.match(reg1).length>4){linkFlg=true;st=st.replace(/(<a([^>]+)>)/ig,"");st=st.replace(/(<([^>]+)a>)/ig,"");st=(st.length>60)?st.substring(0,60)+'&nbsp;..':st;st=st.replace(/\n/ig,"<br />");st+="<br />";}}else{var so=window.getSelection();var st=so.toString();if(st.match(reg1).length>4){if(so.rangeCount){var container=bo('div',{'id':'copiedTextClone'},{'display':'none'});linkFlg=true;var len=so.rangeCount;for(var i=0;i<len;++i){container.appendChild(so.getRangeAt(i).cloneContents());}
st=container.innerHTML;st=st.replace(/(<a([^>]+)>)/ig,"");st=st.replace(/(<([^>]+)a>)/ig,"");st=(st.length>60)?st.substring(0,60)+'&nbsp;..':st;}}}
var lnkurl=window.location.href;var indx2=lnkurl.indexOf('/articleshow');lnkurl="http://timesofindia.indiatimes.com"+(lnkurl.substring(indx2,lnkurl.length));lnkurl=(lnkurl.indexOf('?')==-1)?(lnkurl+'?'+_ga_utm):((lnkurl.indexOf(_ga_utm)==-1)?(lnkurl+'&'+_ga_utm):lnkurl);if(linkFlg){var lnk="<br /><br /><div style='font-siae:12px;font-family:arial'>Read more at:<br /><a href='"+lnkurl+"'>"+lnkurl+"</a></div>";st=st+" "+lnk;}
var e=bo('div',{},{'position':'fixed','top':0,'left':'-99999px','background':'#fff'});b.appendChild(e);e.innerHTML=st;if(so.selectAllChildren){so.selectAllChildren(e);}else{var m=b.createTextRange();m.moveToElementText(e);m.select();}
window.setTimeout(function(){b.removeChild(e);},0);},ca=function(a){SE();d.readyState=="complete"?a():AE(window,"load",function(){setTimeout(function(){if(typeof d.readyState=="undefined"&&!C)
d.readyState="complete";a();},10)})},SE=function(){if(window.addEventListener){AE=function(a,b,c){a.addEventListener(b,c,false)};RE=function(a,b,c){a.removeEventListener(b,c,false)}}else{AE=function(a,b,c){a.attachEvent("on"+b,c)};RE=function(a,b,c){a.detachEvent("on"+b,c)}}},init=function(){if(window.addEventListener){b.addEventListener("copy",tc);}else{b.attachEvent("oncopy",tc);}}
return ca(init);})();
/* Copy to clipboard code Ends*/
        	
	